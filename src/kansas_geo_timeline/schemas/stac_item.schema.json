{
  "$id": "https://kansas-geo-timeline.org/schemas/stac_item.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "STAC Item (Kansas Geo Timeline)",
  "description": "Schema for STAC Item objects used by Kansas-Frontier-Matrix / Kansas Geo Timeline. Compatible with STAC 1.0.x and allows project-specific optional fields.",
  "type": "object",
  "additionalProperties": true,

  "required": ["stac_version", "id", "type", "geometry", "bbox", "properties", "links", "assets"],

  "properties": {
    "stac_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "STAC version implemented (e.g., 1.0.0)."
    },

    "stac_extensions": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "uniqueItems": true,
      "description": "Optional array of extension identifiers or URLs."
    },

    "type": {
      "const": "Feature",
      "description": "All Items are GeoJSON Features."
    },

    "id": { "type": "string", "minLength": 1 },

    "collection": { "type": "string" },

    "proj:epsg": {
      "type": ["integer", "null"],
      "description": "Projection extension shortcut (allowed top-level in this project)."
    },

    "geometry": {
      "description": "GeoJSON geometry (project-limited to Polygon/MultiPolygon).",
      "type": "object",
      "required": ["type", "coordinates"],
      "additionalProperties": true,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["Polygon", "MultiPolygon"]
        },
        "coordinates": {}
      }
    },

    "bbox": {
      "description": "Bounding box array: [west, south, east, north] (2D) or longer per STAC.",
      "type": "array",
      "items": { "type": "number" },
      "minItems": 4
    },

    "properties": {
      "type": "object",
      "additionalProperties": true,
      "description": "Item properties (temporal fields + optional proj:epsg).",

      "properties": {
        "datetime": { "type": ["string", "null"], "format": "date-time" },
        "start_datetime": { "type": ["string", "null"], "format": "date-time" },
        "end_datetime": { "type": ["string", "null"], "format": "date-time" },
        "proj:epsg": { "type": ["integer", "null"] }
      },

      "allOf": [
        {
          "description": "Either datetime OR (start_datetime AND end_datetime) must be present and non-null.",
          "oneOf": [
            { "properties": { "datetime": { "type": "string", "format": "date-time" } } },
            {
              "required": ["start_datetime", "end_datetime"],
              "properties": {
                "datetime": { "type": "null" },
                "start_datetime": { "type": "string", "format": "date-time" },
                "end_datetime": { "type": "string", "format": "date-time" }
              }
            }
          ]
        }
      ]
    },

    "assets": {
      "type": "object",
      "minProperties": 1,
      "additionalProperties": false,
      "description": "Dictionary of asset objects keyed by asset name.",
      "patternProperties": {
        "^.+$": {
          "type": "object",
          "required": ["href"],
          "additionalProperties": true,
          "properties": {
            "href": { "type": "string", "minLength": 1 },
            "title": { "type": ["string", "null"] },
            "description": { "type": ["string", "null"] },
            "type": { "type": ["string", "null"] },
            "roles": {
              "type": "array",
              "items": { "type": "string" },
              "uniqueItems": true
            }
          }
        }
      }
    },

    "links": {
      "type": "array",
      "minItems": 1,
      "description": "Link objects; must include self/root/parent.",
      "items": {
        "type": "object",
        "required": ["rel", "href"],
        "additionalProperties": true,
        "properties": {
          "rel": { "type": "string", "minLength": 1 },
          "href": { "type": "string", "minLength": 1 },
          "type": { "type": ["string", "null"] },
          "title": { "type": ["string", "null"] }
        }
      },
      "allOf": [
        { "contains": { "type": "object", "properties": { "rel": { "const": "self" } }, "required": ["rel"] } },
        { "contains": { "type": "object", "properties": { "rel": { "const": "root" } }, "required": ["rel"] } },
        { "contains": { "type": "object", "properties": { "rel": { "const": "parent" } }, "required": ["rel"] } }
      ]
    },

    "license": { "type": "string" },

    "providers": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name"],
        "properties": {
          "name": { "type": "string" },
          "roles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["producer", "processor", "host", "licensor"]
            }
          },
          "url": { "type": "string" }
        }
      }
    }
  },

  "examples": [
    {
      "stac_version": "1.0.0",
      "stac_extensions": [],
      "type": "Feature",
      "id": "usgs_topo_larned_1894",
      "collection": "overlays",
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [-99.401, 38.217],
          [-99.000, 38.217],
          [-99.000, 38.000],
          [-99.401, 38.000],
          [-99.401, 38.217]
        ]]
      },
      "bbox": [-99.401, 38.000, -99.000, 38.217],
      "properties": {
        "datetime": "1894-01-01T00:00:00Z",
        "proj:epsg": 4326
      },
      "assets": {
        "data": {
          "href": "data/cogs/overlays/usgs_topo_larned_1894.tif",
          "type": "image/tiff; application=geotiff; profile=cloud-optimized",
          "roles": ["data", "overlay"],
          "title": "USGS Historic Topo â€” Larned (1894)"
        },
        "thumbnail": {
          "href": "data/cogs/overlays/usgs_topo_larned_1894_preview.png",
          "type": "image/png",
          "roles": ["thumbnail"]
        }
      },
      "links": [
        { "rel": "self", "href": "data/stac/items/usgs_topo_larned_1894.json" },
        { "rel": "collection", "href": "data/stac/collections/overlays.json" },
        { "rel": "root", "href": "data/stac/catalog.json" },
        { "rel": "parent", "href": "data/stac/collections/overlays.json" }
      ],
      "license": "Public Domain (USGS)",
      "providers": [
        { "name": "USGS", "roles": ["producer", "licensor"], "url": "https://www.usgs.gov/" }
      ]
    }
  ]
}
