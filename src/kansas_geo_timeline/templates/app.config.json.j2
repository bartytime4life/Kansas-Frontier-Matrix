{
  "title": {{ (title | default("Kansas-Frontier-Matrix", true)) | tojson }},
  "subtitle": {{ (subtitle | default("Time-aware historical GIS for Kansas", true)) | tojson }},
  "style": {{ (style | default("https://demotiles.maplibre.org/style.json", true)) | tojson }},

  "center": [{{ center_lon | default(-98.3) }}, {{ center_lat | default(38.5) }}],
  "zoom": {{ zoom | default(6) }},

  "time": { "min": {{ start_year | default(1850) }}, "max": {{ end_year | default(2025) }} },
  "defaultYear": {{ default_year | default( (start_year | default(1850)) ) }},

  "defaults": {
    "minzoom": {{ minzoom | default(0) }},
    "maxzoom": {{ maxzoom | default(15) }},
    "tileSize": {{ tilesize | default(256) }},
    "visible": {{ (visible | default(true)) | tojson }},
    "opacity": {{ opacity | default(1.0) }},
    "bounds": {{ (bounds | default([-102.05, 36.99, -94.59, 40.00])) | tojson }}
  },

  "layers": [
    {# --- Optional OSM basemap ------------------------------------------------ #}
    {% set include_osm = include_osm if include_osm is defined else true %}
    {% if include_osm %}
    {
      "id": "basemap_osm",
      "title": "Basemap — OpenStreetMap",
      "group": {{ (basemap_group | default("Basemaps & Terrain")) | tojson }},
      "type": "raster",
      "url": "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
      "opacity": 1.0,
      "minzoom": 0,
      "maxzoom": 19,
      "visible": true,
      "attribution": "© OpenStreetMap contributors"
    }{% if layers is defined and layers %},{% endif %}
    {% endif %}

    {# --- Hand-authored layers (vector/raster/image) ------------------------- #}
    {% if layers is defined and layers %}
      {%- for ly in layers -%}
      {
        "id": {{ ly.id | tojson }},
        "title": {{ (ly.title | default(ly.id)) | tojson }},
        "group": {{ (ly.group | default("Layers")) | tojson }},
        "type": {{ (ly.type | default("raster")) | tojson }},
        {# Normalize URL / tiles / path into "url" #}
        {% if ly.url is defined %}
          "url": {{ ly.url | tojson }},
        {% elif ly.tiles is defined and ly.tiles %}
          "url": {{ (ly.tiles[0]) | tojson }},
        {% elif ly.path is defined %}
          "url": {{ ly.path | tojson }},
        {% endif %}
        {# For image overlays, pass coordinates [[minX,maxY],[maxX,maxY],[maxX,minY],[minX,minY]] #}
        {% if ly.coordinates is defined %}"coordinates": {{ ly.coordinates | tojson }},{% endif %}
        "opacity": {{ (ly.opacity | default(1.0)) }},
        "minzoom": {{ (ly.minzoom | default(minzoom | default(0))) }},
        "maxzoom": {{ (ly.maxzoom | default(maxzoom | default(15))) }},
        "visible": {{ (ly.visible is not defined or ly.visible | bool) | tojson }},
        {% if ly.start is defined %}"start": {{ ly.start }},{% endif %}
        {% if ly.end is defined %}"end": {{ ly.end }},{% endif %}
        {% if ly.paint is defined %}"paint": {{ ly.paint | tojson }},{% endif %}
        {% if ly.attribution is defined %}"attribution": {{ ly.attribution | tojson }},{% endif %}
        {% if ly.extra is defined %}"extra": {{ ly.extra | tojson }},{% endif %}
        "_generated": true
      }{{ "," if not loop.last }}
      {%- endfor -%}
    {% endif %}
  ]
}
