---
title: "ğŸ” KFM v11 â€” Hydrology Refresh Checksum Manifest Module (Diamondâ¹ Î© / CrownâˆÎ© Ultimate Certified)"
path: "src/pipelines/autonomous/hydrology-refresh/resources/checksums/README.md"
version: "v11.0.0"
last_updated: "2025-11-22"
review_cycle: "Daily Â· Autonomous"
commit_sha: "<latest-commit-hash>"
sbom_ref: "../../../../../../releases/v11.0.0/sbom.spdx.json"
manifest_ref: "../../../../../../releases/v11.0.0/manifest.zip"
telemetry_ref: "../../../../../../releases/v11.0.0/telemetry/autonomous-hydrology-refresh.json"
telemetry_schema: "../../../../../../schemas/telemetry/autonomous-hydrology-refresh-v1.json"
governance_ref: "../../../../../../docs/standards/governance/ROOT-GOVERNANCE.md"
data_contract_ref: "../../../../../../docs/contracts/data-contract-v3.json"
license: "MIT"
mcp_version: "MCP-DL v6.3"
markdown_protocol_version: "KFM-MDP v11.0.0"
status: "Active / Enforced"
doc_kind: "Checksum Module"
semantic_document_id: "kfm-hydro-refresh-checksum-module-v11"
doc_uuid: "urn:kfm:pipelines:autonomous:hydrology-refresh:resources:checksums:v11"
machine_extractable: true
accessibility_compliance: "WCAG 2.1 AA+"
fair_category: "F1-A1-I1-R1"
care_label: "Public / Medium-Risk"
immutability_status: "version-pinned"
---

<div align="center">

# ğŸ” **Hydrology Refresh â€” Checksum Manifest Module (v11)**  
`src/pipelines/autonomous/hydrology-refresh/resources/checksums/README.md`

**Purpose:**  
Define the checksum manifest system used by the **Autonomous Hydrology Refresh Pipeline**, ensuring  
cryptographic integrity, deterministic recomputation, CI-enforced STAC correctness, and reliable  
promotion of hydrology assets under KFM v11.

</div>

---

# ğŸ“˜ Overview

This module provides **checksums/manifest.json**, the authoritative integrity ledger for all hydrology assets  
produced by the pipeline, including:

- Normalized tabular outputs (streamflow, precip, WSEL, water-quality)  
- Derived hydrology rasters (e.g., gridded streamflow, WSEL surfaces)  
- Bathymetry/WID-related products linked to hydrology STAC Items  

The checksum system:

- Detects upstream content drift or corruption  
- Prevents invalid assets from being promoted to STAC/Neo4j  
- Supports deterministic re-runs of the DAG  
- Feeds into stale detection logic  
- Underpins reproducibility for scientific and regulatory use cases  

---

# ğŸ—‚ Directory Layout (v11)

```text
src/pipelines/autonomous/hydrology-refresh/resources/checksums/
â”‚
â”œâ”€â”€ README.md                 # This file (v11 MDP)
â””â”€â”€ manifest.json             # SHA-256 manifest for hydrology STAC assets
```

---

# ğŸ”‘ manifest.json â€” Integrity Contract

`manifest.json` is a **JSON Schemaâ€“validated** file containing:

- Global manifest version  
- Last updated ISO 8601 timestamp  
- `entries` map from asset key â†’ integrity record  

Each entry MUST specify:

- `sha256` â€” hex-encoded SHA-256 digest  
- `provider` â€” hydrology provider ID (e.g., `usgs.streamflow.ks_mainstem`)  
- `last_verified` â€” ISO 8601 timestamp  
- Optional `mh:sha256-hex` â€” multihash representation for STAC v11+

### Example Structure (placeholder hashes)

```json
{
  "version": "1.0.0",
  "last_updated": "2025-11-22T03:00:00Z",
  "entries": {
    "usgs.streamflow.ks_mainstem_2025-11-21.csv": {
      "sha256": "aabbccddeeff00112233445566778899aabbccddeeff00112233445566778899",
      "provider": "usgs.streamflow.ks_mainstem",
      "last_verified": "2025-11-22T03:00:00Z"
    },
    "noaa.precip.24h_2025-11-21.csv": {
      "sha256": "11223344556677889900aabbccddeeff11223344556677889900aabbccddeeff",
      "provider": "noaa.precip.24h",
      "last_verified": "2025-11-22T03:00:00Z"
    }
  }
}
```

> Hash values above are illustrative only; real values MUST be generated by the pipeline.

All top-level keys inside `entries` MUST be sorted alphabetically for deterministic diffs.

---

# âš™ How the Manifest Is Used in the DAG

### Node â†’ `validate_checksums.py`
- Reads `manifest.json`  
- Computes SHA-256 for each referenced hydrology asset  
- Compares computed hashes to stored values  
- Fails fast on mismatch (strict mode)  
- In governance-approved â€œupdate mode,â€ can update manifest records atomically  

### Node â†’ `detect_stale.py`
- Uses `last_verified` to complement HTTP etag/Last-Modified logic  
- Avoids redundant re-downloads when both remote + manifest indicate no changes  

### Node â†’ `post_hooks.py`
- Summarizes checksum health in telemetry (`telemetry_ref`)  
- Emits OpenLineage checksum facets indicating success/failure  

---

# ğŸ§¬ PROV-O Lineage Requirements

Each checksum validation MUST add a PROV-O event to the lineage:

```
prov:activity          â†’ "checksum-verify-v11"
prov:used              â†’ <local asset path>
prov:generatedAtTime   â†’ timestamp
prov:wasAssociatedWith â†’ "kfm-autonomous-hydrology-refresh"
```

This MUST be injected into:

- STAC Item `'kfm:lineage'` block  
- Telemetry records for the run  

---

# ğŸ” CI/CD Enforcement

CI MUST block a PR if any of the following hold:

- `manifest.json` is missing  
- Manifest JSON is invalid (malformed, not draft-2020-12 compatible if schema is defined)  
- A hydrology STAC asset has no corresponding manifest entry  
- SHA-256 mismatch between file and manifest  
- Alphabetical ordering of keys is violated  
- Unauthorized manifest edits are detected (e.g., manual hash changes without governance)  

These checks run before any Neo4j sync or release artifact generation.

---

# ğŸ§­ Governance & Best Practices

- DO NOT hand-edit hash values; always let the pipelineâ€™s **update mode** regenerate them.  
- Document checksum changes clearly in commit messages.  
- Use **atomic writes** for manifest updates to avoid partial-write issues.  
- Align hydrology asset naming with STAC Item IDs and Collection IDs to keep keys consistent.  
- Ensure backup/archiving of older manifests when major version changes occur.

---

# ğŸ•° Version History

- **v11.0.0 (2025-11-22)** â€” Initial Hydrology Refresh checksum module for KFM v11.

---

<div align="center">

**Kansas Frontier Matrix â€” Hydrology Refresh Checksum Module (v11)**  
*Integrity Â· Repeatability Â· Scientific Confidence*

</div>

---

### ğŸ”— Footer  
[â¬… Back to Hydrology Resources](../README.md) Â· [ğŸ“‘ Schema Module](../schema/README.md) Â· [ğŸ§© Nodes](../../nodes/README.md) Â· [ğŸ› Governance](../../../../../../docs/standards/governance/ROOT-GOVERNANCE.md)

