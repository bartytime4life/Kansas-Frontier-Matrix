
```yaml
# .github/workflows/preview_lineage.yml
name: preview-lineage

on:
  push:
    branches-ignore: [ main, "release/**" ]
    paths:
      - "sample_data/**"
      - "scripts/**"
      - ".github/workflows/preview_lineage.yml"
  pull_request:
    branches: [ main ]
    paths:
      - "sample_data/**"
      - "scripts/**"

permissions:
  contents: write
  pull-requests: write

env:
  PYTHONUNBUFFERED: "1"
  PYTHONHASHSEED: "0"                 # deterministic hashing
  OL_COLLECTOR_URL: ${{ secrets.OL_COLLECTOR_URL }} # optional; if unset we just write json
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}             # or your PAT in GH_TOKEN if needed

jobs:
  preview:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout
        uses: actions/checkout@v4

      - name: üêç Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: üì¶ Install deps
        run: |
          python -m pip install --upgrade pip
          pip install pandas==2.2.3 requests==2.32.3 jsonschema==4.23.0

      - name: üß™ Deterministic dry‚Äërun transform
        run: |
          python scripts/preview_transform.py \
            --input sample_data/example.csv \
            --out preview/preview.csv \
            --seed 42

      - name: üßæ Emit lineage & PROV evidence
        run: |
          python scripts/post_openlineage.py \
            --job-name "preview-transform" \
            --namespace "sandbox" \
            --run-id "${{ github.run_id }}" \
            --inputs "sample_data/example.csv" \
            --outputs "preview/preview.csv" \
            --collector "${OL_COLLECTOR_URL:-}" \
            --prov-out preview/prov.json \
            --ol-out preview/openlineage.json

      - name: üì¶ Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: preview-artifacts
          path: |
            preview/preview.csv
            preview/prov.json
            preview/openlineage.json

      - name: üìù Open/Update draft PR with artifacts
        env:
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_REF_NAME: ${{ github.ref_name }}
        run: |
          python scripts/open_pr.py \
            --title "Preview: ${GITHUB_REF_NAME}" \
            --body-file scripts/pr_body.md \
            --draft true
