# .github/workflows/labeler.yml
# ðŸ· Kansas Frontier Matrix â€” PR Auto-Labeling by Component / Domain
# v11.2.6 â€” Diamondâ¹ Î© / CrownâˆžÎ© Ultimate Certified
#
# Purpose:
#   - Automatically apply and sync labels on pull requests based on:
#       * Changed paths (code, data, docs, infra, AI, Focus Mode, etc.)
#       * Patterns defined in .github/labeler.yml
#   - Support governance routing, CODEOWNERS, and dashboard filtering.
#
# Security Notes:
#   - This workflow uses pull_request_target so labeling works for forks.
#   - pull_request_target runs with elevated privileges in the target repo context.
#   - DO NOT checkout or execute PR-head code here; keep this workflow â€œAPI-onlyâ€.
#
# Notes:
#   - Uses actions/labeler with configuration from .github/labeler.yml.

name: ðŸ· labeler

on:
  pull_request_target:
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review
      - edited

concurrency:
  group: labeler-pr-${{ github.event.pull_request.number }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  apply-labels:
    name: "ðŸ· Apply Path-Based Labels"
    runs-on: ubuntu-22.04
    timeout-minutes: 10

    steps:
      - name: ðŸ· Run Labeler (from .github/labeler.yml)
        uses: actions/labeler@v5
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          configuration-path: ".github/labeler.yml"
          sync-labels: true

      - name: ðŸ§¾ Emit Labeler Summary
        if: always()
        run: |
          set -euo pipefail
          {
            echo "## ðŸ· PR Auto-Labeling Summary"
            echo ""
            echo "- Workflow: \`${GITHUB_WORKFLOW}\`"
            echo "- PR: #${{ github.event.pull_request.number }}"
            echo "- Base: \`${{ github.event.pull_request.base.repo.full_name }}@${{ github.event.pull_request.base.ref }}\`"
            echo "- Head: \`${{ github.event.pull_request.head.repo.full_name }}@${{ github.event.pull_request.head.ref }}\`"
            echo "- Rules: \`.github/labeler.yml\`"
            echo ""
            echo "Labels are applied/synced based on the changed-file paths in the PR."
          } >> "${GITHUB_STEP_SUMMARY}"
