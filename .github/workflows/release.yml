---
title: "üß≠ Kansas Frontier Matrix ‚Äî STAC to Knowledge-Graph Architecture & Provenance Model"
path: "docs/architecture/stac-knowledge-graph.md"
version: "v11.2.6"
last_updated: "2025-12-13"

release_stage: "Stable / Governed"
lifecycle: "Long-Term Support (LTS)"
review_cycle: "Annual ¬∑ Architecture Review Board ¬∑ FAIR+CARE Council"
content_stability: "stable"

status: "Active / Enforced"
doc_kind: "Architecture Standard"
header_profile: "standard"
footer_profile: "standard"

license: "CC-BY 4.0"
mcp_version: "MCP-DL v6.3"
markdown_protocol_version: "KFM-MDP v11.2.6"
ontology_protocol_version: "KFM-OP v11"
pipeline_contract_version: "KFM-PDC v11"
stac_profile: "KFM-STAC v11"
dcat_profile: "KFM-DCAT v11"
prov_profile: "KFM-PROV v11"

fair_category: "F1-A1-I1-R1"
care_label: "Public ¬∑ Low-Risk"
classification: "Public"
sensitivity: "General (non-sensitive; auto-mask rules apply)"
sensitivity_level: "None"
public_exposure_risk: "Low"
jurisdiction: "Kansas / United States"
indigenous_rights_flag: true
data_steward: "KFM FAIR+CARE Council"
immutability_status: "version-pinned"
ttl_policy: "24 months"
sunset_policy: "Superseded by KFM v12"

doc_uuid: "urn:kfm:doc:architecture:stac-knowledge-graph:v11.2.6"
semantic_document_id: "kfm-architecture-stac-knowledge-graph-v11.2.6"
event_source_id: "ledger:kfm:doc:architecture:stac-knowledge-graph:v11.2.6"
doc_integrity_checksum: "<sha256>"
commit_sha: "<latest-commit-hash>"
previous_version_hash: "<previous-sha256>"

signature_ref: "././releases/v11.2.6/signature.sig"
attestation_ref: "././releases/v11.2.6/slsa-attestation.json"
sbom_ref: "././releases/v11.2.6/sbom.spdx.json"
manifest_ref: "././releases/v11.2.6/manifest.zip"
provenance_chain:
  - "././releases/v11.2.6/manifest.zip"
  - "././releases/v11.2.6/sbom.spdx.json"
  - "././releases/v11.2.6/slsa-attestation.json"

ai_training_inclusion: false
ai_focusmode_usage: "Allowed with restrictions"
ai_transform_permissions:
  - "summary"
  - "diagram-extraction"
  - "metadata-extraction"
  - "layout-normalization"
  - "semantic-highlighting"
ai_transform_prohibited:
  - "content-alteration"
  - "speculative-additions"
  - "unverified-architectural-claims"
  - "governance-override"

governance_ref: "../standards/governance/ROOT-GOVERNANCE.md"
ethics_ref: "../standards/faircare/FAIRCARE-GUIDE.md"
sovereignty_policy: "../standards/sovereignty/INDIGENOUS-DATA-PROTECTION.md"
---

<div align="center">

# üß≠ STAC ‚Üí Knowledge-Graph Architecture

`docs/architecture/stac-knowledge-graph.md`

**Purpose**  
Define the canonical, governed pattern for ingesting STAC catalogs into the KFM Neo4j knowledge graph with PROV-O-complete lineage, deterministic replay, and fast spatiotemporal traversal.

</div>

---

## üìò Overview

This document defines the **canonical architecture pattern** for ingesting **STAC catalogs** into the Kansas Frontier Matrix **Neo4j knowledge graph**, preserving **full PROV-O lineage**, enabling **fast spatiotemporal queries**, and supporting **Story Nodes and Focus Mode** without drift.

This pattern is **mandatory** for all governed geospatial raster, vector, and derived analytical products in KFM v11.

### Architectural intent

The STAC ‚Üí Graph pattern serves four core objectives:

1. **Deterministic ingestion** of external and internal STAC catalogs
2. **First-class provenance** for every transformation and derivative
3. **Fast temporal and spatial traversal** for narrative and analysis layers
4. **Governance-ready lineage** aligned with FAIR+CARE and Indigenous data protections

---

## üóÇÔ∏è Directory Layout

~~~text
üìÅ KansasFrontierMatrix/
‚îú‚îÄ‚îÄ üìÅ docs/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ architecture/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ stac-knowledge-graph.md            # This standard (governed)
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ standards/
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ governance/ROOT-GOVERNANCE.md      # Governance authority
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ faircare/FAIRCARE-GUIDE.md         # FAIR+CARE practices
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ sovereignty/INDIGENOUS-DATA-PROTECTION.md
‚îú‚îÄ‚îÄ üìÅ data/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ stac/                                  # STAC Collections/Items (catalog output)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ sources/                               # Source manifests (license, checksums)
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ processed/                             # Derived artifacts (never in src/)
‚îú‚îÄ‚îÄ üìÅ schemas/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ stac/                                  # KFM STAC profile constraints
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ dcat/                                  # DCAT profile constraints
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ prov/                                  # PROV(-O) constraints / JSON-LD context
‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ graph/                                  # Neo4j ingestion + mapping logic (expected)
‚îú‚îÄ‚îÄ üìÅ mcp/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ runs/                                   # Run logs + config snapshots (deterministic)
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ experiments/                            # Research-only runs (if any)
‚îî‚îÄ‚îÄ üìÅ .github/
    ‚îî‚îÄ‚îÄ üìÅ workflows/                              # CI validation + governance gates
~~~

---

## üß≠ Context

### Position in the KFM pipeline

~~~text
Deterministic ETL
‚Üì
STAC / DCAT / PROV catalogs (machine-validated)
‚Üì
Graph Ingestion (idempotent merge + constraints)
‚Üì
Neo4j Knowledge Graph
‚Üì
API ‚Üí UI ‚Üí Story Nodes ‚Üí Focus Mode
~~~

### Key principle

Lineage is not an add-on. **If it is not in the graph, it is not governed.**

---

## üß± Architecture

### Core graph entities

#### 1) Collection (`:Collection`)
Represents a STAC Collection.

**Required properties**
- `collection_id` (stable identifier)
- `title`
- `license`
- `stac_version`
- `created_at`

#### 2) Item (`:Item`)
Represents a STAC Item (acquisition-time atomic unit).

**Required properties**
- `item_id` (globally unique)
- `collection_id`
- `acquisition_time` (ISO-8601 UTC)
- `geometry` (WKB or GeoJSON)
- `bbox`
- `platform`
- `constellation`

**Optional properties**
- `gsd`
- `cloud_cover`
- `eo_bands`
- `created_at`
- `updated_at`

#### 3) Asset (`:Asset`)
Represents a STAC Asset (file, reference, or derivative).

**Required properties**
- `asset_id` (`item_id::asset_key`)
- `href`
- `type` (MIME)
- `roles[]`
- `checksum`
- `size_bytes`

#### 4) Process (`:Process`)
Represents a PROV Activity (ingest, transform, derive).

**Required properties**
- `process_id`
- `name`
- `kind` (`ingest | transform | derive | subset | reproject`)
- `started_at`
- `ended_at`
- `params_json`
- `code_ref` (git SHA)
- `container_digest`
- `attestation_ref`

#### 5) Dataset (`:Dataset`) (optional materialization)
Used for mosaics, composites, or analytical outputs.

**Required properties**
- `dataset_id`
- `title`
- `spatial_ref`
- `temporal_extent`
- `checksum`
- `size_bytes`
- `location`

---

### Canonical relationships

~~~text
(:Collection)-[:HAS_ITEM]->(:Item)
(:Item)-[:HAS_ASSET]->(:Asset)
(:Item)-[:IN_COLLECTION]->(:Collection)

(:Process)-[:USED]->(:Item|:Asset)
(:Process)-[:GENERATED]->(:Item|:Asset|:Dataset)

(:Asset)-[:DERIVED_FROM]->(:Asset|:Item)
~~~

This structure directly mirrors PROV-O:

| PROV concept | KFM node |
|---|---|
| Entity | `:Item`, `:Asset`, `:Dataset` |
| Activity | `:Process` |
| Agent | Tool / user / service (reserved extension; see ‚ÄúFuture Extensions‚Äù) |

---

### Indexing & performance guarantees

#### Identity & integrity (non-negotiable)
- Unique constraints on:
  - `:Item(item_id)`
  - `:Collection(collection_id)`
  - `:Asset(asset_id)`
  - `:Process(process_id)`

#### Temporal access
- Range index:
  - `:Item(acquisition_time)`
- Optional composite index:
  - `:Item(collection_id, acquisition_time)`

#### Spatial acceleration (coarse-to-fine)
Each `:Item` must include at least one tiling key for coarse filtering prior to exact geometry tests:
- `s2_cell_level_12` **or**
- `quadkey_z14`

---

### Deterministic ingestion contract

Each ingested STAC Item must supply (minimum KFM contract):

~~~json
{
  "collection": "string",
  "id": "string",
  "properties": {
    "datetime": "2025-12-13T00:00:00Z",
    "platform": "string",
    "constellation": "string"
  },
  "geometry": { "type": "Polygon", "coordinates": [] },
  "assets": {
    "data": {
      "href": "uri",
      "type": "mime",
      "roles": ["data"],
      "checksum": "sha256:<hex>",
      "size": 123456
    }
  },
  "kfm:provenance": {
    "process": {
      "id": "proc-id",
      "name": "ingest_stac@vX",
      "kind": "ingest",
      "code_ref": "git-sha",
      "container_digest": "sha256:<hex>",
      "attestation_ref": "slsa.json"
    },
    "inputs": ["asset-id-1"]
  }
}
~~~

---

## üåê STAC, DCAT & PROV Alignment

### STAC
- `Collection` maps to `:Collection`
- `Item` maps to `:Item`
- `assets.*` map to `:Asset`

### DCAT
- Governed published datasets SHOULD be represented as `dcat:Dataset` records (in catalogs) and map to `:Dataset` nodes for graph discoverability.

### PROV-O
- Every ingest/transform/derive step is a `prov:Activity` mapped to `:Process`
- Inputs are `prov:used` ‚Üí `(:Process)-[:USED]->(:Item|:Asset)`
- Outputs are `prov:generated` ‚Üí `(:Process)-[:GENERATED]->(:Asset|:Dataset)`

Failures are still first-class provenance: a failed `:Process` still exists and still links to its inputs, with status and error facets captured by governance/telemetry systems.

---

## üß† Story Node & Focus Mode Integration

- Story Nodes anchor on `:Item` or `:Dataset`
- Lineage panels traverse:
  - `:DERIVED_FROM`
  - `:USED`
  - `:GENERATED`
- Focus Mode spatiotemporal queries rely on:
  - `acquisition_time`
  - tiling keys (`s2_cell_level_12` / `quadkey_z14`)
  - optional gazetteer joins (via API-layer traversal, not UI-side file reads)

This guarantees narrative traceability without recomputation.

---

## üß™ Validation & CI/CD

Violations MUST block promotion and/or ingestion.

**Non-negotiable rules**
- No `:Item` without provenance
- No `:Asset` without checksum
- No `:Dataset` without lineage
- No Story Node without graph anchoring

**Recommended CI checks**
- STAC schema validation (`data/stac/**`)
- PROV JSON-LD validation (`schemas/prov/**`)
- Neo4j constraints present and enforced
- Idempotent merge tests (dedupe + update semantics)

---

## ‚öñ FAIR+CARE & Governance

- All `:Asset` and `:Dataset` nodes MUST carry:
  - cryptographic checksums
  - provenance activities (`:Process`)
- Sensitive datasets MAY include:
  - `care_label`
  - `access_label`
- SBOM and SLSA attestations are mandatory for derived products
- NHPA ¬ß304 and Indigenous data flags propagate through lineage edges (the graph must allow queryable rights + sensitivity)

---

## üï∞Ô∏è Version History

| Version | Date | Notes |
|---|---:|---|
| v11.2.6 | 2025-12-13 | MDP v11.2.6 conformance pass (approved headings, directory layout, fenced blocks, governed footer). |

---

<div align="center">

**Docs** ¬∑ [üìò Docs Root](../README.md) ¬∑ [üèóÔ∏è Architecture](./README.md) ¬∑ [üß± Data Pipeline Contracts](../pipeline/README.md)  
**Governance** ¬∑ [‚öñ ROOT Governance](../standards/governance/ROOT-GOVERNANCE.md) ¬∑ [ü™∂ FAIR+CARE Guide](../standards/faircare/FAIRCARE-GUIDE.md) ¬∑ [üõ°Ô∏è Indigenous Data Protection](../standards/sovereignty/INDIGENOUS-DATA-PROTECTION.md)

</div>
