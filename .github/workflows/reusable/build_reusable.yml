# .github/workflows/reusable/build_reusable.yml
name: reusable_build
on:
  workflow_call:
    inputs:
      artifact_name: {type: string, required: true}
      package_dir:   {type: string, required: false, default: "."}
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - name: Build
        run: |
          make -C "${{ inputs.package_dir }}" build
          mkdir -p dist && cp "${{ inputs.package_dir }}/build/output.tgz" "dist/${{ inputs.artifact_name }}.tgz"
      - name: Generate SBOM (SPDX)
        run: |
          syft packages "${{ inputs.package_dir }}" -o spdx-json > "dist/${{ inputs.artifact_name }}.sbom.spdx.json"
      - uses: actions/upload-artifact@v4
        with: {name: "${{ inputs.artifact_name }}-bundle", path: dist}
