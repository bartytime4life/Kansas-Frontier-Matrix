# .github/release-drafter.yml
# -----------------------------------------------------------------------------
# Kansas Frontier Matrix (KFM) ‚Äî Release Drafter
#
# Notes:
# - This file must live on the default branch to be used by the Action/App.
# - Categories are label-driven; autolabeler helps apply labels based on paths.
# - Keep labels simple and stable (web/api/data/docs/graph/ci/security/ml/simulation/dependencies).
# -----------------------------------------------------------------------------

# üè∑Ô∏è Release naming & tags
name-template: 'v$RESOLVED_VERSION üåæ'
tag-template: 'v$RESOLVED_VERSION'
tag-prefix: 'v'

# üßæ How each PR entry renders
change-template: '- $TITLE ‚Äî #$NUMBER (@$AUTHOR)'
change-title-escapes: '\<*_&@#`' # prevents markdown surprises + disables @/# mentions
no-changes-template: '- No user-facing changes in this release.'

# üß† Sorting (keeps diffs stable & reviewer-friendly)
sort-by: 'title'
sort-direction: 'ascending'

# üö´ Exclusions (PRs with these labels will not appear in release notes)
exclude-labels:
  - 'skip-changelog'
  - 'no-release-notes'
  - 'meta'
  - 'internal-only'

# üßë‚Äçü§ù‚Äçüßë Don‚Äôt list bots as contributors
exclude-contributors:
  - 'dependabot'
  - 'dependabot[bot]'
  - 'github-actions'
  - 'github-actions[bot]'

# üß≠ Resolve the next version via labels (SemVer)
# Highest bump found in included PRs wins.
version-resolver:
  major:
    labels:
      - 'breaking-change'
      - 'semver:major'
      - 'major'
  minor:
    labels:
      - 'feature'
      - 'enhancement'
      - 'semver:minor'
      - 'minor'
  patch:
    labels:
      - 'bug'
      - 'fix'
      - 'perf'
      - 'refactor'
      - 'docs'
      - 'chore'
      - 'semver:patch'
      - 'patch'
  default: patch

# üß© Categorize PRs into release note sections (label-driven)
# Tip: If a PR has multiple labels, it may appear in multiple categories depending on your labeling discipline.
categories:
  - title: 'üí• Breaking changes'
    labels:
      - 'breaking-change'
      - 'semver:major'
      - 'major'

  - title: 'üîê Security'
    labels:
      - 'security'
      - 'sec'
      - 'vuln'
      - 'cve'

  - title: 'üóÉÔ∏è Data & Catalogs (STAC/DCAT/PROV)'
    labels:
      - 'data'
      - 'catalog'
      - 'stac'
      - 'dcat'
      - 'prov'

  - title: 'üï∏Ô∏è Graph & Ontology'
    labels:
      - 'graph'
      - 'neo4j'
      - 'ontology'

  - title: 'üö™ API Boundary'
    labels:
      - 'api'
      - 'backend'
      - 'server'

  - title: 'üó∫Ô∏è Web / UI'
    labels:
      - 'web'
      - 'ui'
      - 'frontend'
      - 'map'

  - title: 'üß™ Analysis / ML'
    labels:
      - 'ml'
      - 'ai'
      - 'analysis'
      - 'model'

  - title: 'üßÆ Simulation / Modeling'
    labels:
      - 'simulation'
      - 'modeling'
      - 'sim'

  - title: 'üß∞ CI / Infra / Ops'
    labels:
      - 'ci'
      - 'infra'
      - 'devops'
      - 'docker'

  - title: 'üìö Docs / SOPs'
    labels:
      - 'docs'
      - 'documentation'
      - 'sop'

  - title: '‚¨ÜÔ∏è Dependencies'
    collapse-after: 8
    labels:
      - 'dependencies'
      - 'deps'

# üßæ Release body framing (KFM ‚Äúevidence-first‚Äù posture)
header: |
  ## üåæ Kansas Frontier Matrix ‚Äî Release Notes

  > üßæ Drafted from merged PRs. Evidence-first, contract-first, governance-aware.
  >
  > ‚õìÔ∏è Pipeline: **ETL ‚Üí STAC/DCAT/PROV ‚Üí Graph ‚Üí API ‚Üí UI ‚Üí Story Nodes ‚Üí Focus Mode**

template: |
  ## ‚úÖ Changes
  $CHANGES

  ## üßë‚Äçü§ù‚Äçüßë Contributors
  $CONTRIBUTORS

footer: |
  ## üîé Governance reminders
  - Data/analysis/simulation outputs should be **cataloged** (STAC/DCAT/PROV) before publication.
  - Prefer **pointers over payloads** for large artifacts; keep provenance links intact.
  - If a change affects policy/redaction/classification, treat it as a **high-scrutiny** release item.

# ü§ñ Autolabeler: apply labels automatically based on touched paths (glob matching)
# Label must exist in the repo for automatic labeling to work.
autolabeler:
  - label: 'web'
    files:
      - 'web/**'

  - label: 'api'
    files:
      - 'api/**'

  - label: 'data'
    files:
      - 'data/**'

  - label: 'docs'
    files:
      - 'docs/**'
      - '**/*.md'

  - label: 'graph'
    files:
      - 'src/graph/**'
      - 'data/graph/**'

  - label: 'ci'
    files:
      - '.github/workflows/**'
      - '.github/actions/**'
      - 'tools/validation/**'
      - '.pre-commit-config.yaml'

  - label: 'security'
    files:
      - 'SECURITY.md'
      - 'docs/security/**'
      - 'docs/governance/**'
      - '.github/ISSUE_TEMPLATE/**'

  - label: 'ml'
    files:
      - 'mcp/**'
      - 'notebooks/**'

  - label: 'simulation'
    files:
      - 'mcp/**/simulation/**'
      - 'api/src/**/simulation/**'
      - 'src/**/simulation/**'

  # If a PR only touches lockfiles/manifests, mark as dependencies.
  - label: 'dependencies'
    files:
      - '**/package-lock.json'
      - '**/pnpm-lock.yaml'
      - '**/yarn.lock'
      - '**/requirements*.txt'
      - '**/poetry.lock'
      - '**/Pipfile.lock'
      - '**/Cargo.lock'
      - '**/go.mod'
      - '**/go.sum'
      - '**/Gemfile.lock'
      - '**/composer.lock'
      - '.github/dependabot.yml'
```

