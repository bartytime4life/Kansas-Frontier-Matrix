# .github/release-drafter.yml
# -----------------------------------------------------------------------------
# Kansas Frontier Matrix (KFM) â€” Release Drafter
#
# ğŸ¯ Auto-draft release notes from merged PRs using labels + path-aware autolabeling.
# â›“ï¸ Pipeline framing: ETL â†’ Metadata (STAC/DCAT/PROV) â†’ Graph â†’ API â†’ UI â†’ Story Nodes â†’ Focus Mode
# ğŸ›¡ï¸ Posture: evidence-first â€¢ deny-by-default for promotion â€¢ supply-chain aware
#
# Label strategy (recommended):
# - 1x "type:*" label (intent)  + 1+ "area:*" labels (surface)
# - Use "governance:*" labels when policy/sensitivity/classification is involved
# - Keep labels stable; release notes are only as good as label hygiene
# -----------------------------------------------------------------------------

commitish: "main"
filter-by-commitish: true

# ğŸ·ï¸ Release naming & tags
name-template: "v$RESOLVED_VERSION ğŸŒ¾"
tag-template: "v$RESOLVED_VERSION"
tag-prefix: "v"

# ğŸ§¾ How each PR entry renders
change-template: "- $TITLE â€” #$NUMBER (@$AUTHOR)"
change-title-escapes: "\\<*_&@#`"
no-changes-template: "- No user-facing changes in this release."

# ğŸ§  Sorting (keeps diffs stable & reviewer-friendly)
sort-by: "merged_at"
sort-direction: "descending"

# ğŸš« Exclusions (PRs with these labels will not appear in release notes)
exclude-labels:
  - "skip-changelog"
  - "no-release-notes"
  - "meta"
  - "internal-only"
  - "status:wip"
  - "status:blocked"
  - "do-not-merge"

# ğŸ§‘â€ğŸ¤â€ğŸ§‘ Donâ€™t list bots as contributors
exclude-contributors:
  - "dependabot"
  - "dependabot[bot]"
  - "github-actions"
  - "github-actions[bot]"
  - "renovate"
  - "renovate[bot]"

# ğŸ§­ Resolve the next version via labels (SemVer)
# Highest bump found in included PRs wins.
version-resolver:
  major:
    labels:
      - "breaking-change"
      - "semver:major"
      - "major"
  minor:
    labels:
      - "semver:minor"
      - "minor"
      - "type:feature"
      - "feature"
      - "enhancement"
  patch:
    labels:
      - "semver:patch"
      - "patch"
      - "type:bug"
      - "bug"
      - "fix"
      - "perf"
      - "refactor"
      - "type:docs"
      - "docs"
      - "type:data"
      - "data"
      - "type:pipeline"
      - "pipeline"
      - "type:security"
      - "security"
      - "type:chore"
      - "chore"
      - "dependencies"
      - "deps"
  default: "patch"

# ğŸ§© Categorize PRs into release note sections (label-driven)
# Tip: Prefer 1x "type:*" per PR to keep categories clean.
categories:
  - title: "ğŸ’¥ Breaking changes"
    labels:
      - "breaking-change"
      - "semver:major"
      - "major"

  - title: "ğŸ” Security & governance"
    labels:
      - "type:security"
      - "security"
      - "sec"
      - "vuln"
      - "cve"
      - "governance:privacy"
      - "governance:sensitive-locations"
      - "governance:sovereignty"
      - "governance:license"
      - "policy"
      - "policy-gate"

  - title: "ğŸ§° ETL & pipelines"
    labels:
      - "type:pipeline"
      - "pipeline"
      - "etl"
      - "ingest"
      - "area:pipeline"

  - title: "ğŸ—ƒï¸ Data & catalogs (STAC/DCAT/PROV)"
    labels:
      - "type:data"
      - "data"
      - "catalog"
      - "area:catalog"
      - "stac"
      - "area:stac"
      - "dcat"
      - "area:dcat"
      - "prov"
      - "area:prov"

  - title: "ğŸ•¸ï¸ Graph & ontology"
    labels:
      - "graph"
      - "neo4j"
      - "ontology"
      - "area:graph"

  - title: "ğŸ”Œ API boundary"
    labels:
      - "api"
      - "backend"
      - "server"
      - "area:api"

  - title: "ğŸŒ Web / UI"
    labels:
      - "web"
      - "ui"
      - "frontend"
      - "map"
      - "webgl"
      - "area:web"

  - title: "ğŸ¬ Story nodes & narrative"
    labels:
      - "type:story"
      - "story"
      - "narrative"
      - "area:story"

  - title: "ğŸ§  Focus mode & analytics"
    labels:
      - "focus"
      - "focus-mode"
      - "analysis"
      - "ml"
      - "ai"
      - "model"

  - title: "ğŸ§« Simulation / modeling"
    labels:
      - "simulation"
      - "modeling"
      - "sim"

  - title: "ğŸ§° CI / infra / ops"
    labels:
      - "ci"
      - "infra"
      - "devops"
      - "docker"
      - "area:db"

  - title: "ğŸ“š Docs / SOPs"
    labels:
      - "type:docs"
      - "docs"
      - "documentation"
      - "sop"
      - "area:docs"

  - title: "â¬†ï¸ Dependencies"
    collapse-after: 8
    labels:
      - "dependencies"
      - "deps"

  - title: "ğŸ§¹ Chores"
    labels:
      - "type:chore"
      - "chore"
      - "build"
      - "maintenance"

# ğŸ§¾ Release body framing (KFM â€œevidence-firstâ€ posture)
header: |
  ## ğŸŒ¾ Kansas Frontier Matrix â€” Release Notes

  > ğŸ§¾ Drafted from merged PRs (label-driven). Evidence-first â€¢ contract-first â€¢ governance-aware.
  >
  > â›“ï¸ Pipeline: **ETL â†’ Metadata (STAC/DCAT/PROV) â†’ Graph â†’ API â†’ UI â†’ Story Nodes â†’ Focus Mode**

template: |
  ## âœ… Changes
  $CHANGES

  ## ğŸ§‘â€ğŸ¤â€ğŸ§‘ Contributors
  $CONTRIBUTORS

footer: |
  ## ğŸ” Governance reminders
  - Promotion-critical outputs (data, catalogs, models, stories) must be **traceable**: STAC/DCAT/PROV + checksums where appropriate.
  - Prefer **pointers over payloads** for large artifacts; attach run evidence in CI artifacts.
  - If a change affects policy/redaction/classification, treat it as **high-scrutiny** and ensure policy gates passed.

# ğŸ” Optional: linkify CVE IDs in PR titles
replacers:
  - search: "/CVE-(\\d{4})-(\\d+)/g"
    replace: "[CVE-$1-$2](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-$1-$2)"

# ğŸ¤– Autolabeler: apply labels automatically based on touched paths (glob matching)
# Label must exist in the repo for automatic labeling to work.
autolabeler:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸŒ Surfaces (area:* + legacy labels)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - label: "area:web"
    files:
      - "web/**"
  - label: "web"
    files:
      - "web/**"

  - label: "area:api"
    files:
      - "api/**"
  - label: "api"
    files:
      - "api/**"

  - label: "area:graph"
    files:
      - "src/graph/**"
      - "data/graph/**"
      - "docs/ontology/**"
  - label: "graph"
    files:
      - "src/graph/**"
      - "data/graph/**"
      - "docs/ontology/**"

  - label: "area:db"
    files:
      - "**/*.sql"
      - "api/**/migrations/**"
      - "api/**/alembic/**"
      - "docker-compose.yml"
  - label: "postgis"
    files:
      - "api/**/migrations/**"
      - "docker-compose.yml"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ—ƒï¸ Data + catalogs + provenance
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - label: "type:data"
    files:
      - "data/**"
  - label: "data"
    files:
      - "data/**"

  - label: "area:catalog"
    files:
      - "data/catalog/**"
      - "data/stac/**"
      - "data/**/catalog/**"
  - label: "catalog"
    files:
      - "data/catalog/**"
      - "data/stac/**"
      - "data/**/catalog/**"

  - label: "area:stac"
    files:
      - "**/collection.json"
      - "**/catalog.json"
      - "data/**/stac/**"
  - label: "stac"
    files:
      - "**/collection.json"
      - "**/catalog.json"
      - "data/**/stac/**"

  - label: "area:dcat"
    files:
      - "data/**/dcat/**"
      - "data/catalog/dcat/**"
  - label: "dcat"
    files:
      - "data/**/dcat/**"
      - "data/catalog/dcat/**"

  - label: "area:prov"
    files:
      - "data/prov/**"
      - "data/provenance/**"
  - label: "prov"
    files:
      - "data/prov/**"
      - "data/provenance/**"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§° Tooling / pipelines / automation
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - label: "type:pipeline"
    files:
      - "tools/**"
      - "src/pipelines/**"
      - "api/scripts/**"
      - "scripts/**"
      - ".github/workflows/**"
      - ".github/actions/**"
  - label: "ci"
    files:
      - ".github/workflows/**"
      - ".github/actions/**"
      - ".github/dependabot.yml"
      - ".pre-commit-config.yaml"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ¬ Narrative layer
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - label: "type:story"
    files:
      - "docs/reports/story_nodes/**"
      - "web/story_nodes/**"
  - label: "story"
    files:
      - "docs/reports/story_nodes/**"
      - "web/story_nodes/**"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“š Documentation
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - label: "type:docs"
    files:
      - "docs/**"
      - ".github/*.md"
      - "README.md"
      - "**/*.md"
      - "**/*.mdx"
  - label: "docs"
    files:
      - "docs/**"
      - ".github/*.md"
      - "README.md"

  # Large reference PDFs are usually not release-note worthy
  - label: "internal-only"
    files:
      - "docs/library/**"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§‘â€âš–ï¸ Governance / policy gates (OPA/Conftest)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - label: "policy"
    files:
      - "tools/validation/policy/**"
      - "policies/**"

  - label: "governance:license"
    files:
      - "tools/validation/policy/rego/**/license_allowlist.rego"
      - "tools/validation/policy/rego/governance/attribution.rego"

  - label: "governance:sensitive-locations"
    files:
      - "tools/validation/policy/rego/governance/sensitive_locations.rego"

  - label: "governance:sovereignty"
    files:
      - "tools/validation/policy/rego/governance/classification_propagation.rego"
      - ".kfm/**"

  # Supply chain policy and gates
  - label: "supply-chain"
    files:
      - "tools/validation/policy/rego/supply_chain/**"
      - ".github/workflows/sbom.yml"
      - ".github/workflows/attest.yml"
      - ".github/actions/sbom/**"
      - ".github/actions/attest/**"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â¬†ï¸ Dependency-only changes
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - label: "dependencies"
    files:
      - "**/package-lock.json"
      - "**/pnpm-lock.yaml"
      - "**/yarn.lock"
      - "**/requirements*.txt"
      - "**/poetry.lock"
      - "**/Pipfile.lock"
      - "**/Cargo.lock"
      - "**/go.mod"
      - "**/go.sum"
      - "**/Gemfile.lock"
      - "**/composer.lock"
      - ".github/dependabot.yml"
