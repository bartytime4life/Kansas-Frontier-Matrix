# ğŸ¤– Dependabot Governance & Supplyâ€‘Chain Hygiene ğŸ›¡ï¸

![Dependabot](https://img.shields.io/badge/Dependabot-enabled-brightgreen?logo=dependabot)
![Cadence](https://img.shields.io/badge/Cadence-weekly%20(Mon%2006%3A00%20CT)-blue)
![Scopes](https://img.shields.io/badge/Scopes-actions%20%7C%20docker%20%7C%20compose%20%7C%20npm%20%7C%20pip-purple)

> [!IMPORTANT]
> This document is **copy/paste-ready** for the Kansasâ€‘Matrixâ€‘System repo structure and operating style: **small frequent updates**, **clear governance**, **security-first**, and **CI-gated merges**. âœ…

---

## ğŸ¯ What this config optimizes for

### âœ… Outcomes
- **Predictable weekly cadence** (Mon @ 06:00 America/Chicago) â°
- **Noise control** via **grouping minor + patch** updates into fewer PRs ğŸ§¹
- **Major updates stay visible** as separate PRs (intentionally) ğŸš¨
- **Security updates stay urgent** and can be **batched** per ecosystem (opt-in) ğŸ”
- **Conventional-commits friendly** commit messages (`chore(deps): â€¦`) ğŸ§¾
- **Stabilization window** via cooldown so brandâ€‘new releases donâ€™t immediately churn the repo ğŸ§Š

---

## ğŸ—ºï¸ Coverage map

| Surface | Ecosystem | Directory | What gets updated | PR shape |
|---|---|---:|---|---|
| CI/CD | `github-actions` | `/` | workflow action versions | grouped minor/patch + optional security batch |
| Containers | `docker` | `/` | Dockerfile base images | grouped minor/patch |
| Compose | `docker-compose` | `/` | compose image tags | grouped minor/patch |
| Web | `npm` | `/web` | frontend deps | grouped minor/patch split by prod/dev + optional security batch |
| API | `pip` | `/src/server/api` | backend deps | grouped minor/patch split by prod/dev + optional security batch |

---

## ğŸ—‚ï¸ Assumed repo shape (for alignment) ğŸ“¦

```text
ğŸ“¦ repo-root
â”œâ”€ .github/
â”‚  â””â”€ dependabot.yml     ğŸ‘ˆ (this file)
â”œâ”€ web/                  ğŸŒ React/TS app
â”‚  â”œâ”€ package.json
â”‚  â””â”€ (lockfile)
â””â”€ src/
   â””â”€ server/
      â””â”€ api/             ğŸ FastAPI
         â”œâ”€ requirements*.txt and/or pyproject.toml
         â””â”€ (lockfile)
```

---

## âœ… Dropâ€‘in `.github/dependabot.yml`

> [!TIP]
> This version avoids hardcoding custom labels (so you keep GitHubâ€™s default Dependabot labels).  
> If you want custom label routing, see the **Optional Enhancements** section below. ğŸ·ï¸

```yaml
version: 2

# ğŸ” Optional: private registries (uncomment + configure only if you need them)
# registries:
#   ghcr:
#     type: docker-registry
#     url: https://ghcr.io
#     username: YOUR_USERNAME_OR_TOKEN_USER
#     password: ${{ secrets.DEPENDABOT_GHCR_TOKEN }}
#
#   npm-private:
#     type: npm-registry
#     url: https://registry.npmjs.org
#     token: ${{ secrets.DEPENDABOT_NPM_TOKEN }}
#
#   pypi-private:
#     type: python-index
#     url: https://pypi.org/simple
#     token: ${{ secrets.DEPENDABOT_PYPI_TOKEN }}

updates:
  # ğŸ§© GitHub Actions (workflow dependencies)
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 5
    pull-request-branch-name:
      # "-" must be quoted so YAML doesn't parse it as a list item
      separator: "-"
    commit-message:
      # Conventional commits friendly:
      #   chore(deps): bump â€¦
      prefix: "chore"
      include: "scope"
    groups:
      actions-minor-patch:
        patterns:
          - "*"
        update-types:
          - "minor"
          - "patch"
      # âœ… Optional: batch any security PRs for this ecosystem
      actions-security:
        applies-to: "security-updates"
        patterns:
          - "*"

  # ğŸ³ Dockerfiles (base images pinned in Dockerfiles under /)
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 5
    pull-request-branch-name:
      separator: "-"
    commit-message:
      prefix: "chore"
      include: "scope"
    cooldown:
      # ğŸ§Š Stabilization window (helps avoid "release just dropped" churn)
      semver-patch-days: 3
      semver-minor-days: 7
      semver-major-days: 14
    groups:
      docker-minor-patch:
        patterns:
          - "*"
        update-types:
          - "minor"
          - "patch"

  # ğŸ§± Docker Compose (compose.yml / docker-compose.yml in /)
  - package-ecosystem: "docker-compose"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 5
    pull-request-branch-name:
      separator: "-"
    commit-message:
      prefix: "chore"
      include: "scope"
    cooldown:
      semver-patch-days: 3
      semver-minor-days: 7
      semver-major-days: 14
    groups:
      compose-minor-patch:
        patterns:
          - "*"
        update-types:
          - "minor"
          - "patch"

  # ğŸŒ Web Frontend (React/TS) â€” package.json in /web
  - package-ecosystem: "npm"
    directory: "/web"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 10
    pull-request-branch-name:
      separator: "-"
    commit-message:
      prefix: "chore"
      include: "scope"
    cooldown:
      semver-patch-days: 3
      semver-minor-days: 7
      semver-major-days: 14
    groups:
      # âœ… Keep production and dev updates separate for cleaner risk review
      web-prod-minor-patch:
        dependency-type: "production"
        patterns:
          - "*"
        update-types:
          - "minor"
          - "patch"
      web-dev-minor-patch:
        dependency-type: "development"
        patterns:
          - "*"
        update-types:
          - "minor"
          - "patch"

      # âœ… Optional: batch security updates (fast triage, fewer PRs)
      web-security-prod:
        applies-to: "security-updates"
        dependency-type: "production"
        patterns:
          - "*"
      web-security-dev:
        applies-to: "security-updates"
        dependency-type: "development"
        patterns:
          - "*"

  # ğŸ API (FastAPI) â€” dependency manifests under /src/server/api
  - package-ecosystem: "pip"
    directory: "/src/server/api"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "America/Chicago"
    open-pull-requests-limit: 10
    pull-request-branch-name:
      separator: "-"
    commit-message:
      prefix: "chore"
      include: "scope"
    cooldown:
      # If pip versions aren't semver-clean, "default-days" still provides a buffer.
      default-days: 3
      semver-patch-days: 3
      semver-minor-days: 7
      semver-major-days: 14
    groups:
      api-prod-minor-patch:
        dependency-type: "production"
        patterns:
          - "*"
        update-types:
          - "minor"
          - "patch"
      api-dev-minor-patch:
        dependency-type: "development"
        patterns:
          - "*"
        update-types:
          - "minor"
          - "patch"

      # âœ… Optional: batch security updates
      api-security-prod:
        applies-to: "security-updates"
        dependency-type: "production"
        patterns:
          - "*"
      api-security-dev:
        applies-to: "security-updates"
        dependency-type: "development"
        patterns:
          - "*"

  # â• Optional: enable if you keep separate Python manifests under /src/pipelines
  # - package-ecosystem: "pip"
  #   directory: "/src/pipelines"
  #   schedule:
  #     interval: "weekly"
  #     day: "monday"
  #     time: "06:00"
  #     timezone: "America/Chicago"
  #   open-pull-requests-limit: 10
  #   pull-request-branch-name:
  #     separator: "-"
  #   commit-message:
  #     prefix: "chore"
  #     include: "scope"
  #   cooldown:
  #     default-days: 3
  #     semver-patch-days: 3
  #     semver-minor-days: 7
  #     semver-major-days: 14
  #   groups:
  #     pipelines-prod-minor-patch:
  #       dependency-type: "production"
  #       patterns:
  #         - "*"
  #       update-types:
  #         - "minor"
  #         - "patch"
  #     pipelines-dev-minor-patch:
  #       dependency-type: "development"
  #       patterns:
  #         - "*"
  #       update-types:
  #         - "minor"
  #         - "patch"
  #     pipelines-security-prod:
  #       applies-to: "security-updates"
  #       dependency-type: "production"
  #       patterns:
  #         - "*"
  #     pipelines-security-dev:
  #       applies-to: "security-updates"
  #       dependency-type: "development"
  #       patterns:
  #         - "*"
```

---

## ğŸ§  Governance rules (how to treat these PRs)

### ğŸŸ¢ Patch updates (default â€œsafeâ€ lane)
- Merge after CI passes âœ…
- Prefer auto-merge (optional workflow below) ğŸ¤

### ğŸŸ¡ Minor updates (controlled evolution)
- Merge after CI passes âœ…
- Quick smoke test for runtime-critical paths ğŸ”

### ğŸ”´ Major updates (intentional change)
- Treat like a feature PR: review release notes + run full test suite ğŸ§ª
- Prefer dedicated PRs (Dependabot will do this automatically since majors arenâ€™t in the minor/patch groups) ğŸš¨

> [!NOTE]
> Grouping intentionally **does not hide majors** â€” it isolates them.

---

## âœ… Review checklist (fast, consistent, reproducible)

- [ ] CI is green âœ…
- [ ] Lockfiles updated and consistent ğŸ”’
- [ ] No suspicious transitive dependency changes (scan PR diff) ğŸ§¬
- [ ] For API: run minimal contract checks (FastAPI startup, import graph) ğŸ§ª
- [ ] For Web: build + basic runtime check (bundle + minimal smoke) ğŸŒ
- [ ] For Docker: image still builds (and base tag moves as expected) ğŸ³

---

## ğŸ§° Optional Enhancements (recommended) ğŸ”¥

<details>
<summary>ğŸ¤ Auto-merge Dependabot patch PRs (CI-gated)</summary>

> [!IMPORTANT]
> This is **optional** and should be enabled only after your required checks are solid.

Create: `.github/workflows/dependabot-automerge.yml`

```yaml
name: Dependabot auto-merge

on: pull_request

permissions:
  contents: write
  pull-requests: write

jobs:
  dependabot:
    runs-on: ubuntu-latest
    if: github.event.pull_request.user.login == 'dependabot[bot]'
    steps:
      - name: Dependabot metadata
        id: metadata
        uses: dependabot/fetch-metadata@v2
        with:
          github-token: "${{ secrets.GITHUB_TOKEN }}"

      - name: Enable auto-merge for patch updates
        if: steps.metadata.outputs.update-type == 'version-update:semver-patch'
        run: gh pr merge --auto --merge "$PR_URL"
        env:
          PR_URL: ${{ github.event.pull_request.html_url }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

âœ… Result: Dependabot patch PRs will merge automatically **once branch protection + CI checks pass**.

</details>

<details>
<summary>ğŸ·ï¸ Label routing (if you want better triage)</summary>

Dependabot can apply custom labels, but defining `labels:` in `dependabot.yml` **replaces** GitHubâ€™s defaults.

**Recommended approach:** keep Dependabot defaults, then label via a small workflow using `dependabot/fetch-metadata` (see GitHub Docs).  
This lets you label:
- `area:web` vs `area:api`
- `deps:prod` vs `deps:dev`
- `deps:major/minor/patch`

</details>

<details>
<summary>ğŸ§© Multi-ecosystem â€œsingle PRâ€ batches (advanced / future)</summary>

If you ever want **one PR per week** that updates multiple ecosystems together, GitHub supports **multi-ecosystem updates**.

This is powerful but can make PRs larger. Only enable once your CI is very strong. âœ…

</details>

---

## ğŸ§¾ TL;DR

âœ… This setup is â€œboringly reliableâ€:
- weekly,
- grouped minor/patch,
- majors isolated,
- optional security batching,
- conventional commits,
- cooldown buffer.

Ship small. Ship often. Verify with CI. ğŸ§ âœ…