{
  "id": "fema_disasters",
  "title": "FEMA Declarations (KS)",
  "type": "vector",
  "format": "geojson",
  "data": "data/processed/fema_disasters_ks.json",
  "category": "hazards",

  "version": "1.4",
  "generated": "2025-09-28T00:00:00Z",

  "time": { "start": "1953-01-01", "end": null },
  "timeProperty": { "start": "declaration_date", "end": null, "format": "date" },

  "bounds": [-102.051, 36.993, -94.588, 40.003],
  "minzoom": 5,
  "maxzoom": 19,
  "visible": false,
  "opacity": 1.0,

  "popup": [
    "declaration_title",
    "incident_type",
    "declaration_type",
    "disaster_number",
    "declaration_date",
    "county",
    "fips",
    "url"
  ],

  "legend": {
    "type": "circle",
    "label": "Incident type",
    "classes": [
      { "label": "Flood",           "fill": "#2A9D8F", "stroke": "#ffffff" },
      { "label": "Severe Storm(s)", "fill": "#457B9D", "stroke": "#ffffff" },
      { "label": "Tornado",         "fill": "#E76F51", "stroke": "#ffffff" },
      { "label": "Fire",            "fill": "#9B2226", "stroke": "#ffffff" },
      { "label": "Drought",         "fill": "#F4A261", "stroke": "#ffffff" },
      { "label": "Other/Unknown",   "fill": "#6D6875", "stroke": "#ffffff" }
    ]
  },

  "style": {
    "renderer": "circle",

    "circleColor": {
      "match": {
        "property": "incident_type",
        "stops": [
          ["Flood",           "#2A9D8F"],
          ["Severe Storm(s)", "#457B9D"],
          ["Tornado",         "#E76F51"],
          ["Fire",            "#9B2226"],
          ["Drought",         "#F4A261"]
        ],
        "default": "#6D6875"
      }
    },

    "circleRadiusByZoom": [
      { "zoom": 5,  "radius": 3.0 },
      { "zoom": 8,  "radius": 4.2 },
      { "zoom": 12, "radius": 5.6 },
      { "zoom": 15, "radius": 6.8 }
    ],
    "circleOpacity": 0.92,
    "circleStrokeColor": "#ffffff",
    "circleStrokeWidth": 0.8,

    "hover": {
      "circleStrokeColor": "#111827",
      "circleStrokeWidthDelta": 0.8
    },
    "selection": {
      "circleStrokeColor": "#111827",
      "circleStrokeWidthDelta": 1.2
    }
  },

  "cluster": {
    "enabled": true,
    "radius": 40,
    "maxZoom": 12,
    "style": {
      "circleColor": "#444444",
      "circleOpacity": 0.75,
      "circleStrokeColor": "#ffffff",
      "circleStrokeWidth": 1.0,
      "circleRadius": {
        "stops": [[5, 10], [50, 16], [200, 22]],
        "property": "point_count",
        "type": "exponential",
        "base": 1.2
      },
      "textField": "{point_count_abbreviated}",
      "textSize": 11,
      "textColor": "#ffffff"
    }
  },

  "fields": {
    "disaster_number":   { "type": "string", "description": "FEMA disaster number" },
    "incident_type":     { "type": "string", "description": "Event type (e.g., Flood, Severe Storm(s), Tornado, Fire, Drought)" },
    "declaration_date":  { "type": "string", "format": "date", "description": "Date of declaration (ISO 8601)" },
    "declaration_title": { "type": "string", "description": "Short title of declaration (optional but recommended)" },
    "declaration_type":  { "type": "string", "description": "Type (e.g., 'Major Disaster', 'Emergency')" },
    "county":            { "type": "string", "description": "County name (centroid point)" },
    "state":             { "type": "string", "description": "State code (KS)" },
    "fips":              { "type": "string", "description": "County FIPS (optional)" },
    "url":               { "type": "string", "format": "uri", "description": "Link to FEMA OpenFEMA record (optional)" }
  },

  "filters": {
    "quick": [
      { "label": "Flood",           "where": { "incident_type": "Flood" } },
      { "label": "Severe Storm(s)", "where": { "incident_type": "Severe Storm(s)" } },
      { "label": "Tornado",         "where": { "incident_type": "Tornado" } },
      { "label": "Fire",            "where": { "incident_type": "Fire" } },
      { "label": "Drought",         "where": { "incident_type": "Drought" } },
      { "label": "Since 2000",      "where": { "declaration_date$gte": "2000-01-01" } },
      { "label": "1953–1999",       "where": { "all": [{ "declaration_date$gte": "1953-01-01" }, { "declaration_date$lt": "2000-01-01" }] } }
    ],
    "advanced": {
      "dateRangeField": "declaration_date",
      "groupBy": ["incident_type", "declaration_type", "county"]
    }
  },

  "search": {
    "qFields": ["incident_type", "county", "declaration_title", "disaster_number"],
    "accentFold": true,
    "minLength": 2,
    "placeholder": "Search FEMA (e.g., Flood 1993, DR-4603)"
  },

  "ordering": {
    "zindex": 520,
    "before": "plss_parcels",
    "after": "ks_hydro"
  },

  "attribution": "© FEMA OpenFEMA",
  "license": "Public Domain / US Government data",

  "provenance": {
    "source": "FEMA OpenFEMA — Disaster Declarations Summaries (filtered to Kansas)",
    "retrieved": "2025-09-26T00:00:00Z",
    "notes": "County-level centroids; dates normalized to ISO 8601; incident types mapped to categorical colors"
  },

  "kfm_meta": {
    "schema_version": "1.1",
    "popup": ["declaration_title", "incident_type", "declaration_type", "disaster_number", "declaration_date", "county", "fips", "url"],
    "stac": {
      "collection": "kfm-hazards",
      "item": "fema_disasters_ks_points"
    }
  },

  "alternates": {
    "data_fallbacks": [
      { "format": "pmtiles", "url": "web/tiles/fema_disasters_ks.pmtiles", "note": "Use when present for clustering at scale" },
      { "format": "geojson", "url": "data/processed/fema_disasters_ks.json" }
    ]
  },

  "type_overrides": {
    "icon": {
      "match": {
        "property": "incident_type",
        "stops": [
          ["Flood", "water"],
          ["Severe Storm(s)", "wind"],
          ["Tornado", "tornado"],
          ["Fire", "fire"],
          ["Drought", "droplet-slash"]
        ],
        "default": "alert"
      }
    }
  }
}
