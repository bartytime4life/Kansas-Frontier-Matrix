{
  "id": "fema_disasters_ks",
  "title": "FEMA Disaster Declarations — Kansas",
  "type": "vector",
  "format": "geojson",
  "data": "web/data/fema_disasters_ks.json",

  "category": "hazards",
  "version": "1.3",
  "generated": "2025-09-28T00:00:00Z",

  "time": { "start": "1950-01-01", "end": null },
  "timeProperty": { "start": "declaration_date", "end": null, "format": "date" },

  "bounds": [-102.051, 36.993, -94.588, 40.003],
  "minzoom": 5,
  "maxzoom": 19,
  "visible": true,
  "opacity": 1.0,

  "popup": [
    "declaration_title",
    "incident_type",
    "declaration_type",
    "disaster_number",
    "declaration_date",
    "county",
    "fips",
    "url"
  ],

  "legend": {
    "type": "point",
    "label": "FEMA Disaster Declarations (by incident type)",
    "classes": [
      { "label": "Flood",           "fill": "#2563eb", "stroke": "#1d4ed8" },
      { "label": "Severe Storm(s)", "fill": "#10b981", "stroke": "#059669" },
      { "label": "Tornado",         "fill": "#f59e0b", "stroke": "#d97706" },
      { "label": "Fire",            "fill": "#ef4444", "stroke": "#dc2626" },
      { "label": "Drought",         "fill": "#a78bfa", "stroke": "#7c3aed" },
      { "label": "Other/Unknown",   "fill": "#6b7280", "stroke": "#4b5563" }
    ]
  },

  "style": {
    "renderer": "sublayers",
    "cluster": {
      "enabled": true,
      "clusterRadius": 36,
      "minzoom": 5,
      "maxzoom": 12,
      "label": "{point_count}",
      "fillColor": "#60a5fa",
      "fillOpacity": 0.75,
      "lineColor": "#1d4ed8",
      "lineWidth": 1.0
    },
    "sublayers": [
      {
        "id": "fema_points_flood",
        "filter": { "incident_type": "Flood" },
        "symbol": "circle",
        "circleColor": "#2563eb",
        "circleOpacity": 0.9,
        "circleStrokeColor": "#1d4ed8",
        "circleStrokeWidthByZoom": [
          { "zoom": 5, "width": 0.3 },
          { "zoom": 10, "width": 0.8 },
          { "zoom": 14, "width": 1.2 }
        ],
        "circleRadiusByZoom": [
          { "zoom": 5, "radius": 3.2 },
          { "zoom": 10, "radius": 5.0 },
          { "zoom": 14, "radius": 6.5 }
        ]
      },
      {
        "id": "fema_points_storm",
        "filter": { "incident_type": "Severe Storm(s)" },
        "symbol": "circle",
        "circleColor": "#10b981",
        "circleOpacity": 0.9,
        "circleStrokeColor": "#059669",
        "circleStrokeWidthByZoom": [
          { "zoom": 5, "width": 0.3 },
          { "zoom": 10, "width": 0.8 },
          { "zoom": 14, "width": 1.2 }
        ],
        "circleRadiusByZoom": [
          { "zoom": 5, "radius": 3.2 },
          { "zoom": 10, "radius": 5.0 },
          { "zoom": 14, "radius": 6.5 }
        ]
      },
      {
        "id": "fema_points_tornado",
        "filter": { "incident_type": "Tornado" },
        "symbol": "circle",
        "circleColor": "#f59e0b",
        "circleOpacity": 0.9,
        "circleStrokeColor": "#d97706",
        "circleStrokeWidthByZoom": [
          { "zoom": 5, "width": 0.3 },
          { "zoom": 10, "width": 0.8 },
          { "zoom": 14, "width": 1.2 }
        ],
        "circleRadiusByZoom": [
          { "zoom": 5, "radius": 3.2 },
          { "zoom": 10, "radius": 5.0 },
          { "zoom": 14, "radius": 6.5 }
        ]
      },
      {
        "id": "fema_points_fire",
        "filter": { "incident_type": "Fire" },
        "symbol": "circle",
        "circleColor": "#ef4444",
        "circleOpacity": 0.9,
        "circleStrokeColor": "#dc2626",
        "circleStrokeWidthByZoom": [
          { "zoom": 5, "width": 0.3 },
          { "zoom": 10, "width": 0.8 },
          { "zoom": 14, "width": 1.2 }
        ],
        "circleRadiusByZoom": [
          { "zoom": 5, "radius": 3.2 },
          { "zoom": 10, "radius": 5.0 },
          { "zoom": 14, "radius": 6.5 }
        ]
      },
      {
        "id": "fema_points_drought",
        "filter": { "incident_type": "Drought" },
        "symbol": "circle",
        "circleColor": "#a78bfa",
        "circleOpacity": 0.9,
        "circleStrokeColor": "#7c3aed",
        "circleStrokeWidthByZoom": [
          { "zoom": 5, "width": 0.3 },
          { "zoom": 10, "width": 0.8 },
          { "zoom": 14, "width": 1.2 }
        ],
        "circleRadiusByZoom": [
          { "zoom": 5, "radius": 3.2 },
          { "zoom": 10, "radius": 5.0 },
          { "zoom": 14, "radius": 6.5 }
        ]
      },
      {
        "id": "fema_points_other",
        "filter": { "not": { "incident_type": ["Flood", "Severe Storm(s)", "Tornado", "Fire", "Drought"] } },
        "symbol": "circle",
        "circleColor": "#6b7280",
        "circleOpacity": 0.9,
        "circleStrokeColor": "#4b5563",
        "circleStrokeWidthByZoom": [
          { "zoom": 5, "width": 0.3 },
          { "zoom": 10, "width": 0.8 },
          { "zoom": 14, "width": 1.2 }
        ],
        "circleRadiusByZoom": [
          { "zoom": 5, "radius": 3.2 },
          { "zoom": 10, "radius": 5.0 },
          { "zoom": 14, "radius": 6.5 }
        ]
      }
    ],
    "hover": {
      "circleStrokeColor": "#111827",
      "circleStrokeWidthDelta": 0.8
    },
    "selection": {
      "circleStrokeColor": "#111827",
      "circleStrokeWidthDelta": 1.2
    }
  },

  "fields": {
    "disaster_number":   { "type": "string", "description": "FEMA disaster number" },
    "incident_type":     { "type": "string", "description": "Event type (Flood, Severe Storm(s), Tornado, Fire, Drought, etc.)" },
    "declaration_date":  { "type": "string", "format": "date", "description": "ISO 8601 date" },
    "declaration_title": { "type": "string", "description": "Short title (optional)" },
    "declaration_type":  { "type": "string", "description": "Major Disaster / Emergency / Fire Mgmt Assistance" },
    "county":            { "type": "string", "description": "County name" },
    "state":             { "type": "string", "description": "State code (KS)" },
    "fips":              { "type": "string", "description": "County FIPS" },
    "url":               { "type": "string", "format": "uri", "description": "Link to OpenFEMA record" }
  },

  "filters": {
    "quick": [
      { "label": "Flood",           "where": { "incident_type": "Flood" } },
      { "label": "Severe Storm(s)", "where": { "incident_type": "Severe Storm(s)" } },
      { "label": "Tornado",         "where": { "incident_type": "Tornado" } },
      { "label": "Fire",            "where": { "incident_type": "Fire" } },
      { "label": "Drought",         "where": { "incident_type": "Drought" } },
      { "label": "Since 2000",      "where": { "declaration_date$gte": "2000-01-01" } },
      { "label": "1970s–1990s",     "where": { "all": [{ "declaration_date$gte": "1970-01-01" }, { "declaration_date$lt": "2000-01-01" }] } }
    ],
    "advanced": {
      "dateRangeField": "declaration_date",
      "groupBy": ["incident_type", "declaration_type", "county"]
    }
  },

  "search": {
    "qFields": ["declaration_title", "incident_type", "county", "disaster_number"],
    "accentFold": true,
    "minLength": 2,
    "placeholder": "Search FEMA events (e.g., Flood 1993, DR-4603)"
  },

  "ordering": {
    "zindex": 520,
    "before": "plss_parcels",
    "after": "ks_hydro"
  },

  "attribution": "FEMA OpenFEMA",
  "license": "Public Domain / US Government data",

  "provenance": {
    "source": "OpenFEMA Disaster Declarations Summaries (points at county centroids for demo; replace with pipeline export)",
    "retrieved": "2025-09-26T00:00:00Z",
    "notes": "When switching to pipeline export, prefer county polygons or per-incident footprints; persist source `disaster_number` and original URL."
  },

  "kfm_meta": {
    "schema_version": "1.1",
    "popup": ["declaration_title", "incident_type", "declaration_type", "disaster_number", "declaration_date", "county", "fips", "url"],
    "stac": {
      "collection": "kfm-hazards",
      "item": "fema_disasters_ks_points"
    }
  },

  "alternates": {
    "data_fallbacks": [
      { "format": "pmtiles", "url": "web/tiles/fema_disasters_ks.pmtiles", "note": "Use when present for clustering at scale" },
      { "format": "geojson", "url": "web/data/fema_disasters_ks.json" }
    ]
  },

  "type_overrides": {
    "icon": {
      "match": {
        "property": "incident_type",
        "stops": [
          ["Flood", "water"],
          ["Severe Storm(s)", "wind"],
          ["Tornado", "tornado"],
          ["Fire", "fire"],
          ["Drought", "droplet-slash"]
        ],
        "default": "alert"
      }
    }
  }
}
