{
  "id": "drought_monitor",
  "title": "U.S. Drought Monitor (Weekly)",
  "type": "vector",
  "format": "geojson",
  "data": "data/processed/drought_weekly.json",
  "category": "hazards",

  "version": "1.3",
  "generated": "2025-09-28T00:00:00Z",

  "time": { "start": "2000-01-06", "end": null },
  "timeProperty": { "start": "week", "end": null, "format": "date" },

  "bounds": [-102.051, 36.993, -94.588, 40.003],
  "minzoom": 5,
  "maxzoom": 19,
  "visible": false,
  "opacity": 1.0,

  "popup": ["week", "category", "dm", "area_km2"],

  "legend": {
    "type": "fill",
    "label": "Drought category (USDM)",
    "classes": [
      { "label": "D4 (Exceptional)",       "fill": "#730000", "stroke": "#804000" },
      { "label": "D3 (Extreme)",           "fill": "#FF0000", "stroke": "#804000" },
      { "label": "D2 (Severe)",            "fill": "#FF9900", "stroke": "#804000" },
      { "label": "D1 (Moderate)",          "fill": "#FFCC00", "stroke": "#804000" },
      { "label": "D0 (Abnormally Dry)",   "fill": "#FFFF00", "stroke": "#804000" }
    ],
    "notes": "Standard USDM palette."
  },

  "style": {
    "renderer": "sublayers",

    /* Draw light classes first, severe classes last for proper stacking. */
    "sublayers": [
      {
        "id": "usdm_d0",
        "filter": { "any": [{ "category": "D0" }, { "dm": 0 }] },
        "fillColor": "#FFFF00",
        "fillOpacityByZoom": [
          { "zoom": 5, "opacity": 0.30 },
          { "zoom": 8, "opacity": 0.38 },
          { "zoom": 12, "opacity": 0.45 }
        ],
        "lineColor": "#804000",
        "lineWidth": 0.5,
        "lineJoin": "round"
      },
      {
        "id": "usdm_d1",
        "filter": { "any": [{ "category": "D1" }, { "dm": 1 }] },
        "fillColor": "#FFCC00",
        "fillOpacity": 0.40,
        "lineColor": "#804000",
        "lineWidth": 0.55
      },
      {
        "id": "usdm_d2",
        "filter": { "any": [{ "category": "D2" }, { "dm": 2 }] },
        "fillColor": "#FF9900",
        "fillOpacity": 0.48,
        "lineColor": "#804000",
        "lineWidth": 0.6
      },
      {
        "id": "usdm_d3",
        "filter": { "any": [{ "category": "D3" }, { "dm": 3 }] },
        "fillColor": "#FF0000",
        "fillOpacity": 0.55,
        "lineColor": "#804000",
        "lineWidth": 0.65
      },
      {
        "id": "usdm_d4",
        "filter": { "any": [{ "category": "D4" }, { "dm": 4 }] },
        "fillColor": "#730000",
        "fillOpacity": 0.60,
        "lineColor": "#804000",
        "lineWidth": 0.7
      }
    ],

    "hover": {
      "lineColor": "#111827",
      "lineWidthDelta": 0.6
    },
    "selection": {
      "lineColor": "#111827",
      "lineWidthDelta": 0.9
    }
  },

  "fields": {
    "week":     { "type": "string", "format": "date", "description": "USDM week date (Thursday)" },
    "category": { "type": "string", "enum": ["D0","D1","D2","D3","D4"], "description": "Drought class (string)" },
    "dm":       { "type": "number", "enum": [0,1,2,3,4], "description": "Drought class (numeric)" },
    "area_km2": { "type": "number", "units": "km²", "description": "Polygon area (optional, analytics)" },
    "state":    { "type": "string", "description": "State code (KS when prefiltered)" }
  },

  "filters": {
    "quick": [
      { "label": "D4 only", "where": { "dm": 4 } },
      { "label": "D3–D4",   "where": { "dm$in": [3,4] } },
      { "label": "D0–D2",   "where": { "dm$in": [0,1,2] } },
      { "label": "Since 2010", "where": { "week$gte": "2010-01-01" } }
    ],
    "advanced": {
      "dateRangeField": "week",
      "groupBy": ["category"]
    }
  },

  "search": {
    "qFields": ["category"],
    "minLength": 1,
    "placeholder": "Filter by USDM (e.g., D3)"
  },

  "ordering": {
    "zindex": 515,
    "before": "fema_disasters",
    "after": "ks_hydro"
  },

  "alternates": {
    "data_fallbacks": [
      { "format": "pmtiles", "url": "web/tiles/usdm_weekly_ks.pmtiles", "note": "Prefer tiled polygons at state scale" },
      { "format": "geojson", "url": "data/processed/drought_weekly.json" }
    ]
  },

  "attribution": "© <a href=\"https://droughtmonitor.unl.edu/\" target=\"_blank\" rel=\"noopener\">USDM — NOAA / USDA / NDMC</a>",
  "license": "Public Domain / US Government data",

  "provenance": {
    "source": "USDM weekly shapefiles/GeoJSON (KS subset via pipeline)",
    "retrieved": "2025-09-26T00:00:00Z",
    "notes": "dm (0–4) and category (D0–D4) synchronized; dates normalized to ISO 8601 (week)."
  },

  "kfm_meta": {
    "schema_version": "1.1",
    "popup": ["week", "category", "dm", "area_km2"],
    "stac": {
      "collection": "kfm-hazards",
      "item": "usdm_weekly_ks"
    }
  }
}
