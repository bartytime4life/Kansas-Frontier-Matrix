{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://kfm.local/web/config/schema.json",
  "title": "Kansas-Frontier-Matrix Web Config Schemas (legend.json, categories.json, sources.json)",
  "type": "object",
  "description": "Schema pack containing named schemas for legend.json, categories.json, and sources.json. Use $defs.legend, $defs.categories, or $defs.sources in your validator.",
  "$defs": {
    "isoDateTime": {
      "type": "string",
      "description": "ISO 8601 datetime (UTC, Z suffix)",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"
    },
    "semver": {
      "type": "string",
      "description": "Semantic version string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[\\da-zA-Z-]+(?:\\.[\\da-zA-Z-]+)*)?(?:\\+[\\da-zA-Z-]+(?:\\.[\\da-zA-Z-]+)*)?$"
    },
    "colorHex": {
      "type": "string",
      "description": "CSS hex color (#RGB or #RRGGBB)",
      "pattern": "^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$"
    },
    "lineDasharray": {
      "type": "array",
      "items": { "type": "number" },
      "minItems": 2,
      "description": "Dash pattern [dash, gap, ...]"
    },

    /* ---------- Style buckets (camelCase for app-level 'style') ---------- */
    "Style": {
      "type": "object",
      "description": "App-level vector styling (camelCase). Use any subset.",
      "additionalProperties": false,
      "properties": {
        "lineColor": { "$ref": "#/$defs/colorHex" },
        "lineWidth": { "type": "number", "minimum": 0 },
        "lineOpacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "lineDasharray": { "$ref": "#/$defs/lineDasharray" },

        "fillColor": { "$ref": "#/$defs/colorHex" },
        "fillOpacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "fillOutlineColor": { "$ref": "#/$defs/colorHex" },

        "circleColor": { "$ref": "#/$defs/colorHex" },
        "circleRadius": { "type": "number", "minimum": 0 },
        "circleOpacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "circleStrokeColor": { "$ref": "#/$defs/colorHex" },
        "circleStrokeWidth": { "type": "number", "minimum": 0 }
      }
    },

    /* ---------- LEGEND: legend.json ---------- */
    "SymbolStyle": {
      "type": "object",
      "description": "Style bucket for a symbol/layer; supports line/fill/circle keys and helper fields.",
      "additionalProperties": false,
      "properties": {
        /* app-level style (camelCase) */
        "lineColor": { "$ref": "#/$defs/colorHex" },
        "lineWidth": { "type": "number", "minimum": 0 },
        "lineDasharray": { "$ref": "#/$defs/lineDasharray" },
        "opacity": { "type": "number", "minimum": 0, "maximum": 1 },

        "fillColor": { "$ref": "#/$defs/colorHex" },
        "fillOpacity": { "type": "number", "minimum": 0, "maximum": 1 },

        "circleColor": { "$ref": "#/$defs/colorHex" },
        "circleRadius": { "type": "number", "minimum": 0 },
        "circleStrokeColor": { "$ref": "#/$defs/colorHex" },
        "circleStrokeWidth": { "type": "number", "minimum": 0 },

        /* helpers for legend previews and raster hints */
        "raster": { "type": "boolean" },
        "rasterDem": { "type": "boolean" },
        "preview": { "type": "string", "description": "Preview color/marker hint for legend chips" },
        "description": { "type": "string" }
      },
      "minProperties": 1
    },

    "legend": {
      "type": "object",
      "required": ["version", "symbols"],
      "additionalProperties": false,
      "properties": {
        "version": { "$ref": "#/$defs/semver" },
        "generated": { "$ref": "#/$defs/isoDateTime" },
        "symbols": {
          "type": "object",
          "description": "Symbol/style dictionary keyed by symbol id",
          "minProperties": 1,
          "additionalProperties": { "$ref": "#/$defs/SymbolStyle" }
        },
        "categories": {
          "type": "object",
          "description": "Optional category → symbol-id list",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string", "minLength": 1 },
            "minItems": 1,
            "uniqueItems": true
          }
        },
        "layerBindings": {
          "type": "object",
          "description": "Optional mapping of layer id → symbol id to drive legend rendering",
          "additionalProperties": { "type": "string", "minLength": 1 }
        },
        "attribution": { "type": "string" }
      }
    },

    /* ---------- CATEGORIES: categories.json ---------- */
    "Category": {
      "type": "object",
      "required": ["label", "order"],
      "additionalProperties": false,
      "properties": {
        "label": { "type": "string" },
        "order": { "type": "integer", "minimum": 0 },
        "description": { "type": "string" },
        "layers": {
          "type": "array",
          "description": "Optional list of layer ids for this category",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1,
          "uniqueItems": true
        }
      }
    },

    "categories": {
      "type": "object",
      "required": ["version", "categories"],
      "additionalProperties": false,
      "properties": {
        "version": { "$ref": "#/$defs/semver" },
        "generated": { "$ref": "#/$defs/isoDateTime" },
        "categories": {
          "type": "object",
          "description": "Category dictionary keyed by category id",
          "minProperties": 1,
          "additionalProperties": { "$ref": "#/$defs/Category" }
        },
        "attribution": { "type": "string" }
      }
    },

    /* ---------- SOURCES: sources.json (optional helper registry) ---------- */
    "Source": {
      "type": "object",
      "required": ["title", "type", "attribution", "category"],
      "additionalProperties": false,
      "properties": {
        "title": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["raster", "vector", "geojson", "image", "raster-dem"]
        },
        "data": {
          "type": "string",
          "description": "Path/URL to a single data asset (e.g., GeoJSON, GeoTIFF/COG)"
        },
        "tiles": {
          "type": "array",
          "description": "Tile URL templates for tiled sources",
          "items": { "type": "string" },
          "minItems": 1
        },
        "attribution": { "type": "string" },
        "category": {
          "type": "string",
          "description": "Logical category key (e.g., reference, terrain, historical, infrastructure, documents, environment, culture)"
        },
        "timeProperty": {
          "type": "string",
          "description": "Feature property name storing year/date for time filtering (for vector/geojson)"
        },
        "minzoom": { "type": "number", "minimum": 0 },
        "maxzoom": { "type": "number", "minimum": 0 },
        "tileSize": { "type": "integer", "minimum": 1 },
        "visible": { "type": "boolean" },
        "opacity": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "oneOf": [
        { "required": ["data"] },
        { "required": ["tiles"] }
      ]
    },

    "sources": {
      "type": "object",
      "required": ["version", "sources"],
      "additionalProperties": false,
      "properties": {
        "version": { "$ref": "#/$defs/semver" },
        "generated": { "$ref": "#/$defs/isoDateTime" },
        "sources": {
          "type": "object",
          "description": "Source dictionary keyed by source id",
          "minProperties": 1,
          "additionalProperties": { "$ref": "#/$defs/Source" }
        },
        "attribution": { "type": "string" }
      }
    }
  },

  "properties": {
    "legend": { "$ref": "#/$defs/legend" },
    "categories": { "$ref": "#/$defs/categories" },
    "sources": { "$ref": "#/$defs/sources" }
  },
  "additionalProperties": false
}
