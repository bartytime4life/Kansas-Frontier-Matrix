{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "web/config/app.config.schema.json",
  "title": "Kansas-Frontier-Matrix â€” Web App Config",
  "type": "object",
  "required": ["version", "defaults", "layers"],
  "additionalProperties": false,

  "properties": {
    "version": { "type": "string" },
    "generated": { "type": ["string", "null"], "format": "date-time" },

    "title": { "type": "string" },
    "subtitle": { "type": ["string", "null"] },

    "style": { "type": "string" },
    "center": {
      "type": "array",
      "minItems": 2,
      "maxItems": 2,
      "items": { "type": "number" }
    },
    "zoom": { "type": "number", "minimum": 0, "maximum": 24 },
    "bounds": {
      "type": "array",
      "minItems": 4,
      "maxItems": 4,
      "items": { "type": "number" }
    },

    "time": { "$ref": "#/$defs/timeGlobal" },

    "defaults": {
      "type": "object",
      "required": ["minzoom", "maxzoom", "visible", "opacity", "time"],
      "additionalProperties": false,
      "properties": {
        "minzoom": { "type": "integer", "minimum": 0, "maximum": 24 },
        "maxzoom": { "type": "integer", "minimum": 0, "maximum": 24 },
        "visible": { "type": "boolean" },
        "opacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "bounds": {
          "type": "array",
          "minItems": 4,
          "maxItems": 4,
          "items": { "type": "number" }
        },
        "time": { "$ref": "#/$defs/timeRange" }
      }
    },

    "layers": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/layer" }
    }
  },

  "$defs": {
    "timeRange": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "start": { "type": ["string", "null"], "format": "date" },
        "end":   { "type": ["string", "null"], "format": "date" }
      }
    },

    "timeGlobal": {
      "type": "object",
      "additionalProperties": false,
      "required": ["min", "max", "defaultYear", "step", "loop", "fps"],
      "properties": {
        "min":         { "type": "string", "format": "date" },
        "max":         { "type": "string", "format": "date" },
        "defaultYear": { "type": "integer" },
        "step":        { "type": "integer", "minimum": 1 },
        "loop":        { "type": "boolean" },
        "fps":         { "type": "integer", "minimum": 1, "maximum": 60 }
      }
    },

    "commonLayerProps": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id":         { "type": "string" },
        "title":      { "type": "string" },
        "group":      { "type": ["string", "null"] },
        "url":        { "type": "string" },
        "opacity":    { "type": "number", "minimum": 0, "maximum": 1 },
        "minzoom":    { "type": ["integer", "null"], "minimum": 0, "maximum": 24 },
        "maxzoom":    { "type": ["integer", "null"], "minimum": 0, "maximum": 24 },
        "visible":    { "type": "boolean" },
        "tileSize":   { "type": ["integer", "null"], "enum": [256, 512, null] },
        "bounds": {
          "type": "array",
          "minItems": 4,
          "maxItems": 4,
          "items": { "type": "number" }
        },
        "time":        { "$ref": "#/$defs/timeRange" },
        "attribution": { "type": ["string", "null"] },
        "category": {
          "type": ["string", "null"],
          "enum": [
            "reference",
            "terrain",
            "historical",
            "infrastructure",
            "documents",
            "environment",
            "culture",
            null
          ]
        },

        /* Presentation blocks (either MapLibre-like "paint" or app-level "style") */
        "paint": { "$ref": "#/$defs/paint" },
        "style": { "$ref": "#/$defs/style" },

        /* Optional UI helpers for GeoJSON/vector */
        "popup": {
          "type": "array",
          "items": { "type": "string" }
        },
        "timeProperty": { "type": ["string", "null"] },
        "endTimeProperty": { "type": ["string", "null"] }
      },
      "required": ["id", "title", "url", "visible"]
    },

    "paint": {
      "type": "object",
      "description": "Loose MapLibre paint keys. Allows common line/fill/circle props.",
      "additionalProperties": false,
      "properties": {
        "line-color": { "type": "string" },
        "line-width": { "type": "number" },
        "line-opacity": { "type": "number", "minimum": 0, "maximum": 1 },

        "fill-color": { "type": "string" },
        "fill-opacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "fill-outline-color": { "type": "string" },

        "circle-color": { "type": "string" },
        "circle-radius": { "type": "number" },
        "circle-opacity": { "type": "number", "minimum": 0, "maximum": 1 }
      }
    },

    "style": {
      "type": "object",
      "description": "App-level vector styling (camelCase).",
      "additionalProperties": false,
      "properties": {
        "lineColor": { "type": "string" },
        "lineWidth": { "type": "number" },
        "lineOpacity": { "type": "number", "minimum": 0, "maximum": 1 },

        "fillColor": { "type": "string" },
        "fillOpacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "fillOutlineColor": { "type": "string" },

        "circleColor": { "type": "string" },
        "circleRadius": { "type": "number" },
        "circleOpacity": { "type": "number", "minimum": 0, "maximum": 1 },

        "lineDasharray": {
          "type": "array",
          "items": { "type": "number" }
        }
      }
    },

    "rasterLayer": {
      "allOf": [
        { "$ref": "#/$defs/commonLayerProps" },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": { "type": { "const": "raster" } },
          "required": ["type"]
        }
      ]
    },

    "rasterDemLayer": {
      "allOf": [
        { "$ref": "#/$defs/commonLayerProps" },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": { "type": { "const": "raster-dem" } },
          "required": ["type"]
        }
      ]
    },

    "geojsonLayer": {
      "allOf": [
        { "$ref": "#/$defs/commonLayerProps" },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": { "type": { "const": "geojson" } },
          "required": ["type"]
        }
      ]
    },

    "vectorLayer": {
      "allOf": [
        { "$ref": "#/$defs/commonLayerProps" },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": { "type": { "const": "vector" } },
          "required": ["type"]
        }
      ]
    },

    "imageLayer": {
      "allOf": [
        { "$ref": "#/$defs/commonLayerProps" },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "type": { "const": "image" },
            "coordinates": {
              "type": "array",
              "description": "NW, NE, SE, SW lon/lat pairs",
              "minItems": 4,
              "maxItems": 4,
              "items": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": { "type": "number" }
              }
            }
          },
          "required": ["type", "coordinates"]
        }
      ]
    },

    "layer": {
      "oneOf": [
        { "$ref": "#/$defs/rasterLayer" },
        { "$ref": "#/$defs/rasterDemLayer" },
        { "$ref": "#/$defs/geojsonLayer" },
        { "$ref": "#/$defs/vectorLayer" },
        { "$ref": "#/$defs/imageLayer" }
      ]
    }
  }
}
