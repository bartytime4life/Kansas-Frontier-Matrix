<!-- ğŸ“ Path: web/assets/charts/specs/README.md -->

# ğŸ“Š Chart Specs (KFM) â€” `web/assets/charts/specs`

![ChartSpec](https://img.shields.io/badge/ChartSpec-v1-success?style=flat-square)
![Contract%20First](https://img.shields.io/badge/Contract--First-enforced-blue?style=flat-square)
![Provenance%20First](https://img.shields.io/badge/Provenance--First-required-blueviolet?style=flat-square)
![A11y](https://img.shields.io/badge/A11y-WCAG%20AA-orange?style=flat-square)
![Responsive](https://img.shields.io/badge/UI-responsive-informational?style=flat-square)

Declarative, **provenance-first** chart specifications used by the Kansas Frontier Matrix (KFM) web UI to render charts in panels, popups, stories, and map-linked dashboards. KFMâ€™s mission emphasizes that map layers, datasets, and AI answers must be traceable with citations and metadata as first-class data â€” no â€œblack boxes.â€ [oai_citation:0â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

> [!IMPORTANT]
> **If it shows up in the UI, it must be traceable.** KFMâ€™s architecture is **contract-first** and **provenance-first**: UI content is traceable to cataloged sources and provable processing; datasets are governed by metadata â€œdata contracts,â€ and â€œmystery layersâ€ are not allowed. [oai_citation:1â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

---

## ğŸ§­ Contents

- [Why chart specs exist](#-why-chart-specs-exist)
- [What lives in this folder](#-what-lives-in-this-folder)
- [Core principles](#-core-principles)
- [ChartSpec v1](#-chartspec-v1)
- [Examples](#-examples)
- [Map â†”ï¸ Chart interaction](#ï¸-map--chart-interaction)
- [Validation & CI](#-validation--ci)
- [Definition of Done](#-definition-of-done)
- [Reference shelf](#-reference-shelf)

---

## ğŸ¯ Why chart specs exist

KFMâ€™s frontend (React) includes reusable UI components like **charts**, map overlays, and story experiences. [oai_citation:2â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)  
The web app is designed to be **responsive and accessible**, and UI patterns include legends, a timeline slider, and popups/side panels that show detail when users click map features (e.g., â€œclick a weather station â†’ see a chart of recent dataâ€). [oai_citation:3â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

**Chart specs** are how we keep charts:
- âœ… consistent across the UI
- âœ… portable (works in popups, story nodes, dashboards)
- âœ… testable (schema validation + snapshot tests)
- âœ… auditable (provenance/citations required)
- âœ… performant (server aggregation + caching strategies)

---

## ğŸ“¦ What lives in this folder

This folder is intended to be a **spec library** â€” not chart code.

Typical contents (recommended layout):

```text
web/assets/charts/specs/
â”œâ”€ README.md
â”œâ”€ schemas/                       # âœ… JSON Schema + shared enums
â”‚  â”œâ”€ kfm.chart-spec.v1.schema.json
â”‚  â””â”€ kfm.chart-palette.schema.json
â”œâ”€ palettes/                      # ğŸ¨ Color tokens (semantic, accessible)
â”‚  â””â”€ kfm.palettes.v1.json
â”œâ”€ examples/                      # ğŸ§ª Known-good specs used by tests/docs
â”‚  â”œâ”€ timeseries.weather_station.v1.json
â”‚  â”œâ”€ histogram.elevation.v1.json
â”‚  â””â”€ scatter.ndvi_vs_precip.v1.json
â””â”€ catalog/                        # ğŸ—‚ï¸ Optional: registry/index of available charts
   â””â”€ chart-spec.index.v1.json
```

> [!NOTE]
> If your repo structure differs, keep the **spirit**: specs are versioned, validated, and reference governed data contracts.

---

## ğŸ§± Core principles

### 1) Contract-first data inputs âœ…
Every chart spec must point to a **cataloged dataset** with a declared schema & metadata contract (source, license, spatial/temporal extent, processing steps, etc.). [oai_citation:4â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

### 2) Provenance-first outputs ğŸ”
Specs must include enough lineage to support UI attribution and â€œevidence panels.â€ KFM explicitly uses open provenance/metadata standards (e.g., STAC/DCAT/PROV-O) to capture where data comes from and how it was processed. [oai_citation:5â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

### 3) Responsive by design ğŸ“±ğŸ–¥ï¸
Charts must adapt to panels, mobile layouts, and story containers. KFMâ€™s UI is explicitly built to work across desktop/tablet/phone contexts. [oai_citation:6â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

### 4) Map-linked interaction ğŸ—ºï¸â†”ï¸ğŸ“ˆ
Charts should be able to sync with time, geometry, and layer state. This pattern is common in geospatial analytics: clicking a chart point can reveal the corresponding spatial layer/date on the map. [oai_citation:7â€¡Cloud-Based Remote Sensing with Google Earth Engine-Fundamentals and Applications.pdf](file-service://file-JVv3nbvtonX1HcpeERi9kV)

### 5) Performance-aware ğŸ“¦âš¡
Prefer server aggregation, materialized summaries, and caching for repeated queries. Caching intermediate results and reusing precomputed results can drastically improve query execution in analytics workloads. [oai_citation:8â€¡Scalable Data Management for Future Hardware.pdf](file-service://file-GZ8gMsQ8hxu7GWEVd3csNE)

---

## ğŸ§¾ ChartSpec v1

A **ChartSpec** is a declarative JSON document describing:
- **what** to show (chart type + encodings),
- **where** the data comes from (contracted dataset + query),
- **how** it was processed (lineage),
- **how** it behaves (interactions),
- **how** it remains usable (a11y + responsive rules).

### âœ… Top-level shape

| Field | Type | Required | Purpose |
|---|---:|:---:|---|
| `$schema` | string | âœ… | JSON Schema pointer for validation |
| `id` | string | âœ… | Stable identifier (prefer URN-style) |
| `version` | string | âœ… | Spec version (e.g., `"1.0.0"`) |
| `title` | string | âœ… | Human name (UI) |
| `description` | string | â›”ï¸ | Longer explanation |
| `kind` | string | âœ… | e.g., `timeseries`, `bar`, `scatter`, `map-linked` |
| `engine` | string | âœ… | Renderer target (e.g., `vega-lite`, `echarts`, `plotly`) |
| `data` | object | âœ… | Data source + query + provenance |
| `encoding` | object | âœ… | Visual encoding mapping |
| `style` | object | â›”ï¸ | Tokens (palette, typography, formatting) |
| `a11y` | object | âœ… | Accessibility contract |
| `interaction` | object | â›”ï¸ | Click/hover/brush handlers |
| `limits` | object | â›”ï¸ | Performance caps (max points, sampling rules) |

---

## ğŸ§© Example ChartSpec

> [!TIP]
> Keep examples small and â€œknown good.â€ They become fixtures for CI validation + docs.

```json
{
  "$schema": "../schemas/kfm.chart-spec.v1.schema.json",
  "id": "urn:kfm:chart:weather-station:recent-precip:v1",
  "version": "1.0.0",
  "title": "Recent precipitation (station)",
  "description": "Daily precipitation totals for the selected station; click a point to sync the map timeline.",
  "kind": "timeseries",
  "engine": "vega-lite",
  "data": {
    "source": {
      "type": "dataset",
      "dataset_id": "urn:kfm:dataset:weather:stations:daily:v2",
      "contract_path": "data/contracts/weather_stations_daily.json"
    },
    "query": {
      "station_id_param": "ui.selectedStationId",
      "time_range": { "mode": "relative", "days": 30 },
      "aggregate": "day"
    },
    "provenance": {
      "inputs": [
        {
          "ref": "urn:kfm:source:noaa:ghcn-daily",
          "license": "public-domain-or-provider-terms",
          "note": "Source attribution is required in UI."
        }
      ],
      "processing": [
        "API aggregation: daily totals",
        "Units normalization: mm"
      ],
      "citations": [
        { "label": "Dataset contract", "ref": "data/contracts/weather_stations_daily.json" }
      ]
    }
  },
  "encoding": {
    "x": { "field": "date", "type": "temporal", "title": "Date" },
    "y": { "field": "precip_mm", "type": "quantitative", "title": "Precip (mm)" },
    "tooltip": [
      { "field": "date", "type": "temporal" },
      { "field": "precip_mm", "type": "quantitative" }
    ]
  },
  "style": {
    "palette": "kfm.blueScale",
    "grid": true,
    "number_format": "0.0"
  },
  "a11y": {
    "summary": "Line chart showing 30 days of daily precipitation for the selected station.",
    "keyboard_navigation": true,
    "color_blind_safe": true
  },
  "interaction": {
    "onClick": {
      "action": "sync-map-time",
      "time_field": "date"
    }
  },
  "limits": {
    "max_points": 5000,
    "sampling": { "strategy": "lttb", "target_points": 800 }
  }
}
```

---

## ğŸ—ºï¸ Map â†”ï¸ Chart interaction

KFM charts are often shown **alongside** maps, and should support tight â€œcross-filteringâ€:

- **Click a chart point â†’ reveal the spatial layer at that time**
- **Brush a time window â†’ move the mapâ€™s timeline slider**
- **Hover on map feature â†’ highlight series in chart**

This interaction pattern is well established in geospatial analytics: clicking a point on a chart can reveal the corresponding spatial data on the map for the matching time property. [oai_citation:9â€¡Cloud-Based Remote Sensing with Google Earth Engine-Fundamentals and Applications.pdf](file-service://file-JVv3nbvtonX1HcpeERi9kV)

### Suggested interaction contract (minimal)

```json
{
  "interaction": {
    "onClick": { "action": "sync-map-time", "time_field": "date" },
    "onBrush": { "action": "filter-map-by-time-range", "from_field": "t0", "to_field": "t1" }
  }
}
```

> [!NOTE]
> KFMâ€™s frontend includes MapLibre GL JS for 2D and CesiumJS for 3D, and story nodes that sync narrative + map state via JSON config files â€” chart specs should be compatible with those flows. [oai_citation:10â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

---

## âœ… Validation & CI

### Schema validation
All specs **must** validate against `kfm.chart-spec.v1.schema.json`.

Recommended CI checks:
- âœ… JSON Schema validation (fail PR if invalid)
- âœ… Lint: sorted keys (optional), no trailing commas, no duplicate IDs
- âœ… Snapshot tests: renderer output stable for example specs
- âœ… Provenance check: `data.provenance.inputs[]` required

### Runtime safeguards
- Enforce `limits.max_points` and sampling rules
- Reject specs missing `a11y.summary`
- Reject specs referencing unknown dataset contracts

---

## ğŸ§¾ Definition of Done

KFM-style documentation governance applies to specs too: templates, checklists, and â€œall claims citedâ€ culture keep artifacts trustworthy. [oai_citation:11â€¡Comprehensive Markdown Guide_ Syntax, Extensions, and Best Practices.docx](file-service://file-J6rFRcp4ExCCeCdTevQjxz)

**DoD â€” a ChartSpec is â€œdoneâ€ when:**

- [ ] âœ… Validates against JSON Schema
- [ ] ğŸ” Provenance present (`inputs`, `processing`, `citations`)
- [ ] ğŸ§¾ Dataset contract reference present (no â€œmystery dataâ€) [oai_citation:12â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)
- [ ] â™¿ `a11y.summary` written in plain language
- [ ] ğŸ“± Responsive defaults tested (narrow panel + wide dashboard)
- [ ] âš¡ Limits set (`max_points`, sampling strategy)
- [ ] ğŸ§ª Example/spec added to `examples/` if new chart type
- [ ] ğŸ”— No broken internal links / contract paths

---

## ğŸ“š Reference shelf

<details>
<summary>ğŸ“˜ Project files that inform this spec system (click to expand)</summary>

### ğŸ§  KFM architecture & governance
- **KFM â€” Comprehensive Technical Documentation** (frontend has chart components, story nodes, responsiveness; contract/provenance-first) [oai_citation:13â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi) [oai_citation:14â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)
- **Comprehensive Markdown Guide â€” Syntax, Extensions, Best Practices** (templates + Definition of Done culture) [oai_citation:15â€¡Comprehensive Markdown Guide_ Syntax, Extensions, and Best Practices.docx](file-service://file-J6rFRcp4ExCCeCdTevQjxz)

### ğŸ›°ï¸ Geospatial analytics patterns
- **Cloud-Based Remote Sensing with Google Earth Engine** (map â†” chart interactive linking via click + time properties) [oai_citation:16â€¡Cloud-Based Remote Sensing with Google Earth Engine-Fundamentals and Applications.pdf](file-service://file-JVv3nbvtonX1HcpeERi9kV)

### âš™ï¸ Performance thinking
- **Scalable Data Management for Future Hardware** (caching, batching, reuse of intermediate results for analytics) [oai_citation:17â€¡Scalable Data Management for Future Hardware.pdf](file-service://file-GZ8gMsQ8hxu7GWEVd3csNE)

### ğŸ›ï¸ 3D & rendering (optional extensions)
- **WebGL Programming Guide** (shader pipeline + WebGL stack; useful when charting needs GPU/3D overlays)

### ğŸ“¦ Wider project library (used as design inspiration)
- Regression + stats: *Regression Analysis with Python*, *Understanding Statistics & Experimental Design*, *Graphical Data Analysis with R*, *Think Bayes*
- Web UX: *Responsive Web Design with HTML5 and CSS3*
- Cartography: *Making Maps*, *Mobile Mapping*, *Archaeological 3D GIS*
- Data engineering: *PostgreSQL Notes for Professionals*, *Database Performance at Scale*, *Data Spaces*
- Ethics/humanism: *Introduction to Digital Humanism*, *AI Law foundations paper* (transparency + responsibility)

</details>

---

## ğŸ§  Quick glossary

- **Data contract** ğŸ§¾: governed metadata JSON describing dataset schema, license, extent, and processing steps (required for acceptance). [oai_citation:18â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)
- **Provenance** ğŸ”: â€œhow we got hereâ€ â€” sources + transformations (required for UI trust). [oai_citation:19â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)
- **Spec** ğŸ“¦: declarative instruction set that the renderer interprets (not imperative chart code).

---

### âœ… TL;DR

If you add or edit a chart spec here:
- **Validate it** âœ…
- **Prove it** ğŸ”
- **Make it usable** â™¿
- **Make it fast** âš¡
- **Make it portable** ğŸ§©

Because KFMâ€™s standard is: **auditable, mappable, modelable â€” and never a black box.** [oai_citation:20â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)

<!-- Optional file surfacing for this chat context:
 [oai_citation:21â€¡Kansas Frontier Matrix (KFM) â€“ Comprehensive Technical Documentation.pdf](file-service://file-AkqwUuYPp5zePf7pv5SMxi)  [oai_citation:22â€¡Cloud-Based Remote Sensing with Google Earth Engine-Fundamentals and Applications.pdf](file-service://file-JVv3nbvtonX1HcpeERi9kV)  [oai_citation:23â€¡Comprehensive Markdown Guide_ Syntax, Extensions, and Best Practices.docx](file-service://file-J6rFRcp4ExCCeCdTevQjxz)  [oai_citation:24â€¡Scalable Data Management for Future Hardware.pdf](file-service://file-GZ8gMsQ8hxu7GWEVd3csNE)
-->