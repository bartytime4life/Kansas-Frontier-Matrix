# Kansas-Frontier-Matrix (KFM) â€” pre-commit configuration âœ…
# Docs: https://pre-commit.com
#
# Install once:
#   pre-commit install
#
# Run manually:
#   pre-commit run --all-files
#
# Notes ğŸ§­
# - â€œFastâ€ hooks run on commit (default).
# - Heavier hooks (Docker, security, full tests, contract gates) are manual or CI-gated.
# - KFM adds a trust-first supply-chain hook (kfm-dtk) to stop lockfile / registry / SBOM nonsense early. ğŸ›¡ï¸ğŸŒ¾

minimum_pre_commit_version: "3.2.0"
default_stages: [pre-commit]
fail_fast: false

# Exclude heavy/binary/derived artifacts ğŸ§±
# (Keep contracts/metadata JSON in-scope; exclude raw/work/processed + image assets.)
exclude: |
  (?x)^(
    # --- caches / envs ---
    \.venv/|
    \.tox/|
    \.nox/|
    \.mypy_cache/|
    \.pytest_cache/|
    \.ruff_cache/|
    \.cache/|
    __pycache__/|
    node_modules/|

    # --- build / release outputs ---
    dist/|
    build/|
    releases/|
    mcp/runs/|

    # --- data dirs (raw/work/processed/tmp/exports) ---
    data/(raw|work|processed|tmp|exports)/|

    # --- published story / focus-mode static assets ---
    docs/reports/story_nodes/published/.*/assets/|
    docs/reports/visualization/focus_mode/story_nodes/published/.*/assets/|
    docs/reports/visualization/focus_mode/story_nodes/assets/|

    # --- binary / large / non-text ---
    .*\.pdf$|
    .*\.png$|
    .*\.jpe?g$|
    .*\.gif$|
    .*\.webp$|
    .*\.tiff?$|
    .*\.ico$|
    .*\.zip$|
    .*\.7z$|
    .*\.tar$|
    .*\.gz$|
    .*\.bz2$|
    .*\.xz$|
    .*\.parquet$|
    .*\.feather$|
    .*\.arrow$|
    .*\.sqlite$|
    .*\.db$|
    .*\.docx$|
    .*\.pptx$|
    .*\.xlsx$
  )

# pre-commit.ci settings ğŸ¤– (safe defaults)
# - pre-commit.ci runs in a clean environment; local-only KFM toolchain hooks are skipped here.
ci:
  autofix_prs: true
  autoupdate_schedule: monthly
  autoupdate_commit_msg: "chore(pre-commit): autoupdate hooks"
  skip:
    - hadolint-docker
    - bandit
    - pytest
    - kfm-precommit
    - kfm-lock-verify
    - kfm-reg-audit
    - kfm-ns-scan
    - kfm-provenance-verify
    - kfm-sbom-diff
    - kfm-fallback-test
    - kfm-stac-gate
    - kfm-stac-policy

repos:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§¼ Baseline sanity checks (whitespace, yaml/json validity, merge conflicts)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-case-conflict
      - id: check-merge-conflict
      - id: check-symlinks
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable

      - id: mixed-line-ending
        args: ["--fix=lf"]

      - id: end-of-file-fixer

      # Preserve intentional Markdown hard line breaks (two trailing spaces)
      - id: trailing-whitespace
        args: ["--markdown-linebreak-ext=md"]

      # Also treat *.md.gdoc as Markdown (KFM internal docs export) ğŸ“
      - id: trailing-whitespace
        name: trailing-whitespace (md.gdoc)
        files: '\.md\.gdoc$'
        args: ["--markdown-linebreak-ext=md.gdoc"]

      # YAML (include CITATION.cff), JSON (include GeoJSON), TOML, XML
      - id: check-yaml
        files: '\.(yml|yaml|cff)$'
      - id: check-json
        files: '\.(json|geojson|topojson|jsonld)$'
      - id: check-toml
      - id: check-xml

      # Guardrail against accidental giant commits (tune as needed)
      - id: check-added-large-files
        args: ["--maxkb=20480"]

      - id: detect-private-key

      # Catch stray debugging before it lands ğŸ”¥
      - id: debug-statements

      # Optional but useful: avoid committing directly to protected branches ğŸŒ¿
      - id: no-commit-to-branch
        args: ["--branch", "main", "--branch", "master"]

      # Keep schema JSON tidy + deterministic (scope to /schemas only) ğŸ§¾
      - id: pretty-format-json
        args: ["--autofix", "--indent", "2"]
        files: '^schemas/.*\.(json|jsonld)$'

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§© Schema + config validation (GitHub workflows, CITATION.cff, compose, metaschema)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/python-jsonschema/check-jsonschema
    rev: 0.36.0
    hooks:
      - id: check-github-workflows
      - id: check-citation-file-format
      - id: check-compose-spec

      # Ensure KFM's JSON Schemas are valid schemas (contract-first + deterministic) ğŸ§¾ğŸ§¬
      - id: check-metaschema
        files: '^schemas/.*\.json$'

      # Optional: validate KFM "governed" JSON docs (only if you vendor schemas)
      # - id: check-jsonschema
      #   name: KFM UI/Telemetry JSON instances (schema) ğŸ“¡
      #   files: '^docs/reports/visualization/focus_mode/.*\.json$'
      #   args: ["--schemafile", "schemas/telemetry/reports-visualization-focusmode-panels-v1.json"]

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§ª GitHub Actions workflow linting (semantic checks beyond schema)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/rhysd/actionlint
    rev: v1.7.10
    hooks:
      - id: actionlint

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ Python lint + format (fast)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.10
    hooks:
      - id: ruff-check
        args: ["--fix", "--exit-non-zero-on-fix"]
      - id: ruff-format

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # âœï¸ Spelling (kept to docs-y text to avoid domain false positives)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/codespell-project/codespell
    rev: v2.4.1
    hooks:
      - id: codespell
        files: '\.(md|md\.gdoc|rst|txt)$'
        args:
          - "--check-filenames"
          - "--check-hidden"
          # Common KFM domain tokens to reduce noise (extend as needed)
          - "--ignore-words-list=nd,ndvi,epsg,postgis,prov,stac,dcat,rego,sbom,slsa,geotiff,cog"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“ Markdown style checks (line-length + HTML are allowed in KFM docs)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.46.0
    hooks:
      - id: markdownlint
        files: '\.(md|md\.gdoc)$'
        args: ["--disable", "MD013", "MD033", "MD041"]

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸŒ Web formatting (Prettier, pinned & isolated via pre-commit Node env)
  # - Runs only when files under /web change â†’ Python-only contributors donâ€™t need Node.
  # - Pinning exact Prettier version keeps diffs deterministic across machines. âœ¨
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: local
    hooks:
      - id: web-prettier
        name: web: prettier (pinned) ğŸŒâœ¨
        entry: prettier --write
        language: node
        additional_dependencies: ["prettier@3.7.4"]
        files: '^web/.*\.(js|jsx|ts|tsx|json|css|scss|less|html|md|yaml|yml)$'

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸš Shell scripting
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.11.0.1
    hooks:
      - id: shellcheck
        args: ["--severity=warning"]

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ” Secret scanning (lightweight, good baseline)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        # If/when you add a baseline:
        # args: ["--baseline", ".secrets.baseline"]

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ³ Dockerfile lint (requires Docker) â€” manual stage
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/hadolint/hadolint
    rev: v2.14.0
    hooks:
      - id: hadolint-docker
        stages: [manual]

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ” Security static analysis â€” manual stage (avoid friction / false positives)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: https://github.com/PyCQA/bandit
    rev: 1.9.2
    hooks:
      - id: bandit
        stages: [manual]
        args: ["-q"]

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§ª Local â€œrun testsâ€ hook â€” manual stage
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: local
    hooks:
      - id: pytest
        name: pytest (manual) ğŸ§ª
        entry: pytest
        language: system
        pass_filenames: false
        stages: [manual]

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§¯ Guardrails: never commit local .env (defense-in-depth)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: local
    hooks:
      - id: forbid-dotenv
        name: forbid committing .env ğŸš«ğŸ§ª
        entry: bash -lc 'git diff --cached --name-only | grep -E "(^|/)\.env$" && echo "âŒ .env is not allowed in git. Use .env.example + env vars/secrets." && exit 1 || exit 0'
        language: system
        pass_filenames: false

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ›¡ï¸ KFM DTK â€” Supply-chain & governance pre-commit (recommended on dev machines)
  #
  # Implements KFM â€œtrust-firstâ€ gates:
  # - lockfile pinning verification
  # - registry audit (strict)
  # - namespace/dependency-confusion scan
  # - provenance verification (local)
  # - SBOM drift detection (local)
  # - fallback / hermetic sandbox validation
  #
  # Script path is repo-owned:
  #   tools/kfm-dtk/hooks/kfm-precommit.sh
  #
  # Tip: keep this scoped to dependency / contract / security changes to stay fast.
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - repo: local
    hooks:
      - id: kfm-precommit
        name: KFM supply-chain + governance gate ğŸ›¡ï¸ğŸŒ¾
        entry: bash -lc 'tools/kfm-dtk/hooks/kfm-precommit.sh'
        language: system
        pass_filenames: false
        files: |
          (?x)^(
            pyproject\.toml|
            uv\.lock|
            poetry\.lock|
            requirements(\..+)?\.txt|
            package\.json|
            package-lock\.json|
            pnpm-lock\.yaml|
            yarn\.lock|
            docker-compose\.ya?ml|
            Dockerfile|
            \.github/workflows/.*\.ya?ml|
            schemas/.*|
            data/(stac|catalog|prov)/.*|
            docs/security/.*|
            docs/governance/.*|
            SBOM(\..+)?\.(json|spdx|spdx\.json|cyclonedx\.json)
          )$

      # Optional: expose sub-commands as manual hooks for quick isolation/debugging ğŸ§°
      - id: kfm-lock-verify
        name: KFM lockfile verify (manual) ğŸ”’
        entry: kfm-lock-verify
        language: system
        pass_filenames: false
        stages: [manual]

      - id: kfm-reg-audit
        name: KFM registry audit (manual, strict) ğŸ§¾
        entry: kfm-reg-audit --strict
        language: system
        pass_filenames: false
        stages: [manual]

      - id: kfm-ns-scan
        name: KFM namespace scan (manual) ğŸ›°ï¸
        entry: kfm-ns-scan .
        language: system
        pass_filenames: false
        stages: [manual]

      - id: kfm-provenance-verify
        name: KFM provenance verify (manual) ğŸ§¬
        entry: kfm-provenance-verify --local
        language: system
        pass_filenames: false
        stages: [manual]

      - id: kfm-sbom-diff
        name: KFM SBOM drift check (manual) ğŸ“¦
        entry: kfm-sbom-diff --local
        language: system
        pass_filenames: false
        stages: [manual]

      - id: kfm-fallback-test
        name: KFM fallback / hermetic sandbox (manual) ğŸ§ªğŸ§Š
        entry: kfm-fallback-test --validate
        language: system
        pass_filenames: false
        stages: [manual]

      # Optional contract gate helpers (manual) â€” matches KFM contract-first philosophy ğŸ—‚ï¸
      - id: kfm-stac-gate
        name: STAC validation gate (manual) ğŸ—ºï¸ğŸ§¾
        entry: bash -lc 'tools/validation/stac-check.sh'
        language: system
        pass_filenames: false
        stages: [manual]
        files: '^data/stac/.*\.json$|^schemas/stac/.*\.json$'

      - id: kfm-stac-policy
        name: STAC policy checks (manual, conftest/OPA) ğŸ§¾ğŸ›¡ï¸
        entry: bash -lc 'conftest test --policy policy --all-namespaces'
        language: system
        pass_filenames: false
        stages: [manual]
        files: '^data/stac/.*\.json$|^policy/.*'
