<div align="center">

# 🧾 Kansas Frontier Matrix — Terrain Derivative Checksums  
`data/derivatives/terrain/checksums/`

**Purpose:** Provide reproducible, machine-verifiable integrity for **terrain derivative artifacts**  
(DEMs, hillshades, contours, slope maps) generated by the ETL pipeline.

[![Build & Deploy](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/site.yml/badge.svg)](../../../../.github/workflows/site.yml)
[![STAC Validate](https://img.shields.io/badge/STAC-validate-blue)](../../../../.github/workflows/stac-validate.yml)
[![CodeQL](https://img.shields.io/github/actions/workflow/status/bartytime4life/Kansas-Frontier-Matrix/codeql.yml?label=CodeQL)](../../../../.github/workflows/codeql.yml)
[![Trivy](https://img.shields.io/badge/Container-Scan-informational)](../../../../.github/workflows/trivy.yml)
[![Pre-Commit](https://img.shields.io/badge/Pre--Commit-enabled-success)](../../../../.github/workflows/pre-commit.yml)
[![Docs · MCP](https://img.shields.io/badge/Docs-MCP-green)](../../../../docs/)
[![License: CC-BY 4.0](https://img.shields.io/badge/License-CC--BY%204.0-lightgrey)](../../../../LICENSE)

</div>

---

## 📚 Table of Contents
- [Overview](#overview)
- [Checksum Flow](#checksum-flow)
- [Directory Layout](#directory-layout)
- [Algorithm & File Format](#algorithm--file-format)
- [Generate & Verify](#generate--verify)
- [STAC Integration](#stac-integration)
- [Knowledge Graph Integration](#knowledge-graph-integration)
- [Policy](#policy)
- [Example](#example)
- [Reproducibility & MCP Alignment](#reproducibility--mcp-alignment)
- [Related Docs](#related-docs)
- [Changelog](#changelog)

---

## 🗺️ Overview

This directory stores **SHA-256 checksum manifests** for all processed terrain derivative layers under  
`data/derivatives/terrain/`. Checksums ensure **integrity, reproducibility, and provenance**  
for DEMs, hillshades, contour maps, and slope rasters throughout the  
**KFM ETL → STAC → Knowledge Graph → Web UI** pipeline.

Each `.sha256` file cryptographically verifies its paired artifact — forming a digital integrity chain.

---

## 🧭 Checksum Flow

```mermaid
flowchart TD
  A["Sources\nLiDAR · DEM · 3DEP"] --> B["ETL\nNormalize · Reproject · Derive"]
  B --> C["Terrain Derivatives\nHillshade · Slope · Contour"]
  C --> D["Compute SHA-256\n*.sha256 manifests"]
  D --> E["STAC Items\nlink checksum metadata"]
  E --> F["Knowledge Graph\nprovenance + verification nodes"]
  F --> G["Web UI\nserve verified terrain assets"]
  click C "_blank" "data/derivatives/terrain/"
  click E "_blank" "data/stac/"
````

<!-- END OF MERMAID -->

> 🔒 Every artifact in `data/derivatives/terrain/` **must have an exact `.sha256` match**
> before STAC validation and knowledge graph ingestion can proceed.

---

## 🗂️ Directory Layout

```bash
data/
└── derivatives/
    └── terrain/
        ├── checksums/
        │   ├── dem_1m_ks_cog.tif.sha256
        │   ├── hillshade_ks_1m.tif.sha256
        │   ├── slope_ks_1m.tif.sha256
        │   ├── contour_ks_10m.geojson.sha256
        │   └── README.md
```

Each `.sha256` file verifies one terrain artifact at the parent level.
Checksums are recalculated via **Makefile targets**, **pre-commit hooks**, or **CI pipelines**.

---

## 🧪 Algorithm & File Format

| Property           | Specification                                                        |
| :----------------- | :------------------------------------------------------------------- |
| **Algorithm**      | SHA-256 (hex digest)                                                 |
| **Format**         | `<HEX_DIGEST>  <FILENAME>` (single line, 2 spaces)                   |
| **Encoding**       | UTF-8, LF (`\n`)                                                     |
| **Scope**          | Computed over the binary contents of each terrain artifact           |
| **Tools**          | `sha256sum` (Linux) / `shasum -a 256` (macOS)                        |
| **CI Enforcement** | `make validate-checksums` (in `.github/workflows/stac-validate.yml`) |

---

## 🛠️ Generate & Verify

### 🧮 Manual Generation

```bash
cd data/derivatives/terrain
for f in *.tif *.geojson; do
  [ -f "$f" ] && shasum -a 256 "$f" > "checksums/${f}.sha256"
done
```

### 🔍 Verification

```bash
cd data/derivatives/terrain
for c in checksums/*.sha256; do
  base=$(basename "$c" .sha256)
  sha256sum -c "checksums/${base}.sha256" || echo "Mismatch: $base"
done
```

### ⚙️ Makefile Integration

```make
checksums:
	@cd data/derivatives/terrain && \
	for f in *.tif *.geojson; do \
	  [ -f "$$f" ] || continue; \
	  shasum -a 256 "$$f" > "checksums/$$f.sha256"; \
	done

validate-checksums:
	@cd data/derivatives/terrain && \
	for c in checksums/*.sha256; do \
	  sha256sum -c "$$c" || exit 1; \
	done
```

---

## 🔗 STAC Integration

Checksums are embedded in each STAC item asset block:

```json
"assets": {
  "hillshade": {
    "href": "../../terrain/hillshade_ks_1m.tif",
    "type": "image/tiff; application=geotiff; profile=cloud-optimized",
    "checksum:sha256": "e3b0c44298fc1c149afbf4c8996fb924..."
  }
}
```

🧩 STAC validation ensures all listed checksums **match the artifact hashes** before catalog deployment.

---

## 🧠 Knowledge Graph Integration

Terrain derivative layers are represented as graph nodes in Neo4j:

| Property          | Description                                 |
| :---------------- | :------------------------------------------ |
| `checksum_sha256` | Digest from this directory                  |
| `source_id`       | Original source dataset (e.g., `usgs_3dep`) |
| `mcp_stage`       | `"derivatives"`                             |
| `confidence`      | Validation score (`1.0` for verified)       |

Checksum nodes link to source and STAC entities, closing the provenance chain.

---

## ✅ Policy

1. **Every derivative** must include a `.sha256` before STAC validation.
2. **CI fails** if checksum mismatch occurs or file is missing.
3. **Never edit manually** — regenerate after modifying binary assets.
4. **Pull requests** altering `.tif` or `.geojson` must include updated `.sha256`.
5. **ETL reproducibility:** all checksum diffs are logged to `provenance.log`.

---

## 🧪 Example

```bash
# After updating DEM mosaic
gdalwarp -t_srs EPSG:4326 dem_ks_1m_raw.tif dem_ks_1m_cog.tif
shasum -a 256 dem_ks_1m_cog.tif > checksums/dem_ks_1m_cog.tif.sha256
```

> ✅ Output format:
>
> ```
> 9b74c9897bac770ffc029102a200c5de  dem_ks_1m_cog.tif
> ```

---

## 🔒 Reproducibility & MCP Alignment

This folder exemplifies **Master Coder Protocol** principles:

* **Traceability:** Each checksum is linked to dataset lineage and commit ID.
* **Auditability:** CI revalidates hashes and flags mismatches automatically.
* **Reproducibility:** Any artifact can be verified independently years later.
* **Transparency:** Checksum manifests are version-controlled and immutable post-generation.

Together, these form the **integrity backbone** between ETL, STAC, and graph provenance.

---

## 🧱 Related Docs

* [`data/derivatives/terrain/metadata/README.md`](../metadata/README.md) — Descriptive metadata
* [`data/stac/README.md`](../../../stac/README.md) — STAC catalog references
* [`docs/architecture.md`](../../../../docs/architecture.md) — Pipeline architecture
* [`docs/standards/markdown_protocol.md`](../../../../docs/standards/markdown_protocol.md) — Markdown versioning standard

---

## 🗓 Changelog

| Version    | Date       | Notes                                                                                                   |
| :--------- | :--------- | :------------------------------------------------------------------------------------------------------ |
| **v1.1.0** | 2025-10-11 | Upgraded to Markdown Protocol v1.0, added versioning, Makefile integration, and clarified STAC linkage. |
| **v0.1.0** | 2025-10-10 | Initial release for terrain derivative checksum protocol.                                               |

```
```
