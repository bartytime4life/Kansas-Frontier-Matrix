<div align="center">

# 🧾 Kansas Frontier Matrix — Terrain Derivative Checksums  
`data/derivatives/terrain/checksums/`

**Purpose:** Provide reproducible, machine-verifiable integrity for **terrain derivative artifacts**  
(DEMs, hillshades, contours, slope maps) generated by the ETL pipeline.

[![Build & Deploy](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/site.yml/badge.svg)](../../../../../.github/workflows/site.yml)
[![STAC Validate](https://img.shields.io/badge/STAC-validate-blue)](../../../../../.github/workflows/stac-validate.yml)
[![CodeQL](https://img.shields.io/github/actions/workflow/status/bartytime4life/Kansas-Frontier-Matrix/codeql.yml?label=CodeQL)](../../../../../.github/workflows/codeql.yml)
[![Trivy](https://img.shields.io/badge/Container-Scan-informational)](../../../../../.github/workflows/trivy.yml)
[![Docs · MCP](https://img.shields.io/badge/Docs-MCP-green)](../../../../../docs/)
[![License: CC-BY 4.0](https://img.shields.io/badge/License-CC--BY%204.0-lightgrey)](../../../../../LICENSE)

</div>

---

## 📚 Overview

This directory stores **SHA-256 checksum manifests** for all processed terrain derivative layers under  
`data/derivatives/terrain/`.  
Checksums ensure the **integrity, reproducibility, and provenance** of DEMs, hillshades, contour maps, and slope rasters used throughout the KFM ETL → STAC → Knowledge Graph → Web UI pipeline.  
Each `.sha256` file cryptographically verifies the integrity of its paired artifact.

---

## 🧭 Checksum Flow (GitHub-safe Mermaid)

```mermaid
flowchart TD
  A["Sources\nLiDAR · DEM · 3DEP"] --> B["ETL\nNormalize · Reproject · Derive"]
  B --> C["Terrain Derivatives\nHillshade · Slope · Contour"]
  C --> D["Compute SHA-256\n*.sha256 files"]
  D --> E["STAC Items\nlink checksum metadata"]
  E --> F["Graph Load\nprovenance + validation"]
  F --> G["Web UI\nserve verified terrain assets"]
  click C "_blank" "data/derivatives/terrain/"
  click E "_blank" "data/stac/"
%% END OF MERMAID

<!-- END OF MERMAID -->


The checksums serve as validation gates — every file in data/derivatives/terrain/ must have an exact .sha256 match prior to STAC validation and graph ingestion.

⸻

🗂 Directory Layout

terrain/
├── dem_1m_ks_cog.tif.sha256
├── hillshade_ks_1m.tif.sha256
├── slope_ks_1m.tif.sha256
├── contour_ks_10m.geojson.sha256
└── README.md

Each .sha256 file verifies one terrain artifact at the parent level.
The hashes are recalculated and validated via Makefile targets or CI pipelines.

⸻

🧪 Algorithm & File Format
	•	Algorithm: SHA-256 (hex digest)
	•	Format: <HEX_DIGEST>  <FILENAME> (single line)
	•	Encoding: UTF-8 / LF (\n)
	•	Scope: Hash computed over the actual file bytes in data/derivatives/terrain/
	•	Tooling: shasum -a 256 (macOS) or sha256sum (GNU coreutils)

⸻

🛠️ Generate & Verify

Generate (manual)

cd data/derivatives/terrain
for f in *.tif *.geojson; do
  [ -f "$f" ] && shasum -a 256 "$f" > "checksums/${f}.sha256"
done

Verify (portable)

cd data/derivatives/terrain
for c in checksums/*.sha256; do
  base=$(basename "$c" .sha256)
  sha256sum -c "checksums/${base}.sha256" || echo "Mismatch: $base"
done

Makefile Integration

checksums:
	@cd data/derivatives/terrain && \
	for f in *.tif *.geojson; do \
	  [ -f "$$f" ] || continue; \
	  shasum -a 256 "$$f" > "checksums/$$f.sha256"; \
	done


⸻

🔗 STAC Integration

Each derivative checksum is referenced in the corresponding STAC Item as:

"assets": {
  "hillshade": {
    "href": "../../terrain/hillshade_ks_1m.tif",
    "checksum:sha256": "e3b0c44298fc1c149afbf4c8996fb924..."
  }
}

Checksum links are validated by the STAC Validate GitHub Action, ensuring end-to-end reproducibility from ETL → STAC → Graph → Web UI.

⸻

🧩 Knowledge Graph Integration

Terrain derivatives (DEMs, slopes, contours) are nodes in the Neo4j knowledge graph, with properties:

Property	Description
checksum_sha256	Digest from this folder
source_id	Points to original dataset (e.g., USGS 3DEP)
mcp_stage	"derivatives"
confidence	Numeric validation score (1.0 for verified)


⸻

✅ Policy
	1.	Every terrain derivative must include a .sha256 file before STAC validation.
	2.	CI fails if any checksum mismatch occurs.
	3.	Never manually edit checksum files. Always regenerate after modification.
	4.	Include checksum updates in all PRs that change derivative outputs.

⸻

🧪 Example

# After updating DEM mosaic:
gdalwarp -t_srs EPSG:4326 dem_ks_1m_raw.tif dem_ks_1m_cog.tif
shasum -a 256 dem_ks_1m_cog.tif > checksums/dem_ks_1m_cog.tif.sha256


⸻

🔒 Reproducibility & MCP Alignment

This folder operationalizes Master Coder Protocol principles by ensuring every artifact is:
	•	Traceable: Each checksum links to source + commit.
	•	Auditable: CI revalidates hashes and STAC metadata.
	•	Reproducible: Exact artifact bytes verifiable at any point.

The checksum manifests form a core integrity chain connecting the ETL layer, STAC catalog, and knowledge graph provenance logs.

⸻

🧱 Related Docs
	•	data/derivatives/terrain/metadata/README.md — descriptive metadata
	•	data/stac/README.md — STAC catalog references
	•	docs/architecture.md — pipeline architecture

⸻

🗓 Version History

Version	Date	Notes
0.1.0	2025-10-10	Initial release for terrain derivatives checksum protocol.