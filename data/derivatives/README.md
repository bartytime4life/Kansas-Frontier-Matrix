
<div align="center">

# ğŸ§­ Kansas-Frontier-Matrix â€” Derived Geospatial Products

**Mission:** hold **analysis-ready derivatives** computed from canonical COGs (`data/cogs/`)  
and curated inputs (`data/sources/`).  
All outputs are **reproducible, checksummed, and preferably registered as STAC Items**.

[![Build & Deploy](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/site.yml/badge.svg)](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/site.yml)
[![STAC Validate](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/stac-badges.yml/badge.svg)](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/stac-badges.yml)
[![Pre-commit](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/pre-commit.yml/badge.svg)](https://github.com/bartytime4life/Kansas-Frontier-Matrix/.pre-commit-config.yaml)

</div>

---

```mermaid
flowchart LR
  A["COGs and sources\n(data/cogs & data/sources)"] --> B["Derive\n(terrain Â· hydro Â· change)"]
  B --> C["Derivatives\n(data/derivatives/**)"]
  C --> D["Checksums\n(.sha256)"]
  C --> E["STAC items\n(stac/items)"]
  C --> F["Tiles\n(PMTiles / MBTiles)"]
  F --> G["Web viewer\n(MapLibre)"]
  E --> H["Validate\n(stac validate)"]

<!-- END OF MERMAID -->



â¸»

âœ… What belongs here (and what doesnâ€™t)
	â€¢	Belongs: computed artifacts (rasters, vectors, tiles) that can be re-generated by scripts.
	â€¢	Doesnâ€™t: raw acquisitions and mission-final COGs â†’ keep those under data/cogs/**.
Derivatives may reference COGs but must not modify them in place.

â¸»

ğŸ“‚ Directory layout

data/
â””â”€ derivatives/
   â”œâ”€ terrain/     # slope, aspect, TRI, TPI, roughness, shaded blends
   â”œâ”€ hydrology/   # filled DEM, flowdir, flowacc, streams, basins
   â”œâ”€ contours/    # vector contours (GPKG), index contours, labels
   â”œâ”€ change/      # DEMs of Difference (DoD), erosion-deposition
   â”œâ”€ vectors/     # extracted ridges/valleys, geomorph features (GPKG)
   â”œâ”€ tiles/       # PMTiles / MBTiles (raster or vector)
   â””â”€ _meta/       # schemas, templates, shared LUTs/palettes

Each artifact should include:
	â€¢	ğŸ”’ Checksum sidecar â†’ *.{ext}.sha256 (GNU format)
	â€¢	ğŸ—‚ STAC Item in stac/items/** (preferred)
	â€¢	ğŸ“ Optional .meta.json (small pipeline notes)
	â€¢	ğŸ–¼ Optional preview â†’ *_preview.png (~1â€“2 MP)

â¸»

ğŸ· Naming conventions

<theme>/<region>*<product>[*<params>]_<year-or-range>[_v<semver>].<ext>

Examples
	â€¢	terrain/ks_slope_2018_2020.tif
	â€¢	terrain/ks_aspect_2018_2020.tif
	â€¢	contours/ks_contours_10m_2018_2020.gpkg
	â€¢	hydrology/ks_flowdir_d8_2018_2020.tif
	â€¢	change/ks_dem_DoD_1894_2020.tif
	â€¢	tiles/ks_hillshade_2018_2020.pmtiles

â¸»

ğŸ” Sidecars

Checksum generation:

cd data/derivatives/<subdir> && \
  sha256sum <name>.<ext> > <name>.<ext>.sha256

Verify later:

sha256sum -c data/derivatives/<subdir>/<name>.<ext>.sha256

Optional .meta.json (prefer STAC when possible):

{
  "id": "ks_slope_2018_2020",
  "version": "1.0.0",
  "type": "raster-derivative",
  "product": "slope",
  "title": "Kansas Slope (degrees, from 1 m DEM 2018â€“2020)",
  "derived_from": [
    {
      "id": "ks_1m_dem_2018_2020",
      "path": "data/cogs/dem/ks_1m_dem_2018_2020.tif",
      "sha256": "data/cogs/dem/ks_1m_dem_2018_2020.tif.sha256"
    }
  ],
  "files": {
    "primary": {
      "path": "data/derivatives/terrain/ks_slope_2018_2020.tif",
      "sha256": "data/derivatives/terrain/ks_slope_2018_2020.tif.sha256"
    }
  },
  "processing": {
    "software": { "gdal": "3.6+" },
    "commands": [
      "gdaldem slope -s 1.0 -of GTiff data/cogs/dem/ks_1m_dem_2018_2020.tif /tmp/ks_slope.tif",
      "gdal_translate -of COG -co COMPRESS=DEFLATE -co PREDICTOR=2 /tmp/ks_slope.tif data/derivatives/terrain/ks_slope_2018_2020.tif"
    ],
    "params": { "units": "degree", "scale_z": 1.0 }
  }
}


â¸»

ğŸ§ª Standard derivatives & recipes

See docs/templates/sop.md for detailed workflows.
Key recipes include:
	â€¢	Slope / Aspect (gdaldem)
	â€¢	TRI / TPI / Roughness (gdaldem)
	â€¢	Hydrology (WhiteboxTools: Fill â†’ FlowDir â†’ FlowAcc)
	â€¢	Contours (gdal_contour)
	â€¢	DoD (gdalwarp align â†’ gdal_calc.py differencing)
	â€¢	Web Tiles (rio-tiler â†’ pmtiles or gdal2tiles â†’ MBTiles)

All outputs should be COG when practical, aligned to Kansas CRS (EPSG:26914 UTM14N, or EPSG:6344 where required).

â¸»

ğŸ§° Makefile snippets

DERIV := data/derivatives

# Ensure subdirs exist
$(DERIV)/%/:
	@mkdir -p $@

# Slope / Aspect from DEM
$(DERIV)/terrain/ks_slope_2018_2020.tif: data/cogs/dem/ks_1m_dem_2018_2020.tif | $(DERIV)/terrain/
	gdaldem slope -s 1.0 $< /tmp/ks_slope.tif
	gdal_translate -of COG -co COMPRESS=DEFLATE -co PREDICTOR=2 /tmp/ks_slope.tif $@

$(DERIV)/terrain/ks_aspect_2018_2020.tif: data/cogs/dem/ks_1m_dem_2018_2020.tif | $(DERIV)/terrain/
	gdaldem aspect $< /tmp/ks_aspect.tif
	gdal_translate -of COG -co COMPRESS=DEFLATE -co PREDICTOR=2 /tmp/ks_aspect.tif $@

# Contours
$(DERIV)/contours/ks_contours_10m_2018_2020.gpkg: data/cogs/dem/ks_1m_dem_2018_2020.tif | $(DERIV)/contours/
	gdal_contour -a elev -i 10.0 $< $@

.PHONY: derivatives-all
derivatives-all: \
  $(DERIV)/terrain/ks_slope_2018_2020.tif \
  $(DERIV)/terrain/ks_aspect_2018_2020.tif \
  $(DERIV)/contours/ks_contours_10m_2018_2020.gpkg


â¸»

âœ… Validation
	â€¢	STAC Items:

make stac-validate-items


	â€¢	Meta JSON sanity check:

find data/derivatives -name "*.meta.json" -print0 | \
  xargs -0 -I{} jq -e 'type=="object"' {}


	â€¢	Checksum verification:

find data/derivatives -name "*.sha256" -print0 | \
  xargs -0 -I{} sha256sum -c {}



â¸»

ğŸ”— Web viewer wiring

Add a layer entry in web/config/layers.json:

{
  "id": "ks_slope_2018_2020",
  "title": "Slope (degrees, 2018â€“2020)",
  "type": "raster",
  "data": "data/derivatives/terrain/ks_slope_2018_2020.tif",
  "category": "terrain",
  "opacity": 0.7,
  "visible": false,
  "attribution": "Derived from USGS 3DEP DEM (Public Domain)"
}

If tiled, use the pmtiles://â€¦ URL instead of a raw COG.

â¸»

ğŸ§­ Tips
	â€¢	Prefer tile size 512 for large rasters (better range reads).
	â€¢	Continuous rasters â†’ DEFLATE + PREDICTOR=2; scanned maps â†’ JPEG/WebP.
	â€¢	Hydrology & DoD demand exact grid alignment.
	â€¢	Track big artifacts with Git LFS or DVC; commit only checksums + STAC JSON.

Owner: Data Engineering / MCP
PR label: data:derivative

---
