<div align="center">

# ğŸŒ¾ Kansas Frontier Matrix â€” Landcover Derivative Checksums  
`data/derivatives/landcover/checksums/`

**Purpose:** Maintain verified **SHA-256 integrity manifests** for all **landcover derivative datasets**  
(NLCD layers, vegetation rasters, canopy composites, historical land-use grids) generated by the KFM ETL.

[![Build & Deploy](https://img.shields.io/github/actions/workflow/status/bartytime4life/Kansas-Frontier-Matrix/site.yml?label=Build%20%26%20Deploy)](../../../../../.github/workflows/site.yml)
[![STAC Validate](https://img.shields.io/badge/STAC-validate-blue)](../../../../../.github/workflows/stac-validate.yml)
[![CodeQL](https://img.shields.io/github/actions/workflow/status/bartytime4life/Kansas-Frontier-Matrix/codeql.yml?label=CodeQL)](../../../../../.github/workflows/codeql.yml)
[![Trivy](https://img.shields.io/badge/Container-Scan-informational)](../../../../../.github/workflows/trivy.yml)
[![Docs Â· MCP](https://img.shields.io/badge/Docs-MCP-green)](../../../../../docs/)
[![License: CC-BY 4.0](https://img.shields.io/badge/License-CC--BY%204.0-lightgrey)](../../../../../LICENSE)

</div>

---

## ğŸ“š Overview

This directory stores **SHA-256 checksum files** (`*.sha256`) for every processed artifact in  
`data/derivatives/landcover/` (COG GeoTIFF, GeoJSON, Parquet, CSV).

Checksums support the KFM **ETL â†’ STAC â†’ Graph â†’ API** chain to:
- âœ… verify file integrity and detect drift across builds,  
- ğŸ” guarantee reproducibility, and  
- ğŸ§© preserve lineage for vegetation & land-use derivatives.

Typical datasets include: historical vegetation maps, NLCD composites, cropland/grassland masks, and canopy-height grids.

---

## ğŸ§­ Checksum Generation Flow

```mermaid
flowchart TD
  A["Landcover Sources<br/>USGS NLCD Â· KARS Â· USDA NRCS"] --> B["ETL<br/>Extract Â· Normalize Â· Derive"]
  B --> C["Landcover Derivatives<br/>COG Â· GeoJSON Â· Parquet Â· CSV"]
  C --> D["Compute SHA-256<br/>Emit *.sha256 manifests"]
  D --> E["STAC Items<br/>Embed checksum + provenance"]
  E --> F["Knowledge Graph<br/>checksum properties + relations"]
  F --> G["API & Web UI<br/>serve verified landcover layers"]
````

<!-- END OF MERMAID -->

---

## ğŸ—‚ï¸ Directory Layout

```bash
data/derivatives/landcover/checksums/
â”œâ”€â”€ nlcd_1992_2021_cog.tif.sha256
â”œâ”€â”€ landuse_1900_2000_composite_cog.tif.sha256
â”œâ”€â”€ vegetation_zones_1850_ks.geojson.sha256
â”œâ”€â”€ prairie_extent_2020_cog.tif.sha256
â””â”€â”€ README.md
```

Each `.sha256` file corresponds to a sibling artifact in `../` and contains a single-line digest for provenance validation.

---

## ğŸ§¾ Manifest File Format

| Property         | Description                                          |
| :--------------- | :--------------------------------------------------- |
| **Algorithm**    | SHA-256 (hex)                                        |
| **Line**         | `<HEX_DIGEST><space><space><filename>`               |
| **Line Endings** | `LF` (`\n`)                                          |
| **Scope**        | Digest over artifact **binary bytes** (not symlinks) |
| **Purpose**      | CI integrity checks & STAC compliance validation     |

Example:

```text
edb8a2c1ff34a27dfb1f6c2c7e2b8c0e...  nlcd_1992_2021_cog.tif
```

---

## ğŸ› ï¸ Generate & Verify

### Bash (portable)

```bash
# Generate checksums (Linux: sha256sum; macOS: gsha256sum via coreutils, or shasum -a 256)
cd data/derivatives/landcover
mkdir -p checksums
for f in *.tif *.geojson *.parquet *.csv; do
  [ -f "$f" ] || continue
  if command -v sha256sum >/dev/null 2>&1; then
    sha256sum "$f" > "checksums/${f}.sha256"
  else
    shasum -a 256 "$f" > "checksums/${f}.sha256"
  fi
done

# Verify checksums
cd data/derivatives/landcover
for c in checksums/*.sha256; do
  if command -v sha256sum >/dev/null 2>&1; then
    sha256sum -c "$c"
  else
    # macOS shasum doesn't read manifests; compare manually
    digest_expected=$(cut -d' ' -f1 "$c")
    file=$(cut -d' ' -f3- "$c")
    digest_actual=$(shasum -a 256 "$file" | cut -d' ' -f1)
    [ "$digest_expected" = "$digest_actual" ] && echo "$file: OK" || { echo "$file: FAILED"; exit 1; }
  fi
done
```

### Makefile (recommended)

```make
# data/derivatives/landcover/Makefile (excerpt)

CHECK_DIR := checksums
PATTERNS  := *.tif *.geojson *.parquet *.csv

generate-checksums:
	@mkdir -p $(CHECK_DIR)
	@set -e; \
	for f in $(PATTERNS); do \
	  [ -f "$$f" ] || continue; \
	  if command -v sha256sum >/dev/null 2>&1; then \
	    sha256sum "$$f" > "$(CHECK_DIR)/$$f.sha256"; \
	  else \
	    shasum -a 256 "$$f" > "$(CHECK_DIR)/$$f.sha256"; \
	  fi; \
	done

verify-checksums:
	@set -e; \
	for c in $(CHECK_DIR)/*.sha256; do \
	  if command -v sha256sum >/dev/null 2>&1; then \
	    sha256sum -c "$$c"; \
	  else \
	    exp=$$(cut -d' ' -f1 "$$c"); \
	    file=$$(cut -d' ' -f3- "$$c"); \
	    act=$$(shasum -a 256 "$$file" | cut -d' ' -f1); \
	    test "$$exp" = "$$act" && echo "$$file: OK" || (echo "$$file: FAILED"; exit 1); \
	  fi; \
	done
```

> âœ… Use `sha256sum` (Linux) or `shasum -a 256` (macOS). Both produce identical hex digests.

---

## ğŸ”— STAC Integration (Provenance)

| STAC Field                     | Example                         |
| :----------------------------- | :------------------------------ |
| `assets.<key>.href`            | `"nlcd_1992_2021_cog.tif"`      |
| `assets.<key>.checksum:sha256` | `"edb8a2c1ff34a27dâ€¦"`           |
| `properties["kfm:provenance"]` | `"data/sources/usgs_nlcd.json"` |

Checksums are embedded in STAC Items to guarantee authenticity and drive CI validation.

---

## ğŸ§© Knowledge Graph & API

* Neo4j asset nodes persist `checksum_sha256`.
* API: `GET /api/landcover/{id}/checksum` returns the digest for client-side verification.
* Web UI layer panel surfaces status: **âœ… verified** / **âš ï¸ out-of-date**.

---

## ğŸ§± Naming Conventions

| Pattern                                      | Example                                      | Notes                 |
| :------------------------------------------- | :------------------------------------------- | :-------------------- |
| `<dataset>_<years>_cog.tif.sha256`           | `nlcd_1992_2021_cog.tif.sha256`              | Multi-year COG raster |
| `<dataset>_<range>_composite_cog.tif.sha256` | `landuse_1900_2000_composite_cog.tif.sha256` | Historical composites |
| `<dataset>_<region>.geojson.sha256`          | `vegetation_zones_1850_ks.geojson.sha256`    | Vector polygons       |
| `<dataset>_<year>_cog.tif.sha256`            | `prairie_extent_2020_cog.tif.sha256`         | Single-epoch raster   |

---

## âœ… Policy

1. **Every derivative** must ship with a matching `.sha256`.
2. **Recompute** after any modification (reprojection, compression, tiling, etc.).
3. **CI gate:** `stac-validate.yml` fails if STAC checksum â‰  manifest.
4. **PRs** that alter artifacts must update corresponding `.sha256` files.

---

## âš™ï¸ CI/CD Integration

* Workflow: [`.github/workflows/stac-validate.yml`](../../../../../.github/workflows/stac-validate.yml)
* Steps: generate â†’ verify â†’ compare to STAC â†’ upload logs (artifacts).
* Failing checksum checks **block merges** to protected branches.

---

## âœ… MCP Compliance Summary

| MCP Principle       | Implemented | Evidence                               |
| :------------------ | :---------: | :------------------------------------- |
| Documentation-First |      âœ…      | README + manifests in VCS              |
| Reproducibility     |      âœ…      | Deterministic digests, CI verification |
| Provenance          |      âœ…      | STAC `checksum:sha256` + source links  |
| Transparency        |      âœ…      | Open formats + logs as artifacts       |
| Versioning          |      âœ…      | Semantic doc version + PR checks       |

---

## ğŸ§± Related Documentation

* [`../metadata/README.md`](../metadata/README.md) â€” metadata schema & linkage
* [`../../stac/README.md`](../../stac/README.md) â€” STAC item & catalog structure
* [`../../../../docs/architecture.md`](../../../../docs/architecture.md) â€” ETL, STAC, provenance architecture
* [`../../sources/README.md`](../../sources/README.md) â€” landcover source manifest guidelines

---

## ğŸ—“ï¸ Version History

| Version    | Date       | Notes                                                                      |
| :--------- | :--------- | :------------------------------------------------------------------------- |
| **v1.1.0** | 2025-10-11 | Added Makefile targets, CI section, MCP checklist, and GitHub-safe Mermaid |
| **v0.1.0** | 2025-10-10 | Initial checksum policy and examples                                       |

---

## ğŸª¶ License & Provenance

**License:** [CC-BY 4.0](../../../../../LICENSE)
**Provenance:** Managed under the **Master Coder Protocol (MCP)** â€” auditable, reproducible integrity controls.
**Maintainers:** Kansas Frontier Matrix â€” Landcover & Ecology Integration Team
**Last Updated:** 2025-10-11

```
```
