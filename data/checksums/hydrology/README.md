<div align="center">

# üíß Kansas Frontier Matrix ‚Äî Hydrology Checksums  
`data/checksums/hydrology/`

**Mission:** Guarantee **data integrity, reproducibility, and provenance**  
for all processed hydrology datasets in the Kansas Frontier Matrix (KFM) ‚Äî including rivers, watersheds,  
flood zones, aquifers, and groundwater levels ‚Äî through **SHA-256 checksum verification**  
and **continuous CI/CD validation**.

[![Build & Deploy](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/site.yml/badge.svg)](../../../.github/workflows/site.yml)
[![STAC Validate](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/stac-validate.yml/badge.svg)](../../../.github/workflows/stac-validate.yml)
[![CodeQL](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/codeql.yml/badge.svg)](../../../.github/workflows/codeql.yml)
[![Trivy Security](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/trivy.yml/badge.svg)](../../../.github/workflows/trivy.yml)
[![Docs ¬∑ MCP](https://img.shields.io/badge/Docs-MCP-blue)](../../../docs/)
[![License: Data](https://img.shields.io/badge/License-CC--BY%204.0-green)](../../../LICENSE)

</div>

---

## üìö Overview

The `data/checksums/hydrology/` directory houses **SHA-256 checksum files (`.sha256`)**  
for all **processed hydrology datasets** within the Kansas Frontier Matrix (KFM).  

Each checksum file acts as a **cryptographic fingerprint**, confirming that hydrologic data has not changed  
since its validation and ensuring reproducibility and transparency across processing environments.

**Checksums provide:**
- üíß **Integrity** ‚Äî Detects file corruption, bit-flips, or manual modification.  
- üßÆ **Reproducibility** ‚Äî Verifies deterministic ETL outputs across rebuilds.  
- üîó **Provenance** ‚Äî Links datasets to metadata, STAC assets, and original data sources.  
- üîç **Auditability** ‚Äî Enables automated verification and CI/CD enforcement.  

All `.sha256` files are automatically generated by the **Hydrology ETL pipeline (`make hydrology`)**  
and validated in real time during GitHub Actions workflows.

---

## üóÇÔ∏è Directory Layout

```bash
data/checksums/hydrology/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ nhd_flowlines_ks.geojson.sha256
‚îú‚îÄ‚îÄ watersheds_huc12_ks.geojson.sha256
‚îú‚îÄ‚îÄ fema_nfhl_ks.geojson.sha256
‚îú‚îÄ‚îÄ groundwater_levels_ks.geojson.sha256
‚îî‚îÄ‚îÄ flood_events_ks.geojson.sha256
````

> **Note:** Each `.sha256` file corresponds to a dataset in
> `data/processed/hydrology/` and is verified automatically using `sha256sum -c` in CI/CD workflows.

---

## üîê Purpose & Scope

| Objective           | Description                                                                              |
| :------------------ | :--------------------------------------------------------------------------------------- |
| **Data Integrity**  | Detects corruption or tampering in hydrology datasets during transit or storage.         |
| **Reproducibility** | Ensures identical ETL results when pipelines re-run under the same configuration.        |
| **Provenance**      | Creates verifiable linkage between processed outputs, STAC assets, and raw data sources. |
| **Automation**      | Embedded into CI/CD workflows for continuous validation and monitoring.                  |
| **Transparency**    | Supports MCP‚Äôs audit and traceability goals for scientific reproducibility.              |

---

## üßÆ Example `.sha256` File

```bash
# File: watersheds_huc12_ks.geojson.sha256
a30f8ccbd7f2b6171cbfe38bb99a4c28a7f26dcbf2a032dcac34d79b94cf6a0f  watersheds_huc12_ks.geojson
```

This checksum verifies that the file
`data/processed/hydrology/watersheds_huc12_ks.geojson` remains identical to its reference hash.

---

## ‚öôÔ∏è Generation Workflow

Checksums are generated automatically during ETL completion but can be triggered manually.

**Makefile target:**

```bash
make hydrology-checksums
```

**Python command:**

```bash
python src/utils/generate_checksums.py data/processed/hydrology/ --algo sha256
```

**Workflow Steps:**

1. Discover all hydrology outputs (`.geojson`, `.tif`, `.csv`).
2. Compute SHA-256 hash for each file using `hashlib`.
3. Write `<filename>.sha256` files into `data/checksums/hydrology/`.
4. CI/CD validation re-computes and cross-checks all hashes on every commit.
5. Logs are stored under `data/work/logs/hydrology_checksums.log`.

---

## üß∞ CI/CD Validation

**Command executed in CI:**

```bash
sha256sum -c data/checksums/hydrology/*.sha256
```

**Behavior:**

* ‚úÖ Success: Files are unmodified and verified.
* ‚ùå Failure: Build halts; dataset must be reprocessed, checksum regenerated, and committed.
* üßæ Logs: Validation results archived under `data/work/logs/` for audit tracking.

These checks integrate with the **STAC validation workflow**
(`.github/workflows/stac-validate.yml`) ensuring metadata and data integrity remain synchronized.

---

## üîó Integration with Metadata & STAC

| Linked Component                      | Function                                                        |
| :------------------------------------ | :-------------------------------------------------------------- |
| `data/processed/metadata/hydrology/`  | STAC Items embed `"checksum:sha256"` for dataset assets.        |
| `src/pipelines/hydrology_pipeline.py` | Generates hashes at the final stage of ETL execution.           |
| `.github/workflows/stac-validate.yml` | Validates checksum integrity alongside STAC schema conformance. |
| `data/stac/hydrology/`                | Stores checksum-referenced Items for discovery and provenance.  |
| `data/checksums/manifest.sha256`      | Aggregates all domain manifests for global verification.        |

---

## üß© Troubleshooting & Remediation

| Issue                       | Likely Cause                                                       | Recommended Fix                                                  |
| :-------------------------- | :----------------------------------------------------------------- | :--------------------------------------------------------------- |
| CI fails on hash mismatch   | File changed, truncated, or reprocessed without hash regeneration. | Run `make hydrology-checksums` and recommit new `.sha256` files. |
| File missing from directory | New data layer generated but checksum not created.                 | Execute `python src/utils/generate_checksums.py`.                |
| Hash mismatch in STAC       | STAC `checksum:sha256` not updated.                                | Run `make stac` to refresh all metadata.                         |
| Repeated random mismatches  | Non-deterministic file compression or timestamps.                  | Normalize pipeline compression and set `SOURCE_DATE_EPOCH`.      |

---

## üß† MCP Compliance Summary

| MCP Principle           | Implementation                                                           |
| :---------------------- | :----------------------------------------------------------------------- |
| **Documentation-first** | Each dataset includes README + `.sha256` manifest for transparency.      |
| **Reproducibility**     | Deterministic hashing ensures identical output verification across runs. |
| **Open Standards**      | Employs SHA-256 (FIPS 180-4) and STAC Checksum extension.                |
| **Provenance**          | Links data lineage through STAC metadata and global manifests.           |
| **Auditability**        | Continuous validation enforced via GitHub Actions with logged evidence.  |

---

## üìÖ Version History

| Version | Date       | Summary                                                                                                   |
| :------ | :--------- | :-------------------------------------------------------------------------------------------------------- |
| v1.0.0  | 2025-10-04 | Initial hydrology checksum documentation ‚Äî rivers, watersheds, floods, groundwater layers verified.       |
| v1.1.0  | 2025-10-10 | Added FEMA NFHL and flood event datasets; expanded CI logging, troubleshooting, and manifest integration. |

---

<div align="center">

**Kansas Frontier Matrix** ‚Äî *‚ÄúEvery River Verified: Data Integrity That Flows.‚Äù*
üìç [`data/checksums/hydrology/`](.) ¬∑ Linked to the **Hydrology STAC Collection** and Global Manifest Registry.

</div>
```
