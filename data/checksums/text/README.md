<div align="center">

# 🏔️ Kansas Frontier Matrix — Terrain Checksums  
`data/checksums/terrain/`

**Mission:** Maintain **integrity, reproducibility, and provenance** for all terrain and elevation datasets —  
every DEM, hillshade, slope/aspect raster, and terrain vector product is **cryptographically verified**,  
**reproducible**, and **linked via STAC** for transparent lineage.

[![Build & Deploy](https://img.shields.io/github/actions/workflow/status/bartytime4life/Kansas-Frontier-Matrix/site.yml?label=Build%20%26%20Deploy)](../../../.github/workflows/site.yml)  
[![STAC Validate](https://img.shields.io/badge/STAC-validate-blue)](../../../.github/workflows/stac-validate.yml)  
[![CodeQL](https://img.shields.io/github/actions/workflow/status/bartytime4life/Kansas-Frontier-Matrix/codeql.yml?label=CodeQL)](../../../.github/workflows/codeql.yml)  
[![Trivy Security](https://img.shields.io/github/actions/workflow/status/bartytime4life/Kansas-Frontier-Matrix/trivy.yml?label=Trivy%20Security)](../../../.github/workflows/trivy.yml)  
[![Docs · MCP](https://img.shields.io/badge/Docs-MCP-blue)](../../../docs/)  
[![License: CC-BY 4.0](https://img.shields.io/badge/License-CC--BY%204.0-green)](../../../LICENSE)

</div>

---

## 📚 Overview

The `data/checksums/terrain/` directory contains **SHA-256 checksum files (`.sha256`)**  
for all **processed terrain datasets** in KFM.

**What checksums guarantee**

- 🔒 **Integrity** — detect corruption or unauthorized change.  
- 🔁 **Reproducibility** — prove deterministic ETL outputs across machines/time.  
- 🔗 **Provenance** — bind processed assets to their **STAC** entries and source manifests.  
- 🧮 **Auditability** — CI/CD blocks merges when hashes drift.

All files are generated by the **Terrain ETL** and verified in CI.

---

## 🧭 Where checksums fit (terrain flow)

```mermaid
flowchart LR
  S["data/sources/terrain/*.json\nSource manifests"] --> R["data/raw/terrain/**\nRaw terrain data"]
  R --> P["src/pipelines/terrain_pipeline.py\nDeterministic ETL"]
  P --> O["data/processed/terrain/**\nCOG · GeoTIFF · GeoJSON"]
  O --> C["data/checksums/terrain/*.sha256\nPer-asset checksums"]
  O --> T["data/stac/terrain/**.json\nSTAC Items (checksum:sha256)"]
  C --> V["CI verify\nsha256sum -c"]
%% END OF MERMAID
````

<!-- END OF MERMAID -->

---

## 🗂️ Directory Layout

```bash
data/checksums/terrain/
├── README.md
├── ks_1m_dem_2018_2020.tif.sha256
├── ks_hillshade_2018_2020.tif.sha256
├── slope_aspect_2018_2020.tif.sha256
└── contour_lines_10m_ks.geojson.sha256
```

> Each `.sha256` corresponds to an asset in `data/processed/terrain/` and is validated via `sha256sum -c`.

---

## 🔐 Example `.sha256`

```bash
# File: ks_1m_dem_2018_2020.tif.sha256
f3c0b929a38ef47c7b41138dd726abf84a65a03b8b24e8e12db2fa89a5740c42  ks_1m_dem_2018_2020.tif
```

This certifies integrity of `data/processed/terrain/ks_1m_dem_2018_2020.tif`.

---

## ⚙️ Generation Workflow

**Makefile targets**

```bash
# Generate checksums for terrain outputs
make terrain-checksums

# Verify terrain checksums (used in CI)
make terrain-checksums-verify
```

**Python CLI (direct)**

```bash
python src/utils/generate_checksums.py data/processed/terrain/ --algo sha256
```

**Steps**

1. Scan `data/processed/terrain/` for `.tif`, `.cog`, `.geojson` (and other configured types).
2. Compute SHA-256 via `hashlib` (or `sha256sum`).
3. Write `<filename>.sha256` into `data/checksums/terrain/`.
4. CI runs verification and uploads logs to `data/work/logs/terrain_checksums.log`.

---

## 🧰 CI/CD Verification

**Command used by CI**

```bash
sha256sum -c data/checksums/terrain/*.sha256
```

**Outcomes**

* ✅ **Pass:** hashes match; STAC remains in sync.
* ❌ **Fail:** pipeline halts; reprocess asset and regenerate hash.
* 🗂️ **Logs:** `data/work/logs/` retains verification reports for MCP audits.

---

## 🔗 Integration with Metadata & STAC

| Component                                           | Purpose                                                        |
| :-------------------------------------------------- | :------------------------------------------------------------- |
| `data/stac/terrain/**.json`                         | STAC Items include `"checksum:sha256"` for each terrain asset. |
| `src/pipelines/terrain_pipeline.py`                 | Automates hashing, verification, and logging.                  |
| `.github/workflows/stac-validate.yml`               | Enforces STAC/Checksum parity during PR/merge.                 |
| `data/checksums/terrain/*.sha256`                   | Canonical per-asset integrity proofs for terrain outputs.      |
| `data/checksums/terrain/manifest.sha256` (optional) | Domain roll-up manifest referencing the per-asset entries.     |

---

## 🧩 Troubleshooting & Maintenance

| Issue                     | Likely cause                          | Resolution                                              |
| :------------------------ | :------------------------------------ | :------------------------------------------------------ |
| CI mismatch               | File changed after checksum generated | Rebuild via ETL → `make terrain-checksums` → commit.    |
| Missing `.sha256`         | New output not hashed                 | Run generator; add file to repo.                        |
| STAC vs checksum drift    | STAC still holds an old digest        | Update the STAC Item from current `.sha256`.            |
| Non-deterministic outputs | Timestamps/compression flags differ   | Pin deps, set `SOURCE_DATE_EPOCH`, normalize GDAL opts. |

---

## 🧠 MCP Compliance Summary

| MCP Principle           | Implementation                                                     |
| :---------------------- | :----------------------------------------------------------------- |
| **Documentation-first** | This README defines policy, commands, and linkages.                |
| **Reproducibility**     | Deterministic hashing + CI verification on each commit.            |
| **Open Standards**      | SHA-256 (FIPS 180-4), STAC checksum extension, POSIX paths, UTF-8. |
| **Provenance**          | Checksums + STAC Items bind assets to immutable identities.        |
| **Auditability**        | CI failure gates, logs retained for review.                        |

---

## 📅 Version History

| Version  | Date       | Summary                                                                                                     |
| :------- | :--------- | :---------------------------------------------------------------------------------------------------------- |
| **v1.2** | 2025-10-11 | Protocol upgrade: front-matter, Mermaid fix, CI targets split (`generate` vs `verify`), clearer STAC links. |
| **v1.1** | 2025-10-10 | Added contours, enhanced CI logging, troubleshooting, global manifest notes.                                |
| **v1.0** | 2025-10-04 | Initial terrain checksum docs — DEM, hillshade, slope/aspect verified.                                      |

---

<div align="center">

**Kansas Frontier Matrix** — *Elevation Verified, Integrity Preserved.*
📍 [`data/checksums/terrain/`](.) · Linked to **Terrain STAC** and the Global Manifest Registry.

</div>
```
