---
title: "ğŸ§± Surficial Geology â€” STAC Item Shards"
path: "data/surficial-geology/stac/items/shards/README.md"

version: "v0.1.0"
last_updated: "2025-12-14"
release_stage: "Draft / In-Progress"
content_stability: "draft"

status: "Active"
doc_kind: "Index"
header_profile: "standard"
footer_profile: "standard"

license: "CC-BY 4.0"
markdown_protocol_version: "KFM-MDP v11.2.6"

scope:
  domain: "surficial-geology"
  applies_to:
    - "data/surficial-geology/stac/items/shards/**"

fair_category: "F1-A1-I1-R1"
care_label: "Public Â· Low-Risk"
classification: "Public"
sensitivity: "General (non-sensitive; auto-mask rules apply)"

jurisdiction: "Kansas / United States"
indigenous_rights_flag: true
data_steward: "KFM FAIR+CARE Council"

governance_ref: "../../../../../docs/standards/governance/ROOT-GOVERNANCE.md"
ethics_ref: "../../../../../docs/standards/faircare/FAIRCARE-GUIDE.md"
sovereignty_policy: "../../../../../docs/standards/sovereignty/INDIGENOUS-DATA-PROTECTION.md"

commit_sha: "<latest-commit-hash>"
provenance_chain: []

doc_uuid: "urn:kfm:doc:data:surficial-geology:stac:items:shards-readme:v0.1.0"
semantic_document_id: "surficial-geology-stac-items-shards-readme-v0.1.0"
event_source_id: "ledger:kfm:doc:data:surficial-geology:stac:items:shards-readme:v0.1.0"

ai_training_inclusion: false
ai_focusmode_usage: "Allowed with restrictions"
ai_transform_permissions:
  - "summary"
  - "metadata-extraction"
  - "semantic-highlighting"
  - "a11y-adaptations"
ai_transform_prohibited:
  - "content-alteration"
  - "speculative-additions"
  - "unverified-relationship-claims"
  - "narrative-fabrication"
  - "governance-override"
---

<div align="center">

# ğŸ§± **Surficial Geology â€” STAC Item Shards**
`data/surficial-geology/stac/items/shards/README.md`

**Purpose**  
Define how STAC Item JSON files are **sharded deterministically** for filesystem scalability, and how shard storage stays compatible with STAC link traversal, indexing, and KFM provenance rules.

</div>

---

## ğŸ“˜ Overview

This directory stores **STAC Item JSON** files in **deterministic shard buckets** (folders) to avoid:

- extremely large single directories
- slow filesystem operations (listing, diffs, tooling)
- unstable â€œad-hocâ€ folder structures

Treat everything under `shards/` as:

- **Derived** (generated by a deterministic pipeline)
- **Idempotent** (re-running the pipeline yields identical paths for identical item IDs)
- **Link-safe** (Items remain valid STAC Items with correct `links[]` and `collection` fields)

### What belongs here

- STAC **Item** JSON documents (GeoJSON Feature-shaped STAC Items).
- Only items intended to be addressable by STAC link traversal or ingestion to a STAC API/DB backend.

### What does not belong here

- Assets (data files) â€” those belong under `data/surficial-geology/outputs/**` (or other governed artifact roots).
- Scratch, caches, or one-off exports.
- Hand-edited â€œfixedâ€ items (fix the generator, not the emitted JSON).

---

## ğŸ—‚ï¸ Directory Layout

~~~text
ğŸ“ shards/                                           â€” Sharded STAC Item JSON buckets (this directory)
â”œâ”€â”€ ğŸ“„ README.md                                      â€” This file (rules + scheme)
â”œâ”€â”€ ğŸ“ <shard_key>/                                   â€” Deterministic shard bucket (scheme defined below)
â”‚   â”œâ”€â”€ ğŸ§¾ <item_file_stem>.json                       â€” STAC Item (must contain its canonical `id`)
â”‚   â”œâ”€â”€ ğŸ§¾ <item_file_stem>.json                       â€” STAC Item
â”‚   â””â”€â”€ ğŸ§¾ ...
â”œâ”€â”€ ğŸ“ <shard_key>/                                   â€” Next bucket
â”‚   â””â”€â”€ ğŸ§¾ ...
â””â”€â”€ ğŸ“ ...
~~~

Notes:

- `<shard_key>` MUST be deterministic, stable across runs, and derived from the Itemâ€™s canonical identifier.
- `<item_file_stem>` MUST be derived deterministically from the same canonical identifier and MUST be filesystem-safe.

---

## ğŸ§­ Context

KFM catalogs use STAC as a first-class interface for discovery and lineage. Sharding is a **storage strategy** only; it must not change STAC semantics.

Deterministic ETL â†’ catalogs (STAC/DCAT/PROV) â†’ graph (Neo4j) â†’ API â†’ frontend â†’ Story Nodes â†’ Focus Mode

In practice, `items/shards/` exists so that:

- large catalogs can be committed and traversed without â€œone huge directoryâ€
- stable paths can be used as durable `href` targets (static STAC) or ingestion inputs (dynamic STAC API)
- indexing jobs can walk buckets incrementally and reproducibly

---

## ğŸ“¦ Data & Metadata

### Deterministic sharding scheme

KFM requires the sharding function to be:

- deterministic
- collision-resistant (in practice)
- independent of filesystem ordering
- stable across versions unless a migration plan is executed

**Default (recommended) scheme (hash-prefix buckets):**

- `shard_key = sha256(item_id).hexdigest()[0:2]`
- bucket count: 256 (`00` â€¦ `ff`)
- optional second level for extremely large item counts:
  - `level1 = sha256(item_id).hexdigest()[0:2]`
  - `level2 = sha256(item_id).hexdigest()[2:4]`
  - path becomes `shards/<level1>/<level2>/<item_file_stem>.json`

If an alternate scheme is used (geohash/H3/time partitions), it MUST be:

- recorded in the pipeline config snapshot for the run that generated the items
- applied consistently (do not mix schemes within a collection without an explicit migration)

### File naming (id â†” path)

To keep Items portable across platforms:

- `item_id` is the authoritative identifier (inside the JSON: `id`).
- the filename is a deterministic, filesystem-safe encoding of `item_id`.

**Rules:**

- Allowed filename characters: `a-z`, `0-9`, `_`, `-`, `.`
- If `item_id` contains other characters, encode to a safe stem using a deterministic transform (e.g., percent-encoding or a reversible slug rule).
- Do not truncate in a way that can cause collisions without adding a stable disambiguator.

**Invariant:**

- One item ID maps to exactly one file path.
- That mapping must not change unless the catalog is explicitly migrated (with redirects/relocated `href`s accounted for).

### â€œDo not hand-editâ€ rule

Do not patch JSON items in-place. If an item is incorrect:

1. fix inputs/config/code
2. regenerate the STAC Items deterministically
3. validate + re-index

---

## ğŸŒ STAC, DCAT & PROV Alignment

### STAC

Each JSON file here MUST be a valid STAC Item and MUST:

- include `type: "Feature"`
- include `stac_version`
- include `id`
- include `collection` (or the equivalent link relation per your profile)
- include `geometry`, `bbox`, and `properties.datetime` or appropriate temporal fields
- include `links[]` sufficient for catalog navigation (root/catalog/collection/self per your generator policy)

Items in shards are still first-class STAC Items; sharding only changes the `href` used in links/indexes.

### DCAT

DCAT `dcat:Distribution` records should reference **assets** (outputs), not these metadata containers.

However, DCAT exports may enumerate Items as part of catalog introspection. If so, treat shard paths as **metadata endpoints** and avoid duplicating distribution semantics.

### PROV

At minimum, each Item should be traceable to:

- the run activity that generated it
- the raw source(s) it was derived from
- the produced asset(s) it describes (under `outputs/**`)

Wherever PROV is represented (sidecar files, registry, graph ingestion), shard paths should be treated as stable entity identifiers.

---

## ğŸ§ª Validation & CI/CD

Minimum expectations before committing or publishing shard content:

- **Schema validation**: each file validates as a STAC Item (locked validator/tool version).
- **Link integrity**:
  - `self` and `collection` link targets resolve correctly (relative or absolute per catalog policy)
  - no broken traversal from collection â†’ items (or index â†’ items), if applicable
- **Uniqueness checks**:
  - no duplicate `id` values across all shards
  - no filename/path collisions after encoding
- **Determinism checks**:
  - shard key computation matches the configured scheme
  - re-run of the generator produces identical paths for identical IDs
- **Governance scans**:
  - no secrets / tokens
  - no disallowed sensitive precision where sovereignty rules require masking/generalization

---

## âš– FAIR+CARE & Governance

Even when the underlying domain is non-sensitive, catalog metadata can enable unintended inference when combined with other layers.

For shard Items:

- apply masking/generalization policies when required by sovereignty flags
- avoid embedding restricted coordinates at disallowed precision
- ensure license/rights are carried from authoritative source manifests and not invented in Item properties

Governance and sovereignty policies linked below are binding.

---

## ğŸ•°ï¸ Version History

| Version     | Date       | Summary |
|------------:|-----------:|---------|
| **v0.1.0**  | 2025-12-14 | Initial `items/shards/` README defining deterministic sharding expectations, idâ†”path invariants, validation rules, and STAC/DCAT/PROV alignment. |

---

<div align="center">

ğŸ§± **Surficial Geology â€” STAC Item Shards**  
KFM Catalog Layer Â· Deterministic Storage Â· Provenance-First

[ğŸ“˜ Docs Root](../../../../../docs/README.md) Â·
[ğŸ“‚ Standards Index](../../../../../docs/standards/README.md) Â·
[ğŸ“„ Templates Index](../../../../../docs/templates/README.md) Â·
[âš™ CI/CD Workflows](../../../../../docs/workflows/README.md) Â·
[ğŸ“ˆ Telemetry Standard](../../../../../docs/standards/telemetry_standards.md) Â·
[ğŸ“Š Telemetry Docs](../../../../../docs/telemetry/README.md) Â·
[â™¿ UI Accessibility Standard](../../../../../docs/standards/ui_accessibility.md) Â·
[ğŸ›ï¸ Governance Charter](../../../../../docs/standards/governance/ROOT-GOVERNANCE.md) Â·
[ğŸ¤ FAIR+CARE Guide](../../../../../docs/standards/faircare/FAIRCARE-GUIDE.md) Â·
[ğŸª¶ Indigenous Data Protection](../../../../../docs/standards/sovereignty/INDIGENOUS-DATA-PROTECTION.md)

Â© 2025 Kansas Frontier Matrix â€” CCâ€‘BY 4.0

</div>

