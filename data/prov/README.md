---
title: "KFM data/prov/ ‚Äî Provenance Bundles (README)"
path: "data/prov/README.md"
version: "v1.0.0"
last_updated: "2025-12-26"
status: "draft"
doc_kind: "README"
license: "CC-BY-4.0"

markdown_protocol_version: "KFM-MDP v11.2.6"
mcp_version: "MCP-DL v6.3"
ontology_protocol_version: "KFM-ONTO v4.1.0"
pipeline_contract_version: "KFM-PPC v11.0.0"
stac_profile: "KFM-STAC v11.0.0"
dcat_profile: "KFM-DCAT v11.0.0"
prov_profile: "KFM-PROV v11.0.0"

governance_ref: "docs/governance/ROOT_GOVERNANCE.md"
ethics_ref: "docs/governance/ETHICS.md"
sovereignty_policy: "docs/governance/SOVEREIGNTY.md"
fair_category: "FAIR+CARE"
care_label: "TBD"
sensitivity: "public"
classification: "open"
jurisdiction: "US-KS"

doc_uuid: "urn:kfm:doc:data:prov:readme:v1.0.0"
semantic_document_id: "kfm-data-prov-readme-v1.0.0"
event_source_id: "ledger:kfm:doc:data:prov:readme:v1.0.0"
commit_sha: "<latest-commit-hash>"

ai_transform_permissions:
  - "summarize"
  - "structure_extract"
  - "translate"
  - "keyword_index"
ai_transform_prohibited:
  - "generate_policy"
  - "infer_sensitive_locations"

doc_integrity_checksum: "sha256:<calculate-and-fill>"
---

# KFM data/prov/ ‚Äî Provenance Bundles

## üìò Overview

### Purpose

- Provide the **canonical repository home** for W3C PROV-O provenance bundles generated by KFM ETL/pipeline runs.
- Standardize **where provenance artifacts live** and how they should be **named, structured, and linked** to other catalog artifacts (STAC/DCAT) and downstream systems (graph, API boundary, Story Nodes, Focus Mode).
- Make provenance ‚Äúfirst-class‚Äù so that audits and Focus Mode can trace every displayed claim or asset back to evidence and lineage.

### Scope

| In Scope | Out of Scope |
|---|---|
| Folder conventions and expectations for provenance artifacts under `data/prov/` | Full normative PROV profile spec (see `docs/standards/KFM_PROV_PROFILE.md` ‚Äî placeholder/empty per v13 blueprint) |
| Recommended minimum PROV content for pipeline runs | Implementing ETL, catalogs, or graph ingestion code |
| Linking expectations to STAC/DCAT identifiers | Defining new governance policies (must follow governance refs) |

### Audience

- Pipeline / ETL maintainers (produce provenance)
- Catalog maintainers (validate and publish provenance)
- Graph + API maintainers (consume provenance refs)
- Story Node curators and reviewers (evidence-first narrative)

### Definitions (link to glossary)

- Link: `docs/glossary.md` (not confirmed in repo)

Terms used in this doc: **PROV-O**, **Entity**, **Activity**, **Agent**, **run**, **dataset**, **STAC Item**, **DCAT dataset record**, **evidence artifact**.

### Key artifacts (what this doc points to)

| Artifact | Path / Identifier | Owner | Notes |
|---|---|---|---|
| Master Guide v12 | `docs/MASTER_GUIDE_v12.md` | KFM maintainers | Canonical pipeline order + invariants |
| v13 redesign blueprint | `docs/architecture/KFM_REDESIGN_BLUEPRINT_v13.md` | KFM maintainers | Canonical roots + CI behavior |
| PROV profile | `docs/standards/KFM_PROV_PROFILE.md` | Standards maintainers | Placeholder (empty) per v13 blueprint |
| PROV constraints/schemas | `schemas/prov/` | Standards maintainers | Required for v13 readiness (contents may be WIP) |
| STAC outputs | `data/stac/` | Catalog stage | Consumers: graph, API, UI |
| DCAT outputs | `data/catalog/dcat/` | Catalog stage | Consumers: API, external export |

### Definition of done (for this folder)

- [ ] `data/prov/` exists with this README and a clear layout expectation
- [ ] New/updated PROV bundles have stable IDs and link to STAC/DCAT identifiers
- [ ] CI behavior is deterministic: validate if present; fail if invalid; skip if not applicable
- [ ] No secrets or sensitive location inference is recorded in provenance outputs

## üóÇÔ∏è Directory Layout

### This document

- `path`: `data/prov/README.md` (must match front-matter)

### Related repository paths

| Area | Path | What lives here |
|---|---|---|
| ETL/pipelines | `src/pipelines/` | Deterministic transforms; run manifests; writes outputs into `data/**` |
| Domain staging | `data/<domain>/raw/` ‚Üí `work/` ‚Üí `processed/` | Source snapshots ‚Üí intermediates ‚Üí curated outputs |
| STAC catalogs | `data/stac/` | Collections + Items (evidence assets) |
| DCAT catalogs | `data/catalog/dcat/` | Dataset/distribution metadata |
| Provenance catalogs | `data/prov/` | PROV bundles (this folder) |
| Graph export | `data/graph/` | Graph import fixtures (CSV/Cypher) |
| Standards | `docs/standards/` + `schemas/` | Profiles, constraints, validators |

### Expected file tree for this sub-area

Note: The internal partitioning of `data/prov/` is a **repository convention**. Keep it simple and stable. Prefer **kebab-case** for domain slugs.

~~~text
üìÅ data/
‚îî‚îÄ‚îÄ üìÅ prov/
    ‚îú‚îÄ‚îÄ üìÑ README.md
    ‚îî‚îÄ‚îÄ üìÅ <domain>/
        ‚îî‚îÄ‚îÄ üìÅ <dataset_id>/
            ‚îî‚îÄ‚îÄ üìÅ runs/
                ‚îú‚îÄ‚îÄ üìÑ <run_id>.prov.jsonld      # recommended (serialization may vary)
                ‚îî‚îÄ‚îÄ üìÑ <run_id>.manifest.json    # optional run manifest (if adopted)
~~~

## üß≠ Context

### Background

- KFM‚Äôs canonical pipeline ordering is preserved: **ETL ‚Üí STAC/DCAT/PROV ‚Üí Graph ‚Üí APIs ‚Üí UI ‚Üí Story Nodes ‚Üí Focus Mode**.
- `data/prov/` is the canonical location for provenance bundles that explain how evidence artifacts were produced and how they relate back to sources.

### Assumptions

- Pipelines are deterministic and replayable (same inputs + config ‚Üí same outputs).
- Provenance should be sufficient to support:
  - audits and reviews,
  - graph provenance edges / evidence linkouts,
  - Focus Mode‚Äôs ‚Äúprovenance-linked context only‚Äù behavior.

### Constraints / invariants

- **No direct UI‚ÜíGraph access**: UI consumes provenance-linked context via contracted APIs only.
- Provenance bundles must not include secrets, tokens, private keys, or sensitive location inference.
- Provenance IDs should be stable and cross-linkable to STAC/DCAT identifiers.

### Open questions

| Question | Owner | Target date |
|---|---|---|
| Canonical serialization format for PROV bundles (JSON-LD vs PROV-JSON vs TTL) | TBD | TBD |
| Canonical ID scheme for run/activity/entity IDs (URN scheme, hashing, timestamps) | TBD | TBD |
| Whether run manifests live in `data/prov/**` vs `releases/**` vs `mcp/runs/**` | TBD | TBD |

### Future extensions

- Add `schemas/prov/` constraints and a validator gate in CI.
- Add a minimal ‚Äúvertical slice‚Äù domain example that produces a real PROV bundle.
- Add API endpoints to expose provenance bundles directly (contract-first).

## üó∫Ô∏è Diagrams

### System / dataflow diagram

~~~mermaid
flowchart LR

  A[ETL / Pipelines<br/>src/pipelines/] --> B[Staging Outputs<br/>data/&lt;domain&gt;/{raw,work,processed}]
  B --> C[Catalogs<br/>data/stac + data/catalog/dcat + data/prov]
  C --> D[Graph Build<br/>src/graph + data/graph]
  D --> E[API Boundary<br/>src/server]
  E --> F[UI<br/>web/]
  E --> G[Story Nodes<br/>docs/reports/story_nodes]
  G --> H[Focus Mode<br/>provenance-linked only]
~~~

### Optional: sequence diagram

~~~mermaid
sequenceDiagram
  participant UI as UI (web/)
  participant API as API (src/server)
  participant Graph as Graph (Neo4j via src/graph)
  participant Prov as PROV (data/prov)

  UI->>API: Focus query(entity_id)
  API->>Graph: fetch subgraph + provenance refs
  API->>Prov: resolve provenance bundles (by prov_activity_id / run_id)
  Prov-->>API: provenance bundle (validated)
  Graph-->>API: context bundle + evidence references
  API-->>UI: contracted payload (narrative + citations + audit flags)
~~~

## üì¶ Data & Metadata

### Inputs

| Input | Format | Where from | Validation |
|---|---|---|---|
| Pipeline run metadata (run_id, config hash, code ref) | JSON/YAML (TBD) | `src/pipelines/**` + CI | Determinism + required fields |
| Source references | IDs/URIs | `data/<domain>/raw/**` | Must resolve to source snapshot/pointer |
| Evidence artifact IDs | STAC/DCAT IDs | `data/stac/**`, `data/catalog/dcat/**` | Must exist; no orphan refs |

### Outputs

| Output | Format | Path | Contract / Schema |
|---|---|---|---|
| PROV bundle (run lineage) | JSON-LD / PROV-JSON / TTL (TBD) | `data/prov/<domain>/<dataset_id>/runs/<run_id>.*` | `schemas/prov/**` (if present) |
| Optional run manifest | JSON | `data/prov/<domain>/<dataset_id>/runs/<run_id>.manifest.json` | Pipeline contract (TBD) |

### Sensitivity & redaction

- Do not store secrets (tokens, keys, passwords) in provenance artifacts.
- If provenance would expose restricted locations or culturally sensitive knowledge:
  - generalize identifiers/geometry references,
  - rely on API boundary redaction rules,
  - route through governance review.

### Quality signals

- PROV bundles are complete enough to answer:
  - what sources were used,
  - what transformation (activity) produced outputs,
  - what outputs were generated,
  - who/what agent ran the activity (pipeline identity).
- No orphan references: IDs resolve to existing STAC/DCAT/graph entities (when applicable).
- Outputs are diffable (stable ordering/IDs wherever possible).

## üåê STAC, DCAT & PROV Alignment

### STAC

- Collections involved: `data/stac/collections/**` (as applicable)
- Items involved: `data/stac/items/**` (as applicable)
- Extension(s): per domain (TBD)

### DCAT

- Dataset identifiers: `data/catalog/dcat/**`
- License mapping: must match dataset/license metadata
- Contact / publisher mapping: per profile (TBD)

### PROV-O

Minimum recommended relationships (illustrative; align to profile once `KFM_PROV_PROFILE` is populated):

- `prov:wasDerivedFrom`: output entities ‚Üí input entities
- `prov:wasGeneratedBy`: output entities ‚Üí activity (run)
- `prov:used`: activity (run) ‚Üí input entities
- `prov:wasAssociatedWith`: activity (run) ‚Üí agent (pipeline identity)

#### Minimal example (illustrative)

~~~json
{
  "@context": {
    "prov": "http://www.w3.org/ns/prov#",
    "xsd": "http://www.w3.org/2001/XMLSchema#"
  },
  "@id": "urn:kfm:prov:activity:<domain>:<dataset_id>:<run_id>",
  "@type": "prov:Activity",
  "prov:used": [
    { "@id": "urn:kfm:prov:entity:<domain>:raw:<source_snapshot_id>" }
  ],
  "prov:generated": [
    { "@id": "urn:kfm:prov:entity:<domain>:processed:<artifact_id>" }
  ],
  "prov:wasAssociatedWith": {
    "@id": "urn:kfm:prov:agent:pipeline:<domain>"
  }
}
~~~

### Versioning

- Use STAC Versioning links and graph predecessor/successor relationships as applicable.
- New provenance bundles should reference the correct dataset/version identifiers so lineage can be traversed across releases.

## üß± Architecture

### Components

| Component | Responsibility | Interface |
|---|---|---|
| ETL | Ingest + normalize | Config + run logs |
| Catalogs | STAC/DCAT/PROV | JSON + validator |
| Graph | Neo4j | Cypher + API layer |
| APIs | Serve contracts | REST/GraphQL |
| UI | Map + narrative | API calls |
| Story Nodes | Curated narrative | Graph + docs |
| Focus Mode | Contextual synthesis | Provenance-linked |

### Interfaces / contracts

| Contract | Location | Versioning rule |
|---|---|---|
| JSON schemas | `schemas/` | Semver + changelog |
| API schemas | `src/server/` + docs | Contract tests required |
| Pipeline contract | `docs/standards/` | Versioned (PPC) |

### Extension points checklist (for future work)

- [ ] Data: new domain added under `data/<domain>/...`
- [ ] STAC: new collection + item schema validation
- [ ] DCAT: dataset record created/validated
- [ ] PROV: activity + agent identifiers recorded
- [ ] Graph: new labels/relations mapped + migration plan
- [ ] APIs: contract version bump + tests
- [ ] UI: layer registry entry + access rules
- [ ] Focus Mode: provenance references enforced
- [ ] Telemetry: new signals + schema version bump

## üß† Story Node & Focus Mode Integration

### How this work surfaces in Focus Mode

- Focus Mode should be able to show:
  - the evidence artifact(s) referenced (STAC/DCAT),
  - the provenance bundle(s) explaining lineage,
  - audit flags when provenance is missing/incomplete.

### Provenance-linked narrative rule

- Focus Mode only consumes provenance-linked content.
- Every claim must trace to a dataset / record / asset ID.

### Optional structured controls

~~~yaml
focus_layers:
  - "TBD"
focus_time: "TBD"
focus_center: [ -98.0000, 38.0000 ]
~~~

## üß™ Validation & CI/CD

### Validation steps

- [ ] Markdown protocol checks (front-matter, required sections)
- [ ] Schema validation (STAC/DCAT/PROV) if `schemas/**` present
- [ ] Link/reference checks (no orphan file pointers)
- [ ] Secrets scan (no tokens/keys)
- [ ] Security and sovereignty scanning gates (as configured)

### Reproduction

~~~bash
# Example placeholders ‚Äî replace with repo-specific commands

# 1) validate schemas (STAC/DCAT/PROV)
# 2) run unit/integration tests
# 3) run doc lint / markdown protocol validation
~~~

### Telemetry signals (if applicable)

| Signal | Source | Where recorded |
|---|---|---|
| TBD | TBD | `docs/telemetry/` + `schemas/telemetry/` |

## ‚öñ FAIR+CARE & Governance

### Governance review triggers

- New sensitive layers or restricted-location references
- New AI narrative behaviors or predictive outputs
- Any provenance changes that might expose sensitive identifiers or locations

### CARE notes

- Identify communities impacted and protection rules.
- Use generalization/redaction for restricted locations.
- Ensure sensitive assets (images/docs) follow review gates before publication.

## üï∞Ô∏è Version History

| Version | Date | Summary | Author |
|---|---|---|---|
| v1.0.0 | 2025-12-26 | Initial `data/prov/` README establishing structure and conventions | TBD |

---

Footer refs (do not remove):

- Master guide: `docs/MASTER_GUIDE_v12.md`
- Redesign blueprint: `docs/architecture/KFM_REDESIGN_BLUEPRINT_v13.md`
- Template: `docs/templates/TEMPLATE__KFM_UNIVERSAL_DOC.md`
- Governance: `docs/governance/ROOT_GOVERNANCE.md`
- Ethics: `docs/governance/ETHICS.md`
- Sovereignty: `docs/governance/SOVEREIGNTY.md`
