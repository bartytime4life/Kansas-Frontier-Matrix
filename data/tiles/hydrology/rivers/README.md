<div align="center">

# üåä Kansas Frontier Matrix ‚Äî Hydrology Rivers Tiles  
`data/tiles/hydrology/rivers/`

**Mission:** Deliver **high-resolution vector map tiles** of Kansas‚Äôs river and stream networks ‚Äî built from  
USGS NHD, KGS Hydrography, and AI-enhanced flow models ‚Äî optimized for visualization, time-series analysis,  
and interactive exploration in the **Kansas Frontier Matrix (KFM)** platform.

[![Build & Deploy](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/site.yml/badge.svg)](../../../../.github/workflows/site.yml)
[![STAC Validate](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/stac-validate.yml/badge.svg)](../../../../.github/workflows/stac-validate.yml)
[![CodeQL](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/codeql.yml/badge.svg)](../../../../.github/workflows/codeql.yml)
[![Trivy](https://github.com/bartytime4life/Kansas-Frontier-Matrix/actions/workflows/trivy.yml/badge.svg)](../../../../.github/workflows/trivy.yml)
[![Docs ¬∑ MCP](https://img.shields.io/badge/Docs-MCP-blue)](../../../../docs/)
[![License: Data](https://img.shields.io/badge/License-CC--BY%204.0-green)](../../../../LICENSE)

</div>

---

## üìö Overview

The `data/tiles/hydrology/rivers/` directory contains **vector tile pyramids (`.pbf`)** representing  
Kansas‚Äôs hydrological network ‚Äî rivers, streams, tributaries, and man-made channels ‚Äî at zoom levels **3‚Äì14**.  
These tiles serve as the **primary hydrology visualization layer** in KFM‚Äôs MapLibre web application.

**Key Objectives**
- Visualize river geometry at multiple scales (statewide to local).  
- Support AI-linked hydrological analysis and timeline visualizations.  
- Provide consistent style and schema for integration across all hydrology derivatives.  

---

## üß± Directory Layout

```bash
data/
‚îî‚îÄ‚îÄ tiles/
    ‚îî‚îÄ‚îÄ hydrology/
        ‚îî‚îÄ‚îÄ rivers/
            ‚îú‚îÄ‚îÄ z3/ ... z14/           # Vector tile pyramids (MVT format)
            ‚îú‚îÄ‚îÄ metadata.json          # Layer metadata (STAC-compliant)
            ‚îú‚îÄ‚îÄ checksums/             # Integrity hashes (.sha256)
            ‚îú‚îÄ‚îÄ thumbnails/            # Preview images for docs/UI
            ‚îî‚îÄ‚îÄ style.json             # Default MapLibre/GL style configuration
````

---

## üß© Data Sources & Provenance

| Source                       | Description                                            | License       | Conversion Pipeline                           |
| ---------------------------- | ------------------------------------------------------ | ------------- | --------------------------------------------- |
| **USGS NHD**                 | National Hydrography Dataset (streams, rivers, canals) | Public Domain | GeoPackage ‚Üí GeoJSON ‚Üí MVT                    |
| **KGS Hydrology**            | Kansas Geological Survey river and lake datasets       | CC-BY 4.0     | GeoTIFF ‚Üí Vector extraction                   |
| **AI Flow Model (KFM v2.1)** | Deep-learning derived stream segmentation from 1m DEM  | MIT           | DEM ‚Üí CNN classification ‚Üí vectorization      |
| **Historical Maps Overlay**  | 1890s‚Äì1940s hydrology maps for comparison              | Public Domain | Raster ‚Üí vector digitization (semi-automated) |

All datasets are **cross-referenced in STAC** under `data/stac/items/hydrology/rivers/`.

---

## ‚öôÔ∏è Tile Generation Pipeline

```mermaid
flowchart TD
  A["Raw River Data<br/>USGS ¬∑ KGS ¬∑ AI Flow Network"] --> B["ETL Process<br/>GDAL ¬∑ Tippecanoe ¬∑ ogr2ogr"]
  B --> C["Vector Tiles (MVT)<br/>Zoom Levels 3‚Äì14"]
  C --> D["STAC Catalog<br/>Metadata + Provenance"]
  D --> E["KFM Web Map<br/>MapLibre + Timeline Sync"]
%%END OF MERMAID%%
```

Tiles are generated by the automated workflow:

```bash
make hydrology-rivers-tiles
```

This invokes the GDAL/Tippecanoe pipeline to produce zoom-level pyramids, compress them,
and validate outputs against the **STAC item schema**.

---

## üß≠ Layer Specification

| Property           | Description                                                          |
| ------------------ | -------------------------------------------------------------------- |
| **Tile format**    | MVT (`.pbf`)                                                         |
| **Zoom range**     | 3 ‚Äì 14                                                               |
| **Projection**     | EPSG:3857                                                            |
| **Geometry type**  | `LineString`                                                         |
| **Key attributes** | `river_name`, `flow_class`, `source_id`, `confidence`, `ai_inferred` |
| **Tile schema**    | Stored in `metadata.json`                                            |
| **Style config**   | `style.json` defines colors, width scaling, and hover highlights     |

---

## üåê Integration Points

| Component                   | Purpose                      | Endpoint / File                           |
| --------------------------- | ---------------------------- | ----------------------------------------- |
| **MapLibre GL**             | Interactive rendering        | `/tiles/hydrology/rivers/{z}/{x}/{y}.pbf` |
| **Google Earth**            | Global visualization overlay | `/overlays/hydrology_rivers.kml`          |
| **API Layer (FastAPI)**     | Tile manifest & metadata     | `/layers/hydrology/rivers`                |
| **Knowledge Graph (Neo4j)** | Entity linkage               | Nodes: `River`, `Stream`, `FlowSegment`   |
| **STAC Catalog**            | Provenance                   | `data/stac/items/hydrology/rivers.json`   |

---

## üß† AI Data Enrichment

**AI-Enhanced Flow Detection**

* Model: `KFM-HydroNet-v2.1`
* Input: 1m DEM (USGS 3DEP)
* Output: Stream centerlines + confidence mask
* Accuracy: 93.2% (validated against NHD segments)

AI-derived streams are merged with authoritative datasets using a spatial-weighted overlay:

```
final_rivers = merge(NHD, KGS, AI_FLOW, weights=[0.6, 0.3, 0.1])
```

Confidence is stored as `ai_confidence` per feature property.

---

## üîí Reproducibility & Integrity

Each build produces:

* `.sha256` checksums for every tile pyramid directory
* `metadata.json` with:

  * `source_commit`
  * `processing_environment`
  * `data_hashes`
  * `generation_timestamp`

Validation commands:

```bash
make verify-checksums
make stac-validate hydrology-rivers
```

---

## ü™∂ Versioning

| Field            | Value                            |
| ---------------- | -------------------------------- |
| **Version**      | `v1.0.0`                         |
| **STAC Spec**    | `1.0.0`                          |
| **MCP Schema**   | `v1.2`                           |
| **Last Updated** | `2025-10-12`                     |
| **Maintainer**   | Kansas Frontier Matrix Core Team |

---

## üßæ Changelog

| Version    | Date       | Updates                                                                                              |
| ---------- | ---------- | ---------------------------------------------------------------------------------------------------- |
| **v1.0.0** | 2025-10-12 | Initial release with full STAC integration, AI-enhanced flow merging, and visual style configuration |
| **v0.9.0** | 2025-10-10 | Added preliminary river tile pyramid and checksum verification                                       |
| **v0.8.0** | 2025-10-08 | Drafted metadata and tile schema JSON                                                                |

---

## üß© Example Usage (MapLibre)

```js
map.addSource('rivers', {
  type: 'vector',
  tiles: ['https://kfm.example.org/tiles/hydrology/rivers/{z}/{x}/{y}.pbf'],
  minzoom: 3,
  maxzoom: 14
});

map.addLayer({
  id: 'rivers-line',
  type: 'line',
  source: 'rivers',
  'source-layer': 'rivers',
  paint: {
    'line-color': '#0077be',
    'line-width': ['interpolate', ['linear'], ['zoom'], 3, 0.3, 14, 2.8],
    'line-opacity': 0.9
  }
});
```

---

## üîó Related Documentation

* [Hydrology Tiles (Parent)](../../README.md)
* [Processed Hydrology Data](../../../../data/processed/hydrology/README.md)
* [Hydrology Metadata](../../../../data/processed/metadata/hydrology/README.md)
* [Web Hydrology Layer Config](../../../../web/config/layers/hydrology.json)
* [KFM Architecture Overview](../../../../docs/architecture.md)

---

<div align="center">

**Kansas Frontier Matrix** ¬∑ *Time ¬∑ Terrain ¬∑ History*
[üåê Repository](https://github.com/bartytime4life/Kansas-Frontier-Matrix) ‚Ä¢ [üìò Docs](../../../../docs/) ‚Ä¢ [üß≠ STAC](../../../../data/stac/)

</div>
```

