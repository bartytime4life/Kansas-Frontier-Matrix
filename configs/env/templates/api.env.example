# api.env.example
# Example environment variables for the KFM API service.
#
# Usage:
#   cp configs/env/templates/api.env.example .env
#   # then edit .env for your environment (dev/stage/prod)
#
# Notes:
# - Do NOT commit real secrets. Keep secrets in your secret manager.
# - This file is intentionally verbose. Remove keys you don't use.

###############################################################################
# Runtime
###############################################################################
NODE_ENV=development
APP_NAME=kfm-api
APP_VERSION=0.0.0
HOST=0.0.0.0
PORT=8080

# Trust X-Forwarded-* headers from a reverse proxy (e.g., nginx, ingress).
TRUST_PROXY=true

# If true, API will reject non-HTTPS requests when behind a proxy that sets
# X-Forwarded-Proto=https. (Disable for local dev.)
FORCE_HTTPS=false

###############################################################################
# Public URLs
###############################################################################
# The externally reachable base URL for this API (used in link generation).
PUBLIC_API_BASE_URL=http://localhost:8080

# Comma-separated list of allowed CORS origins.
# Examples:
#   http://localhost:3000
#   https://kfm.example.com
CORS_ALLOWED_ORIGINS=http://localhost:3000

# If you need to allow credentials (cookies/Authorization), set to true.
CORS_ALLOW_CREDENTIALS=true

###############################################################################
# Logging
###############################################################################
LOG_LEVEL=info
# One of: json | pretty
LOG_FORMAT=pretty

###############################################################################
# Request limits and rate limiting (optional)
###############################################################################
# e.g. 10mb, 1mb
REQUEST_BODY_LIMIT=10mb

# Basic in-memory rate limiting (good for dev; use a distributed limiter for prod)
RATE_LIMIT_ENABLED=false
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=120

###############################################################################
# Authentication & authorization
###############################################################################
# One of: jwt | oidc | none
AUTH_MODE=jwt

# --- JWT (AUTH_MODE=jwt) ---
# Replace in real environments. Minimum 32+ chars recommended.
JWT_SECRET=CHANGE_ME__DEV_ONLY__PLEASE_ROTATE
JWT_ISSUER=kfm-api
JWT_AUDIENCE=kfm-clients
# Access token lifetime (seconds)
JWT_ACCESS_TTL_SECONDS=900
# Refresh token lifetime (seconds)
JWT_REFRESH_TTL_SECONDS=2592000

# --- OIDC (AUTH_MODE=oidc) ---
# OIDC_ISSUER_URL=https://login.example.com/realms/kfm
# OIDC_CLIENT_ID=kfm-api
# OIDC_CLIENT_SECRET=CHANGE_ME
# OIDC_REDIRECT_URL=https://api.example.com/auth/callback

###############################################################################
# Database (PostgreSQL recommended)
###############################################################################
# Prefer a single DATABASE_URL; keep individual fields only if your stack needs them.
# Example:
#   postgresql://user:pass@localhost:5432/kfm?sslmode=disable
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/kfm?sslmode=disable

DB_POOL_MIN=0
DB_POOL_MAX=10
DB_STATEMENT_TIMEOUT_MS=30000

###############################################################################
# Cache / queue (Redis)
###############################################################################
# Example:
#   redis://localhost:6379/0
REDIS_URL=redis://localhost:6379/0
REDIS_TLS=false

###############################################################################
# Storage (artifacts, published data, etc.)
###############################################################################
# One of: local | s3 | gcs | azure
STORAGE_DRIVER=local

# --- local storage ---
STORAGE_LOCAL_PATH=./var/storage

# --- S3-compatible storage (STORAGE_DRIVER=s3) ---
# STORAGE_S3_BUCKET=kfm
# STORAGE_S3_REGION=us-east-1
# STORAGE_S3_ENDPOINT=https://s3.amazonaws.com
# STORAGE_S3_FORCE_PATH_STYLE=false
# STORAGE_S3_ACCESS_KEY_ID=CHANGE_ME
# STORAGE_S3_SECRET_ACCESS_KEY=CHANGE_ME
# STORAGE_PUBLIC_BASE_URL=https://cdn.example.com/kfm

###############################################################################
# Search / indexing (optional)
###############################################################################
# One of: none | opensearch | elasticsearch | postgres
SEARCH_BACKEND=none
# SEARCH_URL=http://localhost:9200
SEARCH_INDEX_PREFIX=kfm

###############################################################################
# Governance & policy boundary (KFM)
###############################################################################
# One of: enforce | audit | off
POLICY_MODE=enforce

# Default data policy label to apply when a label is missing (tighten for prod).
# Examples: public | restricted | confidential
POLICY_DEFAULT_LABEL=restricted

# Path to a policy bundle/config used by the policy engine (if applicable).
# POLICY_BUNDLE_PATH=./configs/policy/policy.bundle.json

# Audit logging (recommended on)
AUDIT_LOG_ENABLED=true
# One of: stdout | file
AUDIT_LOG_SINK=stdout
# AUDIT_LOG_FILE=./var/log/audit.log

###############################################################################
# Data lifecycle zones (paths or bucket prefixes)
###############################################################################
DATA_ZONE_RAW=raw
DATA_ZONE_WORK=work
DATA_ZONE_PROCESSED=processed
DATA_ZONE_PUBLISHED=published

###############################################################################
# Map / Story services (optional)
###############################################################################
# If the API proxies tiles or serves style JSON, configure these.
MAP_TILES_BASE_URL=http://localhost:8081/tiles
MAP_STYLES_BASE_URL=http://localhost:8082/styles

###############################################################################
# AI / LLM integration (optional)
###############################################################################
# One of: none | openai | azure_openai | anthropic | local
LLM_PROVIDER=none

# --- OpenAI (LLM_PROVIDER=openai) ---
# OPENAI_API_KEY=CHANGE_ME
# OPENAI_MODEL=gpt-4o-mini
# OPENAI_BASE_URL=https://api.openai.com/v1

# Prompt safety / redaction hooks
AI_REDACTION_ENABLED=true
AI_MAX_INPUT_CHARS=20000

###############################################################################
# Observability (optional)
###############################################################################
SENTRY_DSN=
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_SERVICE_NAME=kfm-api

###############################################################################
# Feature flags (optional)
###############################################################################
FEATURE_FOCUS_MODE=true
FEATURE_STORY_NODES=true
