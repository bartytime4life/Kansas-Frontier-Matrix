According to a document from February 4, 2026, the **Kansas Frontier Matrix (KFM)** local dev stack is intended to run via **Docker Compose**, orchestrating **PostGIS**, **Neo4j**, a **FastAPI** backend, and a **React** frontend (with optional policy services like OPA). [oai_citation:0‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d) [oai_citation:1‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

---

# üê≥ `docker-compose.yml` (KFM Dev Stack)

![Docker](https://img.shields.io/badge/Docker-Compose-2496ED?logo=docker&logoColor=white)
![PostGIS](https://img.shields.io/badge/PostgreSQL-PostGIS-336791?logo=postgresql&logoColor=white)
![Neo4j](https://img.shields.io/badge/Neo4j-Graph-008CC1?logo=neo4j&logoColor=white)
![FastAPI](https://img.shields.io/badge/FastAPI-API-009688?logo=fastapi&logoColor=white)
![React](https://img.shields.io/badge/React-Web-61DAFB?logo=react&logoColor=black)

## üéØ What this stack runs

KFM‚Äôs Compose setup commonly includes these services and ports:

- üóÑÔ∏è **`db`** ‚Üí PostGIS (PostgreSQL + PostGIS) ‚Üí `localhost:5432` [oai_citation:2‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d) [oai_citation:3‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
- üß† **`graph`** ‚Üí Neo4j ‚Üí `localhost:7474` (HTTP UI) + `localhost:7687` (Bolt) [oai_citation:4‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d) [oai_citation:5‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
- ‚ö° **`api`** ‚Üí FastAPI (Uvicorn) ‚Üí `localhost:8000` (Swagger at `/docs`) [oai_citation:6‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d) [oai_citation:7‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
- üñ•Ô∏è **`web`** ‚Üí React dev server ‚Üí `localhost:3000` [oai_citation:8‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d) [oai_citation:9‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
- üõ°Ô∏è **`opa`** (optional) ‚Üí Policy server ‚Üí `localhost:8181` [oai_citation:10‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

> üîå Internal networking note: containers can reach each other by **service name** (e.g., API connects to Postgres at `db` and Neo4j at `graph`). [oai_citation:11‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

---

## üìÅ Expected repo layout (what this compose assumes)

This matches the repo layout described in the blueprint:

```text
üì¶ Kansas-Frontier-Matrix/
‚îú‚îÄ‚îÄ api/                     # ‚ö° FastAPI backend (Python)
‚îú‚îÄ‚îÄ web/                     # üñ•Ô∏è React + TypeScript frontend
‚îú‚îÄ‚îÄ pipelines/               # üß™ ETL + simulation scripts
‚îú‚îÄ‚îÄ data/                    # üóÇÔ∏è Versioned datasets + metadata
‚îÇ   ‚îú‚îÄ‚îÄ raw/
‚îÇ   ‚îú‚îÄ‚îÄ processed/
‚îÇ   ‚îú‚îÄ‚îÄ catalog/
‚îÇ   ‚îî‚îÄ‚îÄ provenance/
‚îî‚îÄ‚îÄ docs/                    # üìö Documentation + narratives
```

 [oai_citation:12‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

---

## üîß 0) Create `.env` (recommended)

The blueprint references copying a template env file (like `.env.example`) to `.env`, including common variables like PostGIS creds, `NEO4J_AUTH`, and ports for FastAPI/React. [oai_citation:13‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

Here‚Äôs a solid baseline `.env` you can start with:

```env
# ----------------------------
# Ports
# ----------------------------
POSTGRES_PORT=5432
NEO4J_HTTP_PORT=7474
NEO4J_BOLT_PORT=7687
FASTAPI_PORT=8000
WEB_PORT=3000
OPA_PORT=8181

# ----------------------------
# Postgres / PostGIS
# ----------------------------
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=kfm

# ----------------------------
# Neo4j
# ----------------------------
# Format: user/password
NEO4J_AUTH=neo4j/test

# ----------------------------
# API
# ----------------------------
# Override if your app entrypoint differs
UVICORN_APP=api.main:app

# Optional: if you run Ollama on the host, the API can point to it.
# (The docs mention host.docker.internal:11434 patterns.) [oai_citation:14‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
AI_BACKEND_URL=http://host.docker.internal:11434
```

> üßØ Port conflicts: if you already have something running on `5432`, `7474`, `8000`, or `3000`, change the host-side port mapping in Compose (or update `.env`). [oai_citation:15‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

---

## üß† Hot reload expectations (dev ergonomics)

- Backend: mount `api/` and run Uvicorn with `--reload`. [oai_citation:16‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
- Frontend: mount `web/src` (or the entire `web/`) so React hot reload works. [oai_citation:17‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

---

# ‚úÖ `docker-compose.yml`

> üìå Place this file at repo root: `üì¶ Kansas-Frontier-Matrix/docker-compose.yml`

```yaml
name: kfm

services:
  # ----------------------------
  # üóÑÔ∏è PostGIS (Postgres + PostGIS)
  # ----------------------------
  db:
    image: postgis/postgis:16-3.4
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      POSTGRES_DB: ${POSTGRES_DB:-kfm}
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    volumes:
      - db_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U $$POSTGRES_USER -d $$POSTGRES_DB"]
      interval: 5s
      timeout: 5s
      retries: 20

  # ----------------------------
  # üß† Neo4j (Graph DB)
  # ----------------------------
  graph:
    image: neo4j:5
    restart: unless-stopped
    environment:
      NEO4J_AUTH: ${NEO4J_AUTH:-neo4j/test}
      # Optional but common: APOC plugin for convenience in graph workflows
      NEO4J_PLUGINS: '["apoc"]'
      NEO4J_dbms_security_procedures_unrestricted: "apoc.*"
      NEO4J_dbms_security_procedures_allowlist: "apoc.*"
    ports:
      - "${NEO4J_HTTP_PORT:-7474}:7474"
      - "${NEO4J_BOLT_PORT:-7687}:7687"
    volumes:
      - graph_data:/data
      - graph_logs:/logs
      - graph_import:/var/lib/neo4j/import
      - graph_plugins:/plugins

  # ----------------------------
  # ‚ö° FastAPI backend (Uvicorn)
  # ----------------------------
  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    restart: unless-stopped
    env_file:
      - .env
    depends_on:
      db:
        condition: service_healthy
      graph:
        condition: service_started

    environment:
      # Docker-internal hostnames (service names)
      POSTGRES_HOST: db
      POSTGRES_PORT: 5432
      NEO4J_HOST: graph
      NEO4J_BOLT_PORT: 7687

      # App entrypoint string (override in .env if needed)
      UVICORN_APP: ${UVICORN_APP:-api.main:app}

      # Optional: local AI gateway (e.g., Ollama running on host)
      AI_BACKEND_URL: ${AI_BACKEND_URL:-http://host.docker.internal:11434}

    # Helps Linux containers reach host services via host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway"

    ports:
      - "${FASTAPI_PORT:-8000}:8000"

    volumes:
      - ./api:/app/api
      - ./pipelines:/app/pipelines
      - ./data:/app/data
      - ./docs:/app/docs

    working_dir: /app

    command: >
      sh -c "uvicorn $$UVICORN_APP --host 0.0.0.0 --port 8000 --reload"

  # ----------------------------
  # üñ•Ô∏è React frontend (dev server)
  # ----------------------------
  web:
    build:
      context: ./web
      dockerfile: Dockerfile
    restart: unless-stopped
    env_file:
      - .env
    depends_on:
      - api
    ports:
      - "${WEB_PORT:-3000}:3000"
    environment:
      # If your React app uses a dev proxy (recommended), you may not need this.
      REACT_APP_API_URL: ${REACT_APP_API_URL:-http://localhost:8000}

      # Better file watching in Docker on Mac/Windows (and sometimes Linux)
      CHOKIDAR_USEPOLLING: "true"

    volumes:
      - ./web:/app/web
      - web_node_modules:/app/web/node_modules

    working_dir: /app/web
    command: >
      sh -c "npm install && npm start"

  # ----------------------------
  # üõ°Ô∏è OPA (optional policy engine)
  # Enable with: docker compose --profile opa up --build
  # ----------------------------
  opa:
    image: openpolicyagent/opa:latest
    restart: unless-stopped
    profiles: ["opa"]
    ports:
      - "${OPA_PORT:-8181}:8181"
    volumes:
      - ./policies:/policies:ro
    command:
      - "run"
      - "--server"
      - "--addr=0.0.0.0:8181"
      - "/policies"

volumes:
  db_data:
  graph_data:
  graph_logs:
  graph_import:
  graph_plugins:
  web_node_modules:
```

---

## üöÄ Run it

The blueprint calls out launching the stack like this:

```bash
docker-compose up --build
```

 [oai_citation:18‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

Modern CLI equivalent:

```bash
docker compose up --build
```

To enable OPA profile:

```bash
docker compose --profile opa up --build
```

---

## üîé Quick links (once running)

- ‚ö° FastAPI Swagger: `http://localhost:8000/docs` [oai_citation:19‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
- üß† Neo4j Browser UI: `http://localhost:7474` [oai_citation:20‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)
- üñ•Ô∏è Web UI (React dev server): `http://localhost:3000` [oai_citation:21‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)

---

## üß™ Common dev commands

```bash
# Follow logs
docker compose logs -f api

# Run a one-off pipeline inside the API container (example pattern)
docker compose exec api python pipelines/my_pipeline.py
```

(These workflows are explicitly described as part of the dev cycle.) [oai_citation:22‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d) [oai_citation:23‚Ä°Kansas Frontier Matrix (KFM) ‚Äì Comprehensive Technical Blueprint.pdf](sediment://file_000000006dbc71f89a5094ce310a452d)