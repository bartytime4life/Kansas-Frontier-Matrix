graph TB

  subgraph L0[Clients (untrusted)]
    UI_Map[UI: Map Explorer]
    UI_Story[UI: Story Mode]
    UI_Focus[UI: Focus Mode]
    UI_Ext[External clients]
  end

  subgraph L1[Interfaces (governed boundary + ports)]
    API[Governed API (policy enforcement boundary)]
    Policy[Policy engine (PDP: allow/deny + obligations)]
    Evidence[Evidence resolver (EvidenceRef to EvidenceBundle)]
    Ports[Ports (repository + service interfaces)]
  end

  subgraph L2[Use cases (application orchestration)]
    UC_Query[Query / Browse / Tiles]
    UC_Story[Story read + publish]
    UC_Focus[Focus ask + answer]
    UC_Promote[Promotion workflow]
    UC_Catalog[Catalog build + validate]
  end

  subgraph L3[Domain (core rules + models)]
    Domain_Models[Domain models: Dataset, DatasetVersion, Artifact, EvidenceRef, EvidenceBundle, ...]
    Domain_Rules[Domain invariants: truth path, promotion gates, deterministic identity]
  end

  subgraph L4[Infrastructure (adapters + storage + compute)]
    Infra_Connectors[Connectors / runners (fetch + snapshot upstream)]
    Infra_Upstream[Upstream sources]

    Infra_Object[Canonical object storage (RAW/WORK/PROCESSED artifacts)]
    Infra_Catalogs[Canonical catalogs (DCAT / STAC / PROV)]
    Infra_Receipts[Run receipts / audit ledger]

    Infra_Projections[Rebuildable projections (DB / search / graph / tiles)]
  end

  UI_Map --> API
  UI_Story --> API
  UI_Focus --> API
  UI_Ext --> API

  API --> Policy
  API --> Evidence

  API --> UC_Query
  API --> UC_Story
  API --> UC_Focus
  API --> UC_Promote
  API --> UC_Catalog

  UC_Query --> Domain_Models
  UC_Story --> Domain_Models
  UC_Focus --> Domain_Models
  UC_Promote --> Domain_Rules
  UC_Catalog --> Domain_Rules

  UC_Query --> Ports
  UC_Story --> Ports
  UC_Focus --> Ports
  UC_Promote --> Ports
  UC_Catalog --> Ports

  Ports --> Infra_Object
  Ports --> Infra_Catalogs
  Ports --> Infra_Receipts
  Ports --> Infra_Projections
  Ports --> Infra_Connectors
  Infra_Connectors --> Infra_Upstream

  UI_Map -.->|FORBIDDEN: bypass governed API| Infra_Object
  UI_Map -.->|FORBIDDEN: bypass governed API| Infra_Projections
  UI_Ext -.->|FORBIDDEN: bypass governed API| Infra_Object

  Domain_Models -.->|FORBIDDEN: domain talks to storage| Infra_Object
