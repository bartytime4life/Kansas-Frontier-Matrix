graph TB

  subgraph "Clients - untrusted"
    UI_Map["UI - Map Explorer"]
    UI_Story["UI - Story Mode"]
    UI_Focus["UI - Focus Mode"]
    UI_Ext["External clients"]
  end

  subgraph "Interfaces - governed boundary and ports"
    API["Governed API - policy enforcement boundary"]
    Policy["Policy engine - PDP allow/deny and obligations"]
    Evidence["Evidence resolver - EvidenceRef to EvidenceBundle"]
    Ports["Ports - repository and service interfaces"]
  end

  subgraph "Use cases - application orchestration"
    UC_Query["Query, browse, tiles"]
    UC_Story["Story read and publish"]
    UC_Focus["Focus ask and answer"]
    UC_Promote["Promotion workflow"]
    UC_Catalog["Catalog build and validate"]
  end

  subgraph "Domain - core rules and models"
    Domain_Models["Domain models - Dataset, DatasetVersion, Artifact, EvidenceRef, EvidenceBundle"]
    Domain_Rules["Domain invariants - truth path, promotion gates, deterministic identity"]
  end

  subgraph "Infrastructure - adapters, storage, compute"
    Infra_Connectors["Connectors and runners - fetch and snapshot upstream"]
    Infra_Upstream["Upstream sources"]

    Infra_Object["Canonical object storage - RAW, WORK, PROCESSED artifacts"]
    Infra_Catalogs["Canonical catalogs - DCAT, STAC, PROV"]
    Infra_Receipts["Run receipts and audit ledger"]

    Infra_Projections["Rebuildable projections - DB, search, graph, tiles"]
  end

  UI_Map --> API
  UI_Story --> API
  UI_Focus --> API
  UI_Ext --> API

  API --> Policy
  API --> Evidence

  API --> UC_Query
  API --> UC_Story
  API --> UC_Focus
  API --> UC_Promote
  API --> UC_Catalog

  UC_Query --> Domain_Models
  UC_Story --> Domain_Models
  UC_Focus --> Domain_Models
  UC_Promote --> Domain_Rules
  UC_Catalog --> Domain_Rules

  UC_Query --> Ports
  UC_Story --> Ports
  UC_Focus --> Ports
  UC_Promote --> Ports
  UC_Catalog --> Ports

  Ports --> Infra_Object
  Ports --> Infra_Catalogs
  Ports --> Infra_Receipts
  Ports --> Infra_Projections
  Ports --> Infra_Connectors

  Infra_Connectors --> Infra_Upstream

  UI_Map -.->|FORBIDDEN - bypass governed API| Infra_Object
  UI_Map -.->|FORBIDDEN - bypass governed API| Infra_Projections
  UI_Ext -.->|FORBIDDEN - bypass governed API| Infra_Object

  Domain_Models -.->|FORBIDDEN - domain talks to storage| Infra_Object
