%% ğŸ§­ Kansas-Matrix-System â€” System Context
%% ğŸ“„ docs/architecture/diagrams/sources/00-system-context.mmd
%% ğŸ¯ Context-level view: people + external systems around Kansas Frontier Matrix (KFM)
%% ğŸ§© Notes:
%%   - Roles reflect RBAC concepts: Public Viewer / Contributor / Maintainer / Admin
%%   - Data sources reflect Kansas + federal + community archives (imagery, LiDAR, hydro/climate, historical records)
%%   - Interop reflects open formats & standards (GeoJSON/STAC/COG/OGC-ready APIs) + external GIS tools

flowchart LR
  %% =========================
  %% ğŸ‘¥ People & Roles
  %% =========================
  subgraph P["ğŸ‘¥ People & Roles"]
    direction TB
    publicViewer([ğŸ§­ Public Viewer<br/>(read-only public datasets & stories)])
    researcher([ğŸ”¬ Researcher<br/>(analysis + export)])
    educator([ğŸ“ Educator<br/>(teaching + storytelling)])
    policymaker([ğŸ›ï¸ Policy Maker<br/>(evidence-backed decisions)])
    contributor([âœï¸ Contributor<br/>(draft data/stories)])
    maintainer([ğŸ› ï¸ Maintainer<br/>(review + publish)])
    admin([ğŸ” Admin<br/>(run pipelines, configure policies)])
    governance([ğŸ§‘â€âš–ï¸ Governance / Data Stewards<br/>(incl. Indigenous stakeholders)])
  end

  %% =========================
  %% ğŸ—ºï¸ System (KFM)
  %% =========================
  kfm[[ğŸ—ºï¸ Kansas Frontier Matrix (KFM)<br/>Evidence-first geospatial knowledge platform<br/><br/>ğŸ“Œ "Map behind the map"<br/>ğŸ” Provenance + citations on every insight<br/>ğŸ”— Open formats + interoperable APIs]]

  %% =========================
  %% ğŸŒ External Data Providers
  %% =========================
  subgraph D["ğŸŒ External Data Providers"]
    direction TB
    state[[ğŸ¢ Kansas sources<br/>(Kansas GIS Hub, KDHE, KWO, KGS, KSHS, K-State/Mesonet, etc.)]]
    federal[[ğŸ‡ºğŸ‡¸ Federal sources<br/>(USGS/NASA imagery, NOAA climate, USDA agriculture, EPA water quality, FEMA hazards, Census, etc.)]]
    archives[[ğŸ›ï¸ Libraries & archives<br/>(community archives, universities, Library of Congress, etc.)]]
    partners[[ğŸ¤ Partner / licensed collections<br/>(when permitted)]]
  end

  %% =========================
  %% ğŸ”Œ External Services & Integrations
  %% =========================
  subgraph S["ğŸ”Œ External Services & Integrations"]
    direction TB
    idp[[ğŸªª Identity Provider<br/>(OAuth/OIDC and/or API keys)]]
    gisTools[[ğŸ§° External tools<br/>(QGIS, ArcGIS, Google Earth, notebooks: Jupyter/R/Python)]]
    earthEngine[[ğŸ›°ï¸ Google Earth Engine<br/>(optional analysis/prototyping)]]
    cicd[[ğŸ¤– Source control + CI/CD<br/>(GitHub/GitLab automations)]]
    downstream[[ğŸ“£ Downstream consumers<br/>(third-party apps/portals via APIs)]]
  end

  %% =========================
  %% ğŸ” Relationships
  %% =========================
  publicViewer -->|Browse public maps & stories| kfm
  researcher -->|Query, analyze, export| kfm
  educator -->|Use curated stories in lessons| kfm
  policymaker -->|Explore insights with citations| kfm
  contributor -->|Submit drafts (data/story)| kfm
  maintainer -->|Review/approve content + datasets| kfm
  admin -->|Operate system + ingestion runs| kfm
  governance -->|Define policy + sensitivity rules (CARE, RBAC)| kfm

  state -->|Provide datasets for ingestion + catalog| kfm
  federal -->|Provide open datasets/imagery for ingestion| kfm
  archives -->|Provide historical records/text/media| kfm
  partners -->|Provide licensed data under governance| kfm

  idp -->|Issue tokens/keys for AuthN| kfm
  cicd -->|Trigger controlled pipeline runs + checks| kfm
  kfm -->|Exports + APIs (REST/GraphQL, STAC/COG/GeoJSON, OGC-ready)| gisTools
  kfm -->|APIs for integration| downstream
  kfm -.->|Optional export/compute/import derivatives| earthEngine

  %% =========================
  %% ğŸ¨ Light styling (theme-friendly)
  %% =========================
  classDef system stroke-width:2px;
  class kfm system;

